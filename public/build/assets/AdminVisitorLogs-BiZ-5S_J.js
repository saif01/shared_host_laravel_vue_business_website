import{_ as I,d as c,a as t,b as l,w as o,f as d,t as r,r as u,F as k,e as C,h,c as S,g as L,o as g}from"./app-De8cIRNB.js";import{a as E}from"./adminPaginationMixin-DN7Wb3ng.js";import{h as H}from"./moment-C5S46NFB.js";const M={mixins:[E],data(){return{logs:[],statistics:{total:0,human_visits:0,bot_visits:0,unique_ips:0},deviceFilter:null,browserFilter:null,botFilter:null,deviceOptions:[{title:"Desktop",value:"desktop"},{title:"Mobile",value:"mobile"},{title:"Tablet",value:"tablet"}],browserOptions:[],botOptions:[{title:"Human Only",value:"false"},{title:"Bots Only",value:"true"}],viewDialog:!1,selectedLog:null,selectedLogs:[],selectAll:!1}},async mounted(){await this.loadStatistics(),await this.loadLogs()},methods:{async loadStatistics(){try{const s=await L.get("/api/v1/visitor-logs/statistics",{headers:this.getAuthHeaders()});this.statistics=s.data,s.data.browser_stats&&(this.browserOptions=Object.keys(s.data.browser_stats).map(e=>({title:e,value:e})))}catch(s){console.error("Error loading statistics:",s)}},async loadLogs(){try{this.loading=!0;const s=this.buildPaginationParams();this.search&&(s.search=this.search),this.deviceFilter&&(s.device_type=this.deviceFilter),this.browserFilter&&(s.browser=this.browserFilter),this.botFilter!==null&&(s.is_bot=this.botFilter);const e=await L.get("/api/v1/visitor-logs",{params:s,headers:this.getAuthHeaders()});this.logs=e.data.data||[],this.updatePagination(e.data)}catch(s){this.handleApiError(s,"Failed to load visitor logs")}finally{this.loading=!1}},viewLog(s){this.selectedLog=s,this.viewDialog=!0},async deleteLog(s){if(confirm("Are you sure you want to delete this visitor log?"))try{await L.delete(`/api/v1/visitor-logs/${s.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Visitor log deleted successfully"),await this.loadStatistics(),await this.loadLogs()}catch(e){this.handleApiError(e,"Error deleting visitor log")}},async deleteSelected(){if(this.selectedLogs.length!==0&&confirm(`Are you sure you want to delete ${this.selectedLogs.length} visitor log(s)?`))try{await L.post("/api/v1/visitor-logs/delete-multiple",{ids:this.selectedLogs},{headers:this.getAuthHeaders()}),this.showSuccess(`${this.selectedLogs.length} visitor log(s) deleted successfully`),this.selectedLogs=[],this.selectAll=!1,await this.loadStatistics(),await this.loadLogs()}catch(s){this.handleApiError(s,"Error deleting visitor logs")}},toggleSelectAll(){this.selectAll?this.selectedLogs=this.logs.map(s=>s.id):this.selectedLogs=[]},formatDate(s){return s?H(s).format("YYYY-MM-DD HH:mm:ss"):"-"},truncateText(s,e){return s?s.length>e?s.substring(0,e)+"...":s:"-"},getDeviceColor(s){return{desktop:"primary",mobile:"success",tablet:"info"}[s]||"grey"},onPerPageChange(){this.resetPagination(),this.loadLogs()},onSort(s){this.handleSort(s),this.loadLogs()}},watch:{selectedLogs(s){this.selectAll=s.length===this.logs.length&&this.logs.length>0}}},R={class:"page-header"},N={class:"d-flex align-center"},Y={class:"text-h6"},j={class:"d-flex align-center"},q={class:"text-h6"},G={class:"d-flex align-center"},J={class:"text-h6"},K={class:"d-flex align-center"},Q={class:"text-h6"},W={class:"d-flex align-center"},X={class:"text-h6"},Z={class:"text-caption text-grey"},$={class:"d-flex align-center"},ee={class:"d-flex align-center"},te={class:"d-flex align-center"},le={class:"d-flex"},se={class:"d-flex"},oe=["title"],ie=["title"],ne={key:1,class:"text-grey"},re={key:0},de={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},ae={class:"text-caption text-grey"},ue={key:0},ge={key:0,class:"ml-2"},ce={key:1},me={key:0,class:"d-flex align-center gap-2"},pe={class:"mb-3"},ve={class:"mb-3"},fe={class:"mt-1"},_e=["href"],he={class:"mb-3"},be={class:"mt-1"},ye=["href"],we={key:1,class:"text-grey"},Le={class:"mb-3"},Ve={class:"mb-3"},xe={class:"mb-3"},ke={class:"mb-3"},Se={class:"mb-3"},Pe={class:"mb-3"};function Ae(s,e,Ce,De,i,a){const y=u("v-btn"),v=u("v-icon"),f=u("v-card-text"),_=u("v-card"),m=u("v-col"),V=u("v-row"),w=u("v-select"),D=u("v-text-field"),P=u("v-card-title"),A=u("v-checkbox"),p=u("v-skeleton-loader"),b=u("v-chip"),U=u("v-table"),F=u("v-pagination"),z=u("v-textarea"),O=u("v-spacer"),B=u("v-card-actions"),T=u("v-dialog");return g(),c("div",null,[t("div",R,[e[13]||(e[13]=t("h1",{class:"text-h4 page-title"},"Visitor Log Management",-1)),l(y,{color:"error","prepend-icon":"mdi-delete",onClick:a.deleteSelected,disabled:i.selectedLogs.length===0},{default:o(()=>[d(" Delete Selected ("+r(i.selectedLogs.length)+") ",1)]),_:1},8,["onClick","disabled"])]),l(V,{class:"mb-4"},{default:o(()=>[l(m,{cols:"12",md:"3"},{default:o(()=>[l(_,null,{default:o(()=>[l(f,null,{default:o(()=>[t("div",N,[l(v,{color:"primary",size:"40",class:"mr-3"},{default:o(()=>e[14]||(e[14]=[d("mdi-account-group")])),_:1,__:[14]}),t("div",null,[t("div",Y,r(i.statistics.total||0),1),e[15]||(e[15]=t("div",{class:"text-caption text-grey"},"Total Visits",-1))])])]),_:1})]),_:1})]),_:1}),l(m,{cols:"12",md:"3"},{default:o(()=>[l(_,null,{default:o(()=>[l(f,null,{default:o(()=>[t("div",j,[l(v,{color:"success",size:"40",class:"mr-3"},{default:o(()=>e[16]||(e[16]=[d("mdi-account")])),_:1,__:[16]}),t("div",null,[t("div",q,r(i.statistics.human_visits||0),1),e[17]||(e[17]=t("div",{class:"text-caption text-grey"},"Human Visits",-1))])])]),_:1})]),_:1})]),_:1}),l(m,{cols:"12",md:"3"},{default:o(()=>[l(_,null,{default:o(()=>[l(f,null,{default:o(()=>[t("div",G,[l(v,{color:"warning",size:"40",class:"mr-3"},{default:o(()=>e[18]||(e[18]=[d("mdi-robot")])),_:1,__:[18]}),t("div",null,[t("div",J,r(i.statistics.bot_visits||0),1),e[19]||(e[19]=t("div",{class:"text-caption text-grey"},"Bot Visits",-1))])])]),_:1})]),_:1})]),_:1}),l(m,{cols:"12",md:"3"},{default:o(()=>[l(_,null,{default:o(()=>[l(f,null,{default:o(()=>[t("div",K,[l(v,{color:"info",size:"40",class:"mr-3"},{default:o(()=>e[20]||(e[20]=[d("mdi-web")])),_:1,__:[20]}),t("div",null,[t("div",Q,r(i.statistics.unique_ips||0),1),e[21]||(e[21]=t("div",{class:"text-caption text-grey"},"Unique IPs",-1))])])]),_:1})]),_:1})]),_:1}),l(m,{cols:"12",md:"3"},{default:o(()=>[l(_,null,{default:o(()=>[l(f,null,{default:o(()=>[t("div",W,[l(v,{color:"purple",size:"40",class:"mr-3"},{default:o(()=>e[22]||(e[22]=[d("mdi-database")])),_:1,__:[22]}),t("div",null,[t("div",X,r(s.pagination.total||0),1),e[23]||(e[23]=t("div",{class:"text-caption text-grey"},"Total Records",-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),l(_,{class:"mb-4"},{default:o(()=>[l(f,null,{default:o(()=>[l(V,null,{default:o(()=>[l(m,{cols:"12",md:"2"},{default:o(()=>[l(w,{modelValue:s.perPage,"onUpdate:modelValue":[e[0]||(e[0]=n=>s.perPage=n),a.onPerPageChange],items:s.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(m,{cols:"12",md:"2"},{default:o(()=>[l(w,{modelValue:i.deviceFilter,"onUpdate:modelValue":[e[1]||(e[1]=n=>i.deviceFilter=n),a.loadLogs],items:i.deviceOptions,label:"Device Type","prepend-inner-icon":"mdi-devices",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(m,{cols:"12",md:"2"},{default:o(()=>[l(w,{modelValue:i.browserFilter,"onUpdate:modelValue":[e[2]||(e[2]=n=>i.browserFilter=n),a.loadLogs],items:i.browserOptions,label:"Browser","prepend-inner-icon":"mdi-web",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(m,{cols:"12",md:"2"},{default:o(()=>[l(w,{modelValue:i.botFilter,"onUpdate:modelValue":[e[3]||(e[3]=n=>i.botFilter=n),a.loadLogs],items:i.botOptions,label:"Bot Filter","prepend-inner-icon":"mdi-robot",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(m,{cols:"12",md:"4"},{default:o(()=>[l(D,{modelValue:s.search,"onUpdate:modelValue":[e[4]||(e[4]=n=>s.search=n),a.loadLogs],label:"Search (IP, URL, user agent)","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(_,null,{default:o(()=>[l(P,{class:"d-flex justify-space-between align-center"},{default:o(()=>[e[25]||(e[25]=t("span",null,"Visitor Logs",-1)),t("span",Z,[e[24]||(e[24]=d(" Total Records: ")),t("strong",null,r((s.pagination.total||0).toLocaleString()),1)])]),_:1,__:[25]}),l(f,null,{default:o(()=>[l(U,null,{default:o(()=>[t("thead",null,[t("tr",null,[t("th",null,[l(A,{modelValue:i.selectAll,"onUpdate:modelValue":e[5]||(e[5]=n=>i.selectAll=n),onChange:a.toggleSelectAll,density:"compact"},null,8,["modelValue","onChange"])]),t("th",{class:"sortable",onClick:e[6]||(e[6]=n=>a.onSort("ip_address"))},[t("div",$,[e[26]||(e[26]=d(" IP Address ")),l(v,{icon:s.getSortIcon("ip_address"),size:"small",class:"ml-1"},null,8,["icon"])])]),t("th",{class:"sortable",onClick:e[7]||(e[7]=n=>a.onSort("url"))},[t("div",ee,[e[27]||(e[27]=d(" URL ")),l(v,{icon:s.getSortIcon("url"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[29]||(e[29]=t("th",null,"Device",-1)),e[30]||(e[30]=t("th",null,"Browser",-1)),e[31]||(e[31]=t("th",null,"OS",-1)),e[32]||(e[32]=t("th",null,"Referer",-1)),t("th",{class:"sortable",onClick:e[8]||(e[8]=n=>a.onSort("created_at"))},[t("div",te,[e[28]||(e[28]=d(" Date ")),l(v,{icon:s.getSortIcon("created_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[33]||(e[33]=t("th",null,"Actions",-1))])]),t("tbody",null,[s.loading?(g(),c(k,{key:0},C(5,n=>t("tr",{key:`skeleton-${n}`},[t("td",null,[l(p,{type:"text",width:"24",height:"24"})]),t("td",null,[l(p,{type:"chip",width:"120",height:"24"})]),t("td",null,[l(p,{type:"text",width:"200"})]),t("td",null,[t("div",le,[l(p,{type:"chip",width:"80",height:"24",class:"mr-1"}),l(p,{type:"chip",width:"40",height:"20"})])]),t("td",null,[l(p,{type:"text",width:"100"})]),t("td",null,[l(p,{type:"text",width:"100"})]),t("td",null,[l(p,{type:"text",width:"150"})]),t("td",null,[l(p,{type:"text",width:"140"})]),t("td",null,[t("div",se,[l(p,{type:"button",width:"32",height:"32",class:"mr-1"}),l(p,{type:"button",width:"32",height:"32"})])])])),64)):(g(),c(k,{key:1},[(g(!0),c(k,null,C(i.logs,n=>(g(),c("tr",{key:n.id},[t("td",null,[l(A,{value:n.id,modelValue:i.selectedLogs,"onUpdate:modelValue":e[9]||(e[9]=x=>i.selectedLogs=x),density:"compact"},null,8,["value","modelValue"])]),t("td",null,[l(b,{size:"small",variant:"outlined"},{default:o(()=>[d(r(n.ip_address||"-"),1)]),_:2},1024)]),t("td",null,[t("span",{class:"text-caption",title:n.url},r(a.truncateText(n.url,40)),9,oe)]),t("td",null,[l(b,{size:"small",color:a.getDeviceColor(n.device_type)},{default:o(()=>[d(r(n.device_type||"-"),1)]),_:2},1032,["color"]),n.is_bot?(g(),S(b,{key:0,size:"x-small",color:"warning",class:"ml-1"},{default:o(()=>e[34]||(e[34]=[d("Bot")])),_:1,__:[34]})):h("",!0)]),t("td",null,r(n.browser||"-"),1),t("td",null,r(n.os||"-"),1),t("td",null,[n.referer?(g(),c("span",{key:0,class:"text-caption",title:n.referer},r(a.truncateText(n.referer,30)),9,ie)):(g(),c("span",ne,"-"))]),t("td",null,r(a.formatDate(n.created_at)),1),t("td",null,[l(y,{size:"small",icon:"mdi-eye",onClick:x=>a.viewLog(n),variant:"text"},null,8,["onClick"]),l(y,{size:"small",icon:"mdi-delete",onClick:x=>a.deleteLog(n),variant:"text",color:"error"},null,8,["onClick"])])]))),128)),i.logs.length===0?(g(),c("tr",re,e[35]||(e[35]=[t("td",{colspan:"9",class:"text-center py-4"},"No visitor logs found",-1)]))):h("",!0)],64))])]),_:1}),t("div",de,[t("div",ae,[i.logs.length>0&&s.pagination.total>0?(g(),c("span",ue,[e[36]||(e[36]=d(" Showing ")),t("strong",null,r((s.currentPage-1)*s.perPage+1),1),e[37]||(e[37]=d(" to ")),t("strong",null,r(Math.min(s.currentPage*s.perPage,s.pagination.total)),1),e[38]||(e[38]=d(" of ")),t("strong",null,r(s.pagination.total.toLocaleString()),1),e[39]||(e[39]=d(" records ")),s.pagination.last_page>1?(g(),c("span",ge," (Page "+r(s.currentPage)+" of "+r(s.pagination.last_page)+") ",1)):h("",!0)])):(g(),c("span",ce," No records found "))]),s.pagination.last_page>1?(g(),c("div",me,[l(F,{modelValue:s.currentPage,"onUpdate:modelValue":[e[10]||(e[10]=n=>s.currentPage=n),a.loadLogs],length:s.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):h("",!0)])]),_:1})]),_:1}),l(T,{modelValue:i.viewDialog,"onUpdate:modelValue":e[12]||(e[12]=n=>i.viewDialog=n),"max-width":"800"},{default:o(()=>[i.selectedLog?(g(),S(_,{key:0},{default:o(()=>[l(P,null,{default:o(()=>e[40]||(e[40]=[d("Visitor Log Details")])),_:1,__:[40]}),l(f,null,{default:o(()=>[l(V,null,{default:o(()=>[l(m,{cols:"12",md:"6"},{default:o(()=>[t("div",pe,[e[41]||(e[41]=t("strong",null,"IP Address:",-1)),d(" "+r(i.selectedLog.ip_address||"-"),1)]),t("div",ve,[e[42]||(e[42]=t("strong",null,"URL:",-1)),t("div",fe,[t("a",{href:i.selectedLog.url,target:"_blank",class:"text-primary"},r(i.selectedLog.url),9,_e)])]),t("div",he,[e[43]||(e[43]=t("strong",null,"Referer:",-1)),t("div",be,[i.selectedLog.referer?(g(),c("a",{key:0,href:i.selectedLog.referer,target:"_blank",class:"text-primary"},r(i.selectedLog.referer),9,ye)):(g(),c("span",we,"-"))])]),t("div",Le,[e[44]||(e[44]=t("strong",null,"Method:",-1)),d(" "+r(i.selectedLog.method||"GET"),1)])]),_:1}),l(m,{cols:"12",md:"6"},{default:o(()=>[t("div",Ve,[e[46]||(e[46]=t("strong",null,"Device Type:",-1)),l(b,{size:"small",color:a.getDeviceColor(i.selectedLog.device_type),class:"ml-2"},{default:o(()=>[d(r(i.selectedLog.device_type||"-"),1)]),_:1},8,["color"]),i.selectedLog.is_bot?(g(),S(b,{key:0,size:"small",color:"warning",class:"ml-2"},{default:o(()=>e[45]||(e[45]=[d("Bot")])),_:1,__:[45]})):h("",!0)]),t("div",xe,[e[47]||(e[47]=t("strong",null,"Browser:",-1)),d(" "+r(i.selectedLog.browser||"-"),1)]),t("div",ke,[e[48]||(e[48]=t("strong",null,"OS:",-1)),d(" "+r(i.selectedLog.os||"-"),1)]),t("div",Se,[e[49]||(e[49]=t("strong",null,"Page Views:",-1)),d(" "+r(i.selectedLog.page_views||1),1)]),t("div",Pe,[e[50]||(e[50]=t("strong",null,"Created At:",-1)),d(" "+r(a.formatDate(i.selectedLog.created_at)),1)])]),_:1}),l(m,{cols:"12"},{default:o(()=>[e[51]||(e[51]=t("div",{class:"mb-2"},[t("strong",null,"User Agent:")],-1)),l(z,{value:i.selectedLog.user_agent||"-",readonly:"",variant:"outlined",density:"compact",rows:"3"},null,8,["value"])]),_:1,__:[51]})]),_:1})]),_:1}),l(B,null,{default:o(()=>[l(O),l(y,{onClick:e[11]||(e[11]=n=>i.viewDialog=!1),variant:"text"},{default:o(()=>e[52]||(e[52]=[d("Close")])),_:1,__:[52]})]),_:1})]),_:1})):h("",!0)]),_:1},8,["modelValue"])])}const Oe=I(M,[["render",Ae],["__scopeId","data-v-7b0b951b"]]);export{Oe as default};
