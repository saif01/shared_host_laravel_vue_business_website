import{_ as H,c as f,g as o,a as s,w as i,r as u,b as w,o as m,d as r,f as k,h as G,F as x,e as S,t as d,i as L,k as K}from"./app-lD5pKros.js";import{a as R}from"./adminPaginationMixin-DN7Wb3ng.js";const j={mixins:[R],data(){return{permissions:[],groupedPermissions:{},groups:[],dialog:!1,editingPermission:null,viewMode:"flat",searchQuery:"",selectedGroup:null,newGroup:"",form:{name:"",slug:"",group:"",description:""},rules:{required:t=>!!t||"This field is required"}}},async mounted(){await this.loadGroups(),await this.loadPermissions()},methods:{async loadPermissions(){try{this.loading=!0;const t={};this.searchQuery&&(t.search=this.searchQuery),this.selectedGroup&&(t.group=this.selectedGroup),this.viewMode==="grouped"?t.grouped=!0:(t.page=this.currentPage,t.per_page=this.perPage);const e=await w.get("/api/v1/permissions",{params:t,headers:this.getAuthHeaders()});this.viewMode==="grouped"?(this.groupedPermissions=e.data,this.permissions=[],Object.values(e.data).forEach(g=>{this.permissions.push(...g)}),this.pagination={current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length}):(e.data.data?(this.permissions=e.data.data||[],this.pagination={current_page:e.data.current_page,last_page:e.data.last_page,per_page:e.data.per_page,total:e.data.total}):(this.permissions=e.data||[],this.pagination={current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length}),this.groupedPermissions={},this.permissions.forEach(g=>{this.groupedPermissions[g.group]||(this.groupedPermissions[g.group]=[]),this.groupedPermissions[g.group].push(g)}))}catch(t){this.handleApiError(t,"Failed to load permissions")}finally{this.loading=!1}},async loadGroups(){try{const t=await w.get("/api/v1/permissions/groups",{headers:this.getAuthHeaders()});this.groups=t.data||[]}catch(t){console.error("Error loading groups:",t),this.groups=["general","content","users","leads","careers","settings","system"]}},openDialog(t){t?(this.editingPermission=t,this.form={name:t.name,slug:t.slug,group:t.group,description:t.description||""}):(this.editingPermission=null,this.form={name:"",slug:"",group:"",description:""}),this.dialog=!0},closeDialog(){this.dialog=!1,this.editingPermission=null,this.form={name:"",slug:"",group:"",description:""},this.$refs.permissionForm&&this.$refs.permissionForm.resetValidation()},autoGenerateSlugFromName(){!this.form.slug&&this.form.name&&!this.editingPermission&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))},addNewGroup(){this.newGroup&&!this.groups.includes(this.newGroup)&&(this.groups.push(this.newGroup),this.form.group=this.newGroup,this.newGroup="")},async savePermission(){if(!this.$refs.permissionForm){this.showError("Form reference not found");return}if(this.$refs.permissionForm.validate()){!this.form.slug&&this.form.name&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")),this.saving=!0;try{const t=this.editingPermission?`/api/v1/permissions/${this.editingPermission.id}`:"/api/v1/permissions",e=this.editingPermission?"put":"post",g={name:this.form.name.trim(),slug:this.form.slug?this.form.slug.trim():null,group:this.form.group.trim(),description:this.form.description?this.form.description.trim():null};await w[e](t,g,{headers:this.getAuthHeaders()}),this.showSuccess(this.editingPermission?"Permission updated successfully":"Permission created successfully"),this.closeDialog(),await this.loadGroups(),await this.loadPermissions()}catch(t){this.handleApiError(t,"Error saving permission")}finally{this.saving=!1}}},async deletePermission(t){if((t.roles_count||0)>0){this.showError("Cannot delete permission that is assigned to roles. Please remove it from all roles first.");return}if(confirm(`Are you sure you want to delete the permission "${t.name}"?`))try{await w.delete(`/api/v1/permissions/${t.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Permission deleted successfully"),await this.loadPermissions()}catch(e){this.handleApiError(e,"Error deleting permission")}},getGroupColor(t){return{general:"primary",content:"success",users:"info",leads:"warning",careers:"purple",settings:"orange",system:"error"}[t]||"grey"},onPerPageChange(){this.resetPagination(),this.loadPermissions()},onSort(t){this.handleSort(t),this.loadPermissions()}},watch:{viewMode(){this.currentPage=1,this.loadPermissions()}}},O={class:"d-flex justify-space-between align-center mb-6"},T={key:0},J={class:"text-h6 mb-3"},W={class:"d-flex align-center"},X={class:"d-flex align-center"},Y={class:"font-weight-medium"},Z={class:"text-caption text-grey"},$={class:"d-flex align-center"},ee={class:"d-flex align-center"},se={class:"d-flex align-center"},te={class:"font-weight-medium"},le={class:"text-caption text-grey"},oe={key:0};function ie(t,e,g,ne,n,a){const c=u("v-btn"),y=u("v-select"),V=u("v-col"),P=u("v-text-field"),M=u("v-row"),b=u("v-card-text"),C=u("v-card"),z=u("v-card-title"),v=u("v-chip"),h=u("v-icon"),U=u("v-table"),F=u("v-pagination"),N=u("v-spacer"),D=u("v-btn-toggle"),A=u("v-card-actions"),E=u("v-list-item"),B=u("v-textarea"),q=u("v-form"),I=u("v-dialog");return m(),f("div",null,[o("div",O,[e[18]||(e[18]=o("h1",{class:"text-h4"},"Permission Management",-1)),s(c,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=l=>a.openDialog(null))},{default:i(()=>e[17]||(e[17]=[r(" Add New Permission ")])),_:1,__:[17]})]),s(C,{class:"mb-4"},{default:i(()=>[s(b,null,{default:i(()=>[s(M,null,{default:i(()=>[n.viewMode==="flat"?(m(),k(V,{key:0,cols:"12",md:"4"},{default:i(()=>[s(y,{modelValue:t.perPage,"onUpdate:modelValue":[e[1]||(e[1]=l=>t.perPage=l),a.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1})):G("",!0),s(V,{cols:"12",md:n.viewMode==="flat"?4:6},{default:i(()=>[s(y,{modelValue:n.selectedGroup,"onUpdate:modelValue":[e[2]||(e[2]=l=>n.selectedGroup=l),a.loadPermissions],items:n.groups,label:"Filter by Group","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1},8,["md"]),s(V,{cols:"12",md:n.viewMode==="flat"?4:6},{default:i(()=>[s(P,{modelValue:n.searchQuery,"onUpdate:modelValue":[e[3]||(e[3]=l=>n.searchQuery=l),a.loadPermissions],label:"Search permissions","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["md"])]),_:1})]),_:1})]),_:1}),s(C,null,{default:i(()=>[s(z,null,{default:i(()=>e[19]||(e[19]=[r("Permissions")])),_:1,__:[19]}),s(b,null,{default:i(()=>[n.viewMode==="grouped"?(m(),f("div",T,[(m(!0),f(x,null,S(n.groupedPermissions,(l,_)=>(m(),f("div",{key:_,class:"mb-6"},[o("h3",J,[r(d(_.charAt(0).toUpperCase()+_.slice(1))+" ",1),s(v,{size:"small",color:"primary",variant:"text",class:"ml-2"},{default:i(()=>[r(d(l.length)+" permission"+d(l.length!==1?"s":""),1)]),_:2},1024)]),s(U,null,{default:i(()=>[o("thead",null,[o("tr",null,[o("th",{class:"sortable",onClick:e[4]||(e[4]=p=>a.onSort("name"))},[o("div",W,[e[20]||(e[20]=r(" Name ")),s(h,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),o("th",{class:"sortable",onClick:e[5]||(e[5]=p=>a.onSort("slug"))},[o("div",X,[e[21]||(e[21]=r(" Slug ")),s(h,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[22]||(e[22]=o("th",null,"Description",-1)),e[23]||(e[23]=o("th",null,"Roles",-1)),e[24]||(e[24]=o("th",null,"Actions",-1))])]),o("tbody",null,[(m(!0),f(x,null,S(l,p=>(m(),f("tr",{key:p.id},[o("td",null,[o("div",Y,d(p.name),1)]),o("td",null,[s(v,{size:"small",variant:"outlined"},{default:i(()=>[r(d(p.slug),1)]),_:2},1024)]),o("td",null,[o("span",Z,d(p.description||"No description"),1)]),o("td",null,[s(v,{size:"small",color:"info",variant:"text"},{default:i(()=>[r(d(p.roles_count||0)+" role"+d((p.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),o("td",null,[s(c,{size:"small",icon:"mdi-pencil",onClick:Q=>a.openDialog(p),variant:"text"},null,8,["onClick"]),s(c,{size:"small",icon:"mdi-delete",onClick:Q=>a.deletePermission(p),variant:"text",color:"error",disabled:(p.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128))])]),_:2},1024)]))),128))])):(m(),k(U,{key:1},{default:i(()=>[o("thead",null,[o("tr",null,[o("th",{class:"sortable",onClick:e[6]||(e[6]=l=>a.onSort("name"))},[o("div",$,[e[25]||(e[25]=r(" Name ")),s(h,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),o("th",{class:"sortable",onClick:e[7]||(e[7]=l=>a.onSort("slug"))},[o("div",ee,[e[26]||(e[26]=r(" Slug ")),s(h,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),o("th",{class:"sortable",onClick:e[8]||(e[8]=l=>a.onSort("group"))},[o("div",se,[e[27]||(e[27]=r(" Group ")),s(h,{icon:t.getSortIcon("group"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[28]||(e[28]=o("th",null,"Description",-1)),e[29]||(e[29]=o("th",null,"Roles",-1)),e[30]||(e[30]=o("th",null,"Actions",-1))])]),o("tbody",null,[(m(!0),f(x,null,S(n.permissions,l=>(m(),f("tr",{key:l.id},[o("td",null,[o("div",te,d(l.name),1)]),o("td",null,[s(v,{size:"small",variant:"outlined"},{default:i(()=>[r(d(l.slug),1)]),_:2},1024)]),o("td",null,[s(v,{size:"small",color:a.getGroupColor(l.group)},{default:i(()=>[r(d(l.group),1)]),_:2},1032,["color"])]),o("td",null,[o("span",le,d(l.description||"No description"),1)]),o("td",null,[s(v,{size:"small",color:"info",variant:"text"},{default:i(()=>[r(d(l.roles_count||0)+" role"+d((l.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),o("td",null,[s(c,{size:"small",icon:"mdi-pencil",onClick:_=>a.openDialog(l),variant:"text"},null,8,["onClick"]),s(c,{size:"small",icon:"mdi-delete",onClick:_=>a.deletePermission(l),variant:"text",color:"error",disabled:(l.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128)),n.permissions.length===0?(m(),f("tr",oe,e[31]||(e[31]=[o("td",{colspan:"6",class:"text-center py-4"},"No permissions found",-1)]))):G("",!0)])]),_:1})),n.viewMode==="flat"&&t.pagination.last_page>1?(m(),k(F,{key:2,modelValue:t.currentPage,"onUpdate:modelValue":[e[9]||(e[9]=l=>t.currentPage=l),a.loadPermissions],length:t.pagination.last_page,class:"mt-4"},null,8,["modelValue","length","onUpdate:modelValue"])):G("",!0)]),_:1}),s(A,null,{default:i(()=>[s(N),s(D,{modelValue:n.viewMode,"onUpdate:modelValue":e[10]||(e[10]=l=>n.viewMode=l),mandatory:""},{default:i(()=>[s(c,{value:"flat",size:"small"},{default:i(()=>[s(h,{start:""},{default:i(()=>e[32]||(e[32]=[r("mdi-format-list-bulleted")])),_:1,__:[32]}),e[33]||(e[33]=r(" Flat View "))]),_:1,__:[33]}),s(c,{value:"grouped",size:"small"},{default:i(()=>[s(h,{start:""},{default:i(()=>e[34]||(e[34]=[r("mdi-folder")])),_:1,__:[34]}),e[35]||(e[35]=r(" Grouped View "))]),_:1,__:[35]})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(I,{modelValue:n.dialog,"onUpdate:modelValue":e[16]||(e[16]=l=>n.dialog=l),"max-width":"600",persistent:""},{default:i(()=>[s(C,null,{default:i(()=>[s(z,null,{default:i(()=>[r(d(n.editingPermission?"Edit Permission":"Add New Permission"),1)]),_:1}),s(b,null,{default:i(()=>[s(q,{ref:"permissionForm",onSubmit:L(a.savePermission,["prevent"])},{default:i(()=>[s(P,{modelValue:n.form.name,"onUpdate:modelValue":e[11]||(e[11]=l=>n.form.name=l),label:"Permission Name",rules:[n.rules.required],required:"",hint:"Display name for the permission (e.g., 'Manage Pages')","persistent-hint":"",class:"mb-4",onBlur:a.autoGenerateSlugFromName},null,8,["modelValue","rules","onBlur"]),s(P,{modelValue:n.form.slug,"onUpdate:modelValue":e[12]||(e[12]=l=>n.form.slug=l),label:"Slug",hint:"URL-friendly identifier (auto-generated if empty)","persistent-hint":"",class:"mb-4"},null,8,["modelValue"]),s(y,{modelValue:n.form.group,"onUpdate:modelValue":e[14]||(e[14]=l=>n.form.group=l),items:n.groups,label:"Group",rules:[n.rules.required],required:"",hint:"Category/group for organizing permissions","persistent-hint":"",class:"mb-4"},{"append-item":i(()=>[s(E,null,{default:i(()=>[s(P,{modelValue:n.newGroup,"onUpdate:modelValue":e[13]||(e[13]=l=>n.newGroup=l),label:"Add New Group","prepend-inner-icon":"mdi-plus",variant:"outlined",density:"compact",onKeyup:K(a.addNewGroup,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["modelValue","items","rules"]),s(B,{modelValue:n.form.description,"onUpdate:modelValue":e[15]||(e[15]=l=>n.form.description=l),label:"Description",hint:"Brief description of what this permission allows","persistent-hint":"",rows:"2",class:"mb-4"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),s(A,null,{default:i(()=>[s(N),s(c,{onClick:a.closeDialog,variant:"text"},{default:i(()=>e[36]||(e[36]=[r("Cancel")])),_:1,__:[36]},8,["onClick"]),s(c,{onClick:a.savePermission,color:"primary",loading:t.saving},{default:i(()=>[r(d(n.editingPermission?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const ue=H(j,[["render",ie]]);export{ue as default};
