import{_ as z,d as k,b as s,w as n,a,c as d,h as c,r as o,m as v,t as _,f as p,i as M,g as b,B as T,o as i}from"./app-aVdZPH9_.js";import{h as j}from"./moment-C5S46NFB.js";const F={data(){return{drawer:!0,currentUser:null,userRoles:[],userPermissions:[],currentDate:j().format("Do MMMM YYYY"),currentYear:new Date().getFullYear(),unreadCount:0,unreadCountInterval:null,brandingLogo:null,siteName:null}},methods:{async loadUser(){var l;try{const e=localStorage.getItem("admin_token");if(!e){this.$router.push("/admin/login");return}const h=await b.get("/api/v1/auth/user",{headers:{Authorization:`Bearer ${e}`}});this.currentUser=h.data,this.userRoles=h.data.roles||[],this.userPermissions=[],this.userRoles&&this.userRoles.length>0&&this.userRoles.forEach(g=>{g.permissions&&g.permissions.length>0&&g.permissions.forEach(t=>{this.userPermissions.includes(t.slug)||this.userPermissions.push(t.slug)})})}catch(e){console.error("Error loading user:",e),((l=e.response)==null?void 0:l.status)===401&&(localStorage.removeItem("admin_token"),this.$router.push("/admin/login"))}},async loadBrandingSettings(){try{const l=localStorage.getItem("admin_token");if(!l)return;const e=await b.get("/api/v1/settings",{headers:{Authorization:`Bearer ${l}`}});e.data.general&&e.data.general.site_name&&e.data.general.site_name.value&&(this.siteName=e.data.general.site_name.value),e.data.branding&&e.data.branding.logo&&e.data.branding.logo.value&&(this.brandingLogo=e.data.branding.logo.value)}catch(l){console.error("Error loading branding settings:",l)}},async logout(){await T().logout(),this.currentUser=null,this.userRoles=[],this.userPermissions=[],this.$router.push("/admin/login")},hasPermission(l){return this.currentUser&&(this.currentUser.role==="admin"||this.userRoles&&this.userRoles.some(e=>e.slug==="administrator"))?!0:this.userPermissions.includes(l)},async loadUnreadCount(){if(this.hasPermission("view-leads"))try{const l=localStorage.getItem("admin_token");if(!l)return;const e=await b.get("/api/v1/leads/unread-count",{headers:{Authorization:`Bearer ${l}`}});this.unreadCount=e.data.count||0}catch(l){console.error("Error loading unread count:",l)}},startUnreadCountPolling(){this.loadUnreadCount(),this.unreadCountInterval=setInterval(()=>{this.loadUnreadCount()},3e4)},stopUnreadCountPolling(){this.unreadCountInterval&&(clearInterval(this.unreadCountInterval),this.unreadCountInterval=null)}},mounted(){localStorage.getItem("admin_token")?(this.loadUser().then(()=>{this.startUnreadCountPolling()}),this.loadBrandingSettings()):this.$router.push("/admin/login")},provide(){return{refreshUnreadCount:()=>{this.loadUnreadCount()}}},watch:{$route(){this.loadUnreadCount()}},beforeUnmount(){this.stopUnreadCountPolling()}},q={class:"d-flex align-center justify-space-between w-100"},G={key:0,class:"unread-badge"},H={class:"pa-2"},J={key:1,class:"d-flex align-center mr-4"},K={class:"footer-content"},O={class:"footer-info"},Q={class:"copyright-text"};function W(l,e,h,g,t,m){const r=o("v-list-item"),A=o("v-divider"),f=o("v-list-group"),w=o("v-list"),x=o("v-icon"),R=o("v-btn"),S=o("v-navigation-drawer"),L=o("v-app-bar-nav-icon"),y=o("v-chip"),P=o("v-spacer"),U=o("v-img"),I=o("v-avatar"),C=o("v-list-item-title"),B=o("v-menu"),N=o("v-app-bar"),V=o("router-view"),D=o("v-container"),Y=o("v-main"),E=o("v-footer");return i(),k("div",null,[s(S,{modelValue:t.drawer,"onUpdate:modelValue":e[1]||(e[1]=u=>t.drawer=u),class:"gradient_color",location:"left",permanent:"","hide-overlay":"",app:"",dark:""},{append:n(()=>[a("div",H,[s(R,{link:"",router:"",onClick:e[0]||(e[0]=u=>m.logout()),class:"logout-btn text-black",size:"small",block:""},{default:n(()=>[s(x,{left:""},{default:n(()=>e[5]||(e[5]=[p("mdi-logout")])),_:1,__:[5]}),e[6]||(e[6]=p("Logout "))]),_:1,__:[6]})])]),default:n(()=>[e[7]||(e[7]=a("div",{class:"sidebar-shapes"},[a("div",{class:"shape shape-1"}),a("div",{class:"shape shape-2"}),a("div",{class:"shape shape-3"})],-1)),t.currentUser?(i(),d(r,{key:0,class:"user-profile-header","prepend-avatar":t.brandingLogo||t.currentUser.avatar||"/assets/logo/logo.png",title:t.siteName||"Admin Panel",subtitle:t.userRoles&&t.userRoles.length>0?t.userRoles.map(u=>u.name).join(", "):"No roles assigned"},null,8,["prepend-avatar","title","subtitle"])):c("",!0),s(A,{class:"my-0 divider-glow"}),s(w,{density:"compact",nav:""},{default:n(()=>[m.hasPermission("access-dashboard")?(i(),d(r,{key:0,link:"",router:"","prepend-icon":"mdi-view-dashboard",title:"Dashboard",to:{name:"AdminDashboard"},value:"Dashboard",exact:""})):c("",!0),m.hasPermission("manage-services")?(i(),d(r,{key:1,link:"",router:"","prepend-icon":"mdi-wrench",title:"Services",to:{name:"AdminServices"},value:"Services",exact:""})):c("",!0),m.hasPermission("manage-products")?(i(),d(f,{key:2,value:"products","prepend-icon":"mdi-package-variant","no-action":""},{activator:n(({props:u})=>[s(r,v(u,{title:"Products"}),null,16)]),default:n(()=>[s(r,{"prepend-icon":"mdi-package-variant",title:"Products",to:{name:"AdminProducts"}}),s(r,{"prepend-icon":"mdi-folder",title:"Categories",to:{name:"AdminCategories"}}),s(r,{"prepend-icon":"mdi-tag",title:"Tags",to:{name:"AdminTags"}})]),_:1})):c("",!0),m.hasPermission("view-leads")?(i(),d(r,{key:3,link:"",router:"","prepend-icon":"mdi-email",to:{name:"AdminLeads"},value:"Leads",exact:"",class:"leads-menu-item"},{title:n(()=>[a("div",q,[e[4]||(e[4]=a("span",null,"Leads",-1)),t.unreadCount>0?(i(),k("span",G,_(t.unreadCount>99?"99+":t.unreadCount),1)):c("",!0)])]),_:1})):c("",!0),m.hasPermission("view-leads")?(i(),d(r,{key:4,link:"",router:"","prepend-icon":"mdi-email-newsletter",to:{name:"AdminNewsletters"},value:"Newsletters",exact:"",title:"Newsletters"})):c("",!0),m.hasPermission("manage-users")?(i(),d(r,{key:5,link:"",router:"","prepend-icon":"mdi-account-group",title:"Users",to:{name:"AdminUsers"},value:"Users",exact:""})):c("",!0),m.hasPermission("manage-roles")?(i(),d(f,{key:6,value:"roles","prepend-icon":"mdi-shield-account","no-action":""},{activator:n(({props:u})=>[s(r,v(u,{title:"Roles & Permissions"}),null,16)]),default:n(()=>[s(r,{"prepend-icon":"mdi-shield-account",title:"Roles",to:{name:"AdminRoles"}}),s(r,{"prepend-icon":"mdi-key",title:"Permissions",to:{name:"AdminPermissions"}})]),_:1})):c("",!0),m.hasPermission("manage-settings")?(i(),d(r,{key:7,link:"",router:"","prepend-icon":"mdi-cog",title:"Settings",to:{name:"AdminSettings"},value:"Settings",exact:""})):c("",!0),m.hasPermission("view-login-logs")||m.hasPermission("view-visitor-logs")?(i(),d(f,{key:8,value:"logs","prepend-icon":"mdi-file-document-multiple","no-action":""},{activator:n(({props:u})=>[s(r,v(u,{title:"Logs"}),null,16)]),default:n(()=>[m.hasPermission("view-login-logs")?(i(),d(r,{key:0,"prepend-icon":"mdi-login",title:"Login Logs",to:{name:"AdminLoginLogs"}})):c("",!0),m.hasPermission("view-visitor-logs")?(i(),d(r,{key:1,"prepend-icon":"mdi-account-group",title:"Visitor Logs",to:{name:"AdminVisitorLogs"}})):c("",!0)]),_:1})):c("",!0)]),_:1})]),_:1,__:[7]},8,["modelValue"]),s(N,{app:"",flat:"",density:"compact",class:"gradient_color app-bar-modern"},{default:n(()=>[s(L,{onClick:e[2]||(e[2]=M(u=>t.drawer=!t.drawer,["stop"]))}),s(y,{class:"mx-2 date-chip"},{default:n(()=>[p(_(t.currentDate),1)]),_:1}),s(P),t.currentUser&&(t.currentUser.role==="admin"||t.userRoles&&t.userRoles.some(u=>u.slug==="administrator"))?(i(),d(y,{key:0,"prepend-icon":"mdi-shield-account"},{default:n(()=>e[8]||(e[8]=[p("Administrator")])),_:1,__:[8]})):c("",!0),s(P),t.currentUser?(i(),k("div",J,[s(B,{"open-on-hover":""},{activator:n(({props:u})=>[s(I,v(u,{size:"42",class:"fill-image mr-2",title:t.currentUser.name}),{default:n(()=>[t.currentUser.avatar?(i(),d(U,{key:0,cover:"",src:t.currentUser.avatar,alt:t.currentUser.name},null,8,["src","alt"])):(i(),d(U,{key:1,cover:"",src:"/assets/logo/logo.png",alt:"image"}))]),_:2},1040,["title"])]),default:n(()=>[s(w,null,{default:n(()=>[s(r,null,{default:n(()=>[s(C,null,{default:n(()=>[p(_(t.currentUser.name),1)]),_:1})]),_:1}),s(r,{link:"",router:"",onClick:e[3]||(e[3]=u=>m.logout())},{default:n(()=>[s(C,null,{default:n(()=>e[9]||(e[9]=[p("Logout")])),_:1,__:[9]})]),_:1})]),_:1})]),_:1})])):c("",!0)]),_:1}),s(Y,null,{default:n(()=>[s(D,{fluid:""},{default:n(()=>[s(V)]),_:1})]),_:1}),s(E,{class:"footer-modern gradient_color rtl-footer",app:""},{default:n(()=>[a("div",K,[e[11]||(e[11]=a("div",{class:"footer-brand"},[a("div",{class:"logo-wrapper"},[a("img",{src:"/assets/logo/logo.png",alt:"cpb-it",height:"24",class:"footer-logo"})]),a("div",{class:"brand-text"},[a("span",{class:"brand-name"},"Powered By CPB-IT")])],-1)),e[12]||(e[12]=a("div",{class:"footer-divider"},null,-1)),a("div",O,[e[10]||(e[10]=a("span",{class:"version-badge"},"v2.0",-1)),a("span",Q,"Â© "+_(t.currentYear)+" All Rights Reserved",1)])])]),_:1})])}const $=z(F,[["render",W],["__scopeId","data-v-626a0f5b"]]);export{$ as default};
