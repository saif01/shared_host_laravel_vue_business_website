import{_ as M,d as u,a as e,b as s,w as o,r as g,f as d,t as i,h,F as k,e as V,c as w,g as x,o as r}from"./app-D_WvYKr6.js";import{a as N}from"./adminPaginationMixin-DN7Wb3ng.js";import{h as T}from"./moment-C5S46NFB.js";const H={mixins:[N],data(){return{logs:[],statistics:{total:0,successful:0,failed:0,unique_users:0,unique_ips:0},statusFilter:null,statusOptions:[{title:"Success",value:"success"},{title:"Failed",value:"failed"}],viewDialog:!1,selectedLog:null}},async mounted(){await this.loadStatistics(),await this.loadLogs()},methods:{async loadStatistics(){try{const l=await x.get("/api/v1/login-logs/statistics",{headers:this.getAuthHeaders()});this.statistics=l.data}catch(l){console.error("Error loading statistics:",l)}},async loadLogs(){try{this.loading=!0;const l=this.buildPaginationParams();this.search&&(l.search=this.search),this.statusFilter&&(l.status=this.statusFilter);const t=await x.get("/api/v1/login-logs",{params:l,headers:this.getAuthHeaders()});this.logs=t.data.data||[],this.updatePagination(t.data)}catch(l){this.handleApiError(l,"Failed to load login logs")}finally{this.loading=!1}},viewLog(l){this.selectedLog=l,this.viewDialog=!0},async deleteLog(l){if(confirm("Are you sure you want to delete this login log?"))try{await x.delete(`/api/v1/login-logs/${l.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Login log deleted successfully"),await this.loadStatistics(),await this.loadLogs()}catch(t){this.handleApiError(t,"Error deleting login log")}},formatDate(l){return l?T(l).format("YYYY-MM-DD HH:mm:ss"):"-"},truncateText(l,t){return l?l.length>t?l.substring(0,t)+"...":l:"-"},onPerPageChange(){this.resetPagination(),this.loadLogs()},onSort(l){this.handleSort(l),this.loadLogs()}}},q={class:"d-flex align-center"},B={class:"text-h6"},R={class:"d-flex align-center"},Y={class:"text-h6"},O={class:"d-flex align-center"},j={class:"text-h6"},G={class:"d-flex align-center"},J={class:"text-h6"},K={class:"d-flex align-center"},Q={class:"text-h6"},W={class:"text-caption text-grey"},X={key:0},Z={class:"d-flex align-center"},$={class:"d-flex align-center"},tt={class:"d-flex align-center"},et={class:"d-flex align-center"},st={class:"d-flex"},lt={key:1,class:"text-grey"},ot=["title"],nt={key:0,class:"text-caption text-grey"},it={key:1},at={key:0},dt={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},rt={class:"text-caption text-grey"},ut={key:0},gt={key:0,class:"ml-2"},mt={key:1},ct={key:0,class:"d-flex align-center gap-2"},pt={class:"mb-3"},_t={class:"mb-3"},ft={key:1,class:"text-grey ml-2"},vt={class:"mb-3"},yt={class:"mb-3"},ht={class:"mb-3"},Lt={key:0,class:"text-grey ml-2"},bt={key:1,class:"text-grey ml-2"},kt={class:"mb-3"},wt={key:0,class:"ml-2"},xt={key:1,class:"text-grey ml-2"},Pt={class:"mb-2"};function St(l,t,Vt,zt,a,m){const p=g("v-icon"),f=g("v-card-text"),v=g("v-card"),c=g("v-col"),L=g("v-row"),P=g("v-select"),z=g("v-text-field"),S=g("v-card-title"),_=g("v-skeleton-loader"),y=g("v-chip"),b=g("v-btn"),C=g("v-table"),U=g("v-pagination"),A=g("v-textarea"),D=g("v-spacer"),F=g("v-card-actions"),I=g("v-dialog");return r(),u("div",null,[t[45]||(t[45]=e("div",{class:"page-header"},[e("h1",{class:"text-h4 page-title"},"Login Log Management")],-1)),s(L,{class:"mb-4"},{default:o(()=>[s(c,{cols:"12",md:"3"},{default:o(()=>[s(v,null,{default:o(()=>[s(f,null,{default:o(()=>[e("div",q,[s(p,{color:"primary",size:"40",class:"mr-3"},{default:o(()=>t[10]||(t[10]=[d("mdi-login")])),_:1,__:[10]}),e("div",null,[e("div",B,i(a.statistics.total||0),1),t[11]||(t[11]=e("div",{class:"text-caption text-grey"},"Total Logins",-1))])])]),_:1})]),_:1})]),_:1}),s(c,{cols:"12",md:"3"},{default:o(()=>[s(v,null,{default:o(()=>[s(f,null,{default:o(()=>[e("div",R,[s(p,{color:"success",size:"40",class:"mr-3"},{default:o(()=>t[12]||(t[12]=[d("mdi-check-circle")])),_:1,__:[12]}),e("div",null,[e("div",Y,i(a.statistics.successful||0),1),t[13]||(t[13]=e("div",{class:"text-caption text-grey"},"Successful",-1))])])]),_:1})]),_:1})]),_:1}),s(c,{cols:"12",md:"3"},{default:o(()=>[s(v,null,{default:o(()=>[s(f,null,{default:o(()=>[e("div",O,[s(p,{color:"error",size:"40",class:"mr-3"},{default:o(()=>t[14]||(t[14]=[d("mdi-close-circle")])),_:1,__:[14]}),e("div",null,[e("div",j,i(a.statistics.failed||0),1),t[15]||(t[15]=e("div",{class:"text-caption text-grey"},"Failed",-1))])])]),_:1})]),_:1})]),_:1}),s(c,{cols:"12",md:"3"},{default:o(()=>[s(v,null,{default:o(()=>[s(f,null,{default:o(()=>[e("div",G,[s(p,{color:"info",size:"40",class:"mr-3"},{default:o(()=>t[16]||(t[16]=[d("mdi-account-group")])),_:1,__:[16]}),e("div",null,[e("div",J,i(a.statistics.unique_users||0),1),t[17]||(t[17]=e("div",{class:"text-caption text-grey"},"Unique Users",-1))])])]),_:1})]),_:1})]),_:1}),s(c,{cols:"12",md:"3"},{default:o(()=>[s(v,null,{default:o(()=>[s(f,null,{default:o(()=>[e("div",K,[s(p,{color:"purple",size:"40",class:"mr-3"},{default:o(()=>t[18]||(t[18]=[d("mdi-database")])),_:1,__:[18]}),e("div",null,[e("div",Q,i(l.pagination.total||0),1),t[19]||(t[19]=e("div",{class:"text-caption text-grey"},"Total Records",-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),s(v,{class:"mb-4"},{default:o(()=>[s(f,null,{default:o(()=>[s(L,null,{default:o(()=>[s(c,{cols:"12",md:"3"},{default:o(()=>[s(P,{modelValue:l.perPage,"onUpdate:modelValue":[t[0]||(t[0]=n=>l.perPage=n),m.onPerPageChange],items:l.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(c,{cols:"12",md:"3"},{default:o(()=>[s(P,{modelValue:a.statusFilter,"onUpdate:modelValue":[t[1]||(t[1]=n=>a.statusFilter=n),m.loadLogs],items:a.statusOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(c,{cols:"12",md:"6"},{default:o(()=>[s(z,{modelValue:l.search,"onUpdate:modelValue":[t[2]||(t[2]=n=>l.search=n),m.loadLogs],label:"Search (email, IP, user agent)","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(v,null,{default:o(()=>[s(S,{class:"d-flex justify-space-between align-center"},{default:o(()=>[t[21]||(t[21]=e("span",null,"Login Logs",-1)),e("span",W,[t[20]||(t[20]=d(" Total Records: ")),e("strong",null,i(l.pagination.total||0),1),a.logs.length>0?(r(),u("span",X," | Showing "+i((l.currentPage-1)*l.perPage+1)+" to "+i(Math.min(l.currentPage*l.perPage,l.pagination.total))+" of "+i(l.pagination.total),1)):h("",!0)])]),_:1,__:[21]}),s(f,null,{default:o(()=>[s(C,null,{default:o(()=>[e("thead",null,[e("tr",null,[e("th",{class:"sortable",onClick:t[3]||(t[3]=n=>m.onSort("email"))},[e("div",Z,[t[22]||(t[22]=d(" Email ")),s(p,{icon:l.getSortIcon("email"),size:"small",class:"ml-1"},null,8,["icon"])])]),t[26]||(t[26]=e("th",null,"User",-1)),e("th",{class:"sortable",onClick:t[4]||(t[4]=n=>m.onSort("ip_address"))},[e("div",$,[t[23]||(t[23]=d(" IP Address ")),s(p,{icon:l.getSortIcon("ip_address"),size:"small",class:"ml-1"},null,8,["icon"])])]),t[27]||(t[27]=e("th",null,"User Agent",-1)),e("th",{class:"sortable",onClick:t[5]||(t[5]=n=>m.onSort("status"))},[e("div",tt,[t[24]||(t[24]=d(" Status ")),s(p,{icon:l.getSortIcon("status"),size:"small",class:"ml-1"},null,8,["icon"])])]),t[28]||(t[28]=e("th",null,"Failure Reason",-1)),e("th",{class:"sortable",onClick:t[6]||(t[6]=n=>m.onSort("created_at"))},[e("div",et,[t[25]||(t[25]=d(" Date ")),s(p,{icon:l.getSortIcon("created_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),t[29]||(t[29]=e("th",null,"Actions",-1))])]),e("tbody",null,[l.loading?(r(),u(k,{key:0},V(5,n=>e("tr",{key:`skeleton-${n}`},[e("td",null,[s(_,{type:"text",width:"180"})]),e("td",null,[s(_,{type:"chip",width:"100",height:"24"})]),e("td",null,[s(_,{type:"chip",width:"120",height:"24"})]),e("td",null,[s(_,{type:"text",width:"200"})]),e("td",null,[s(_,{type:"chip",width:"80",height:"24"})]),e("td",null,[s(_,{type:"text",width:"120"})]),e("td",null,[s(_,{type:"text",width:"140"})]),e("td",null,[e("div",st,[s(_,{type:"button",width:"32",height:"32",class:"mr-1"}),s(_,{type:"button",width:"32",height:"32"})])])])),64)):(r(),u(k,{key:1},[(r(!0),u(k,null,V(a.logs,n=>(r(),u("tr",{key:n.id},[e("td",null,i(n.email),1),e("td",null,[n.user?(r(),w(y,{key:0,size:"small",color:"primary",variant:"text"},{default:o(()=>[d(i(n.user.name),1)]),_:2},1024)):(r(),u("span",lt,"-"))]),e("td",null,[s(y,{size:"small",variant:"outlined"},{default:o(()=>[d(i(n.ip_address||"-"),1)]),_:2},1024)]),e("td",null,[e("span",{class:"text-caption",title:n.user_agent},i(m.truncateText(n.user_agent,50)),9,ot)]),e("td",null,[s(y,{color:n.status==="success"?"success":"error",size:"small"},{default:o(()=>[d(i(n.status),1)]),_:2},1032,["color"])]),e("td",null,[n.failure_reason?(r(),u("span",nt,i(n.failure_reason),1)):(r(),u("span",it,"-"))]),e("td",null,i(m.formatDate(n.created_at)),1),e("td",null,[s(b,{size:"small",icon:"mdi-eye",onClick:E=>m.viewLog(n),variant:"text"},null,8,["onClick"]),s(b,{size:"small",icon:"mdi-delete",onClick:E=>m.deleteLog(n),variant:"text",color:"error"},null,8,["onClick"])])]))),128)),a.logs.length===0?(r(),u("tr",at,t[30]||(t[30]=[e("td",{colspan:"8",class:"text-center py-4"},"No login logs found",-1)]))):h("",!0)],64))])]),_:1}),e("div",dt,[e("div",rt,[a.logs.length>0&&l.pagination.total>0?(r(),u("span",ut,[t[31]||(t[31]=d(" Showing ")),e("strong",null,i((l.currentPage-1)*l.perPage+1),1),t[32]||(t[32]=d(" to ")),e("strong",null,i(Math.min(l.currentPage*l.perPage,l.pagination.total)),1),t[33]||(t[33]=d(" of ")),e("strong",null,i(l.pagination.total.toLocaleString()),1),t[34]||(t[34]=d(" records ")),l.pagination.last_page>1?(r(),u("span",gt," (Page "+i(l.currentPage)+" of "+i(l.pagination.last_page)+") ",1)):h("",!0)])):(r(),u("span",mt," No records found "))]),l.pagination.last_page>1?(r(),u("div",ct,[s(U,{modelValue:l.currentPage,"onUpdate:modelValue":[t[7]||(t[7]=n=>l.currentPage=n),m.loadLogs],length:l.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):h("",!0)])]),_:1})]),_:1}),s(I,{modelValue:a.viewDialog,"onUpdate:modelValue":t[9]||(t[9]=n=>a.viewDialog=n),"max-width":"700"},{default:o(()=>[a.selectedLog?(r(),w(v,{key:0},{default:o(()=>[s(S,null,{default:o(()=>t[35]||(t[35]=[d("Login Log Details")])),_:1,__:[35]}),s(f,null,{default:o(()=>[s(L,null,{default:o(()=>[s(c,{cols:"12",md:"6"},{default:o(()=>[e("div",pt,[t[36]||(t[36]=e("strong",null,"Email:",-1)),d(" "+i(a.selectedLog.email),1)]),e("div",_t,[t[37]||(t[37]=e("strong",null,"User:",-1)),a.selectedLog.user?(r(),w(y,{key:0,size:"small",color:"primary",variant:"text",class:"ml-2"},{default:o(()=>[d(i(a.selectedLog.user.name)+" ("+i(a.selectedLog.user.email)+") ",1)]),_:1})):(r(),u("span",ft,"-"))]),e("div",vt,[t[38]||(t[38]=e("strong",null,"Status:",-1)),s(y,{color:a.selectedLog.status==="success"?"success":"error",size:"small",class:"ml-2"},{default:o(()=>[d(i(a.selectedLog.status),1)]),_:1},8,["color"])])]),_:1}),s(c,{cols:"12",md:"6"},{default:o(()=>[e("div",yt,[t[39]||(t[39]=e("strong",null,"IP Address:",-1)),d(" "+i(a.selectedLog.ip_address||"-"),1)]),e("div",ht,[t[40]||(t[40]=e("strong",null,"Failure Reason:",-1)),a.selectedLog.failure_reason?(r(),u("span",Lt,i(a.selectedLog.failure_reason),1)):(r(),u("span",bt,"-"))]),e("div",kt,[t[41]||(t[41]=e("strong",null,"Logged In At:",-1)),a.selectedLog.logged_in_at?(r(),u("span",wt,i(m.formatDate(a.selectedLog.logged_in_at)),1)):(r(),u("span",xt,"-"))])]),_:1}),s(c,{cols:"12"},{default:o(()=>[t[42]||(t[42]=e("div",{class:"mb-2"},[e("strong",null,"User Agent:")],-1)),s(A,{value:a.selectedLog.user_agent||"-",readonly:"",variant:"outlined",density:"compact",rows:"3"},null,8,["value"])]),_:1,__:[42]}),s(c,{cols:"12"},{default:o(()=>[e("div",Pt,[t[43]||(t[43]=e("strong",null,"Created At:",-1)),d(" "+i(m.formatDate(a.selectedLog.created_at)),1)])]),_:1})]),_:1})]),_:1}),s(F,null,{default:o(()=>[s(D),s(b,{onClick:t[8]||(t[8]=n=>a.viewDialog=!1),variant:"text"},{default:o(()=>t[44]||(t[44]=[d("Close")])),_:1,__:[44]})]),_:1})]),_:1})):h("",!0)]),_:1},8,["modelValue"])])}const Dt=M(H,[["render",St],["__scopeId","data-v-772bcc8b"]]);export{Dt as default};
