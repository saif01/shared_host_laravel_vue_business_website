import{_ as L,d as g,a as s,b as t,w as i,f as c,r,h as _,t as d,F as M,e as B,c as k,m as q,g as v,o as u}from"./app-aVdZPH9_.js";import{a as j}from"./adminPaginationMixin-DN7Wb3ng.js";const G={mixins:[j],data(){return{categories:[],showDialog:!1,editingCategory:null,saving:!1,typeFilter:"product",publishedFilter:null,typeOptions:[{title:"Product",value:"product"},{title:"Service",value:"service"},{title:"Post",value:"post"},{title:"General",value:"general"}],publishedOptions:[{title:"Published",value:!0},{title:"Draft",value:!1}],form:{name:"",slug:"",type:"product",description:"",image:"",parent_id:null,order:0,published:!0},allCategories:[]}},computed:{parentCategoryOptions(){return this.allCategories.filter(l=>this.editingCategory&&l.id===this.editingCategory.id?!1:l.type===this.form.type).map(l=>({id:l.id,name:l.name,type:l.type}))}},async mounted(){await Promise.all([this.loadCategories(),this.loadAllCategories()])},methods:{async loadCategories(){try{this.loading=!0;const l=this.buildPaginationParams();this.search&&(l.search=this.search),this.typeFilter&&(l.type=this.typeFilter),this.publishedFilter!==null&&(l.published=this.publishedFilter);const e=await v.get("/api/v1/categories",{params:l,headers:this.getAuthHeaders()});this.categories=e.data.data||[],this.updatePagination(e.data)}catch(l){this.handleApiError(l,"Failed to load categories")}finally{this.loading=!1}},async loadAllCategories(){var l;try{const e=await v.get("/api/v1/categories",{params:{per_page:1e3},headers:this.getAuthHeaders()}).catch(()=>({data:{data:[]}}));this.allCategories=((l=e.data)==null?void 0:l.data)||[]}catch(e){console.error("Error loading all categories:",e),this.allCategories=[]}},openDialog(l=null){this.editingCategory=l,l?this.loadCategoryForEdit(l):this.resetForm(),this.showDialog=!0},async loadCategoryForEdit(l){try{const m=(await v.get(`/api/v1/categories/${l.id}`,{headers:this.getAuthHeaders()})).data;this.form={name:m.name||"",slug:m.slug||"",type:m.type||"product",description:m.description||"",image:m.image||"",parent_id:m.parent_id||null,order:m.order||0,published:m.published!==!1}}catch(e){this.handleApiError(e,"Failed to load category")}},resetForm(){this.form={name:"",slug:"",type:this.typeFilter||"product",description:"",image:"",parent_id:null,order:0,published:!0}},generateSlug(){this.form.name&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""))},async saveCategory(){const{valid:l}=await this.$refs.formRef.validate();if(!l){this.showError("Please fill in all required fields");return}try{this.saving=!0,this.editingCategory?(await v.put(`/api/v1/categories/${this.editingCategory.id}`,this.form,{headers:this.getAuthHeaders()}),this.showSuccess("Category updated successfully")):(await v.post("/api/v1/categories",this.form,{headers:this.getAuthHeaders()}),this.showSuccess("Category created successfully")),this.closeDialog(),await Promise.all([this.loadCategories(),this.loadAllCategories()])}catch(e){this.handleApiError(e,"Failed to save category")}finally{this.saving=!1}},editCategory(l){this.openDialog(l)},async deleteCategory(l){var e,m;if(confirm("Are you sure you want to delete this category? This action cannot be undone."))try{await v.delete(`/api/v1/categories/${l}`,{headers:this.getAuthHeaders()}),this.showSuccess("Category deleted successfully"),await Promise.all([this.loadCategories(),this.loadAllCategories()])}catch(S){const a=((m=(e=S.response)==null?void 0:e.data)==null?void 0:m.error)||"Error deleting category";this.showError(a)}},closeDialog(){this.showDialog=!1,this.editingCategory=null,this.resetForm(),this.$refs.formRef&&this.$refs.formRef.resetValidation()},onPerPageChange(){this.resetPagination(),this.loadCategories()},onSort(l){this.handleSort(l),this.loadCategories()}}},J={class:"page-header"},K={class:"text-caption text-grey"},Q={key:0},W={class:"d-flex align-center"},X={class:"d-flex align-center"},Y={class:"d-flex align-center"},Z={class:"d-flex align-center"},$={class:"font-weight-medium"},ee={key:0,class:"text-caption text-grey"},te={key:0,class:"text-body-2"},le={key:1,class:"text-caption text-grey"},oe={key:0},ie={class:"d-flex justify-space-between align-center mt-4"},ae={class:"text-caption text-grey"},se={key:0},re={key:1},ne={class:"text-h5 font-weight-bold"},de={key:0,class:"mt-2"};function ue(l,e,m,S,a,n){const f=r("v-btn"),y=r("v-select"),p=r("v-col"),C=r("v-text-field"),F=r("v-row"),b=r("v-card-text"),V=r("v-card"),U=r("v-card-title"),h=r("v-icon"),D=r("v-img"),A=r("v-avatar"),w=r("v-chip"),x=r("v-table"),z=r("v-pagination"),E=r("v-textarea"),N=r("v-list-item"),O=r("v-switch"),R=r("v-form"),I=r("v-spacer"),T=r("v-card-actions"),H=r("v-dialog");return u(),g("div",null,[s("div",J,[e[20]||(e[20]=s("h1",{class:"text-h4 page-title"},"Product Categories Management",-1)),t(f,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=o=>n.openDialog()),class:"add-button"},{default:i(()=>e[19]||(e[19]=[c("Create Category")])),_:1,__:[19]})]),t(V,{class:"mb-4"},{default:i(()=>[t(b,null,{default:i(()=>[t(F,null,{default:i(()=>[t(p,{cols:"12",md:"3"},{default:i(()=>[t(y,{modelValue:l.perPage,"onUpdate:modelValue":[e[1]||(e[1]=o=>l.perPage=o),n.onPerPageChange],items:l.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),t(p,{cols:"12",md:"3"},{default:i(()=>[t(y,{modelValue:a.typeFilter,"onUpdate:modelValue":[e[2]||(e[2]=o=>a.typeFilter=o),n.loadCategories],items:a.typeOptions,label:"Filter by Type","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),t(p,{cols:"12",md:"3"},{default:i(()=>[t(y,{modelValue:a.publishedFilter,"onUpdate:modelValue":[e[3]||(e[3]=o=>a.publishedFilter=o),n.loadCategories],items:a.publishedOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),t(p,{cols:"12",md:"3"},{default:i(()=>[t(C,{modelValue:l.search,"onUpdate:modelValue":[e[4]||(e[4]=o=>l.search=o),n.loadCategories],label:"Search categories","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(V,null,{default:i(()=>[t(U,{class:"d-flex justify-space-between align-center"},{default:i(()=>[e[22]||(e[22]=s("span",null,"Categories",-1)),s("span",K,[e[21]||(e[21]=c(" Total Records: ")),s("strong",null,d(l.pagination.total||0),1),a.categories.length>0?(u(),g("span",Q," | Showing "+d((l.currentPage-1)*l.perPage+1)+" to "+d(Math.min(l.currentPage*l.perPage,l.pagination.total))+" of "+d(l.pagination.total),1)):_("",!0)])]),_:1,__:[22]}),t(b,null,{default:i(()=>[t(x,null,{default:i(()=>[s("thead",null,[s("tr",null,[e[27]||(e[27]=s("th",null,"Image",-1)),s("th",{class:"sortable",onClick:e[5]||(e[5]=o=>n.onSort("name"))},[s("div",W,[e[23]||(e[23]=c(" Name ")),t(h,{icon:l.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[6]||(e[6]=o=>n.onSort("slug"))},[s("div",X,[e[24]||(e[24]=c(" Slug ")),t(h,{icon:l.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[28]||(e[28]=s("th",null,"Type",-1)),e[29]||(e[29]=s("th",null,"Parent",-1)),s("th",{class:"sortable",onClick:e[7]||(e[7]=o=>n.onSort("order"))},[s("div",Y,[e[25]||(e[25]=c(" Order ")),t(h,{icon:l.getSortIcon("order"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[8]||(e[8]=o=>n.onSort("published"))},[s("div",Z,[e[26]||(e[26]=c(" Status ")),t(h,{icon:l.getSortIcon("published"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[30]||(e[30]=s("th",null,"Actions",-1))])]),s("tbody",null,[(u(!0),g(M,null,B(a.categories,o=>(u(),g("tr",{key:o.id},[s("td",null,[o.image?(u(),k(A,{key:0,size:"40"},{default:i(()=>[t(D,{src:o.image,cover:""},null,8,["src"])]),_:2},1024)):(u(),k(A,{key:1,size:"40",color:"grey-lighten-2"},{default:i(()=>[t(h,{icon:"mdi-folder"})]),_:1}))]),s("td",null,[s("div",$,d(o.name),1),o.children&&o.children.length>0?(u(),g("div",ee,d(o.children.length)+" sub-category(ies) ",1)):_("",!0)]),s("td",null,[t(w,{size:"small",variant:"outlined"},{default:i(()=>[c(d(o.slug),1)]),_:2},1024)]),s("td",null,[t(w,{size:"small",color:"primary",variant:"tonal"},{default:i(()=>[c(d(o.type),1)]),_:2},1024)]),s("td",null,[o.parent?(u(),g("span",te,d(o.parent.name),1)):(u(),g("span",le,"Root"))]),s("td",null,d(o.order||0),1),s("td",null,[t(w,{color:o.published?"success":"error",size:"small"},{default:i(()=>[c(d(o.published?"Published":"Draft"),1)]),_:2},1032,["color"])]),s("td",null,[t(f,{size:"small",icon:"mdi-pencil",onClick:P=>n.editCategory(o),variant:"text",color:"primary"},null,8,["onClick"]),t(f,{size:"small",icon:"mdi-delete",onClick:P=>n.deleteCategory(o.id),variant:"text",color:"error"},null,8,["onClick"])])]))),128)),a.categories.length===0?(u(),g("tr",oe,e[31]||(e[31]=[s("td",{colspan:"8",class:"text-center py-4"},"No categories found",-1)]))):_("",!0)])]),_:1}),s("div",ie,[s("div",ae,[a.categories.length>0?(u(),g("span",se," Showing "+d((l.currentPage-1)*l.perPage+1)+" to "+d(Math.min(l.currentPage*l.perPage,l.pagination.total))+" of "+d(l.pagination.total)+" records ",1)):(u(),g("span",re,"No records found"))]),l.pagination.last_page>1?(u(),k(z,{key:0,modelValue:l.currentPage,"onUpdate:modelValue":[e[9]||(e[9]=o=>l.currentPage=o),n.loadCategories],length:l.pagination.last_page},null,8,["modelValue","length","onUpdate:modelValue"])):_("",!0)])]),_:1})]),_:1}),t(H,{modelValue:a.showDialog,"onUpdate:modelValue":e[18]||(e[18]=o=>a.showDialog=o),"max-width":"800",scrollable:"",persistent:""},{default:i(()=>[t(V,null,{default:i(()=>[t(U,{class:"d-flex align-center justify-space-between bg-primary text-white pa-4"},{default:i(()=>[s("span",ne,d(a.editingCategory?"Edit Category":"Create New Category"),1),t(f,{icon:"mdi-close",variant:"text",color:"white",onClick:n.closeDialog},null,8,["onClick"])]),_:1}),t(b,{class:"pa-6"},{default:i(()=>[t(R,{ref:"formRef"},{default:i(()=>[t(F,null,{default:i(()=>[t(p,{cols:"12"},{default:i(()=>[t(C,{modelValue:a.form.name,"onUpdate:modelValue":e[10]||(e[10]=o=>a.form.name=o),label:"Category Name *",variant:"outlined",rules:[o=>!!o||"Name is required"]},null,8,["modelValue","rules"])]),_:1}),t(p,{cols:"12",md:"6"},{default:i(()=>[t(C,{modelValue:a.form.slug,"onUpdate:modelValue":e[11]||(e[11]=o=>a.form.slug=o),label:"Slug *",variant:"outlined",hint:"URL-friendly version of name",rules:[o=>!!o||"Slug is required"]},{append:i(()=>[t(f,{icon:"mdi-refresh",size:"small",variant:"text",onClick:n.generateSlug},null,8,["onClick"])]),_:1},8,["modelValue","rules"])]),_:1}),t(p,{cols:"12",md:"6"},{default:i(()=>[t(y,{modelValue:a.form.type,"onUpdate:modelValue":e[12]||(e[12]=o=>a.form.type=o),items:a.typeOptions,label:"Type *",variant:"outlined",rules:[o=>!!o||"Type is required"]},null,8,["modelValue","items","rules"])]),_:1}),t(p,{cols:"12"},{default:i(()=>[t(E,{modelValue:a.form.description,"onUpdate:modelValue":e[13]||(e[13]=o=>a.form.description=o),label:"Description",variant:"outlined",rows:"3",hint:"Brief description of the category"},null,8,["modelValue"])]),_:1}),t(p,{cols:"12"},{default:i(()=>[t(C,{modelValue:a.form.image,"onUpdate:modelValue":e[14]||(e[14]=o=>a.form.image=o),label:"Image URL",variant:"outlined","prepend-inner-icon":"mdi-image",hint:"Category image URL"},null,8,["modelValue"]),a.form.image?(u(),g("div",de,[t(D,{src:a.form.image,"max-height":"150",contain:"",class:"rounded"},null,8,["src"])])):_("",!0)]),_:1}),t(p,{cols:"12",md:"6"},{default:i(()=>[t(y,{modelValue:a.form.parent_id,"onUpdate:modelValue":e[15]||(e[15]=o=>a.form.parent_id=o),items:n.parentCategoryOptions,"item-title":"name","item-value":"id",label:"Parent Category",variant:"outlined",clearable:"",hint:"Select parent category for hierarchical structure"},{item:i(({props:o,item:P})=>[t(N,q(o,{title:P.raw.name}),{prepend:i(()=>[t(h,{icon:"mdi-folder",class:"mr-2"})]),_:2},1040,["title"])]),_:1},8,["modelValue","items"])]),_:1}),t(p,{cols:"12",md:"6"},{default:i(()=>[t(C,{modelValue:a.form.order,"onUpdate:modelValue":e[16]||(e[16]=o=>a.form.order=o),modelModifiers:{number:!0},label:"Display Order",variant:"outlined",type:"number",hint:"Lower numbers appear first"},null,8,["modelValue"])]),_:1}),t(p,{cols:"12"},{default:i(()=>[t(O,{modelValue:a.form.published,"onUpdate:modelValue":e[17]||(e[17]=o=>a.form.published=o),label:"Published",color:"success"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(T,{class:"pa-4 bg-grey-lighten-4"},{default:i(()=>[t(I),t(f,{variant:"text",onClick:n.closeDialog},{default:i(()=>e[32]||(e[32]=[c("Cancel")])),_:1,__:[32]},8,["onClick"]),t(f,{color:"primary",variant:"flat",onClick:n.saveCategory,loading:a.saving},{default:i(()=>[c(d(a.editingCategory?"Update":"Create")+" Category ",1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const ge=L(G,[["render",ue],["__scopeId","data-v-390cdab3"]]);export{ge as default};
