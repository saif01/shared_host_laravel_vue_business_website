import{_ as j,d as p,a as o,b as l,w as n,f as u,r as d,c as P,h as y,F as G,e as C,t as r,i as H,j as L,g as k,o as m,n as R}from"./app-aVdZPH9_.js";import{a as K}from"./adminPaginationMixin-DN7Wb3ng.js";const T={mixins:[K],data(){return{permissions:[],groupedPermissions:{},groups:[],dialog:!1,editingPermission:null,viewMode:"flat",searchQuery:"",selectedGroup:null,newGroup:"",form:{name:"",slug:"",group:"",description:""},rules:{required:s=>!!s||"This field is required"}}},async mounted(){await this.loadGroups(),await this.loadPermissions()},methods:{async loadPermissions(){try{this.loading=!0;const s={};this.searchQuery&&(s.search=this.searchQuery),this.selectedGroup&&(s.group=this.selectedGroup),this.viewMode==="grouped"?s.grouped=!0:(s.page=this.currentPage,s.per_page=this.perPage);const e=await k.get("/api/v1/permissions",{params:s,headers:this.getAuthHeaders()});this.viewMode==="grouped"?(this.groupedPermissions=e.data,this.permissions=[],Object.values(e.data).forEach(c=>{this.permissions.push(...c)}),this.pagination={current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length}):(e.data.data?(this.permissions=e.data.data||[],this.pagination={current_page:e.data.current_page,last_page:e.data.last_page,per_page:e.data.per_page,total:e.data.total}):(this.permissions=e.data||[],this.pagination={current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length}),this.groupedPermissions={},this.permissions.forEach(c=>{this.groupedPermissions[c.group]||(this.groupedPermissions[c.group]=[]),this.groupedPermissions[c.group].push(c)}))}catch(s){this.handleApiError(s,"Failed to load permissions")}finally{this.loading=!1}},async loadGroups(){try{const s=await k.get("/api/v1/permissions/groups",{headers:this.getAuthHeaders()});s.data&&s.data.length>0?typeof s.data[0]=="string"?this.groups=s.data.map(e=>({name:e,permissions_count:0})):this.groups=s.data:this.groups=[]}catch(s){console.error("Error loading groups:",s),this.groups=[]}},openDialog(s){s?(this.editingPermission=s,this.form={name:s.name,slug:s.slug,group:s.group,description:s.description||""}):(this.editingPermission=null,this.form={name:"",slug:"",group:"",description:""}),this.dialog=!0},closeDialog(){this.dialog=!1,this.editingPermission=null,this.form={name:"",slug:"",group:"",description:""},this.$refs.permissionForm&&this.$refs.permissionForm.resetValidation()},autoGenerateSlugFromName(){!this.form.slug&&this.form.name&&!this.editingPermission&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))},addNewGroup(){if(this.newGroup&&!this.groups.find(s=>s.name===this.newGroup||typeof s=="string"&&s===this.newGroup)){const s=this.newGroup.trim();this.groups.push({name:s,permissions_count:0}),this.form.group=s,this.newGroup=""}},async savePermission(){if(!this.$refs.permissionForm){this.showError("Form reference not found");return}if(this.$refs.permissionForm.validate()){!this.form.slug&&this.form.name&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")),this.saving=!0;try{const s=this.editingPermission?`/api/v1/permissions/${this.editingPermission.id}`:"/api/v1/permissions",e=this.editingPermission?"put":"post",c={name:this.form.name.trim(),slug:this.form.slug?this.form.slug.trim():null,group:this.form.group.trim(),description:this.form.description?this.form.description.trim():null};await k[e](s,c,{headers:this.getAuthHeaders()}),this.showSuccess(this.editingPermission?"Permission updated successfully":"Permission created successfully"),this.closeDialog(),await this.loadGroups(),await this.loadPermissions()}catch(s){this.handleApiError(s,"Error saving permission")}finally{this.saving=!1}}},async deletePermission(s){if((s.roles_count||0)>0){this.showError("Cannot delete permission that is assigned to roles. Please remove it from all roles first.");return}if(confirm(`Are you sure you want to delete the permission "${s.name}"?`))try{await k.delete(`/api/v1/permissions/${s.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Permission deleted successfully"),await this.loadPermissions()}catch(e){this.handleApiError(e,"Error deleting permission")}},getGroupColor(s){return{general:"primary",content:"success",users:"info",leads:"warning",careers:"purple",settings:"orange",system:"error"}[s]||"grey"},onPerPageChange(){this.resetPagination(),this.loadPermissions()},onSort(s){this.handleSort(s),this.loadPermissions()},filterByGroup(s){this.selectedGroup===s?this.clearGroupFilter():(this.selectedGroup=s,this.resetPagination(),this.loadPermissions())},clearGroupFilter(){this.selectedGroup=null,this.resetPagination(),this.loadPermissions()}},watch:{viewMode(){this.currentPage=1,this.loadPermissions()}}},O={class:"page-header"},J={class:"d-flex align-center flex-wrap",style:{gap:"8px"}},W={class:"text-caption text-grey"},X={key:0},Y={key:0},Z={class:"text-h6 mb-3"},$={class:"d-flex align-center"},ee={class:"d-flex align-center"},se={class:"font-weight-medium"},te={class:"text-caption text-grey"},le={class:"d-flex align-center"},oe={class:"d-flex align-center"},ie={class:"d-flex align-center"},ne={class:"font-weight-medium"},re={class:"text-caption text-grey"},ae={key:0},ue={key:2,class:"d-flex justify-space-between align-center mt-4"},de={class:"text-caption text-grey"},me={key:0},pe={key:1};function ge(s,e,c,ce,i,a){const f=d("v-btn"),S=d("v-select"),z=d("v-col"),w=d("v-text-field"),M=d("v-row"),b=d("v-card-text"),V=d("v-card"),v=d("v-icon"),N=d("v-btn-toggle"),h=d("v-chip"),x=d("v-card-title"),F=d("v-table"),U=d("v-pagination"),A=d("v-list-item"),D=d("v-textarea"),E=d("v-form"),B=d("v-spacer"),q=d("v-card-actions"),I=d("v-dialog");return m(),p("div",null,[o("div",O,[e[18]||(e[18]=o("h1",{class:"text-h4 page-title"},"Permission Management",-1)),l(f,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=t=>a.openDialog(null)),class:"add-button"},{default:n(()=>e[17]||(e[17]=[u(" Add New Permission ")])),_:1,__:[17]})]),l(V,{class:"mb-4"},{default:n(()=>[l(b,null,{default:n(()=>[l(M,null,{default:n(()=>[i.viewMode==="flat"?(m(),P(z,{key:0,cols:"12",md:"4"},{default:n(()=>[l(S,{modelValue:s.perPage,"onUpdate:modelValue":[e[1]||(e[1]=t=>s.perPage=t),a.onPerPageChange],items:s.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1})):y("",!0),l(z,{cols:"12",md:i.viewMode==="flat"?4:6},{default:n(()=>[l(S,{modelValue:i.selectedGroup,"onUpdate:modelValue":[e[2]||(e[2]=t=>i.selectedGroup=t),a.loadPermissions],items:i.groups,"item-title":t=>typeof t=="string"?t:t.name,"item-value":t=>typeof t=="string"?t:t.name,label:"Filter by Group","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","item-title","item-value","onUpdate:modelValue"])]),_:1},8,["md"]),l(z,{cols:"12",md:i.viewMode==="flat"?4:6},{default:n(()=>[l(w,{modelValue:i.searchQuery,"onUpdate:modelValue":[e[3]||(e[3]=t=>i.searchQuery=t),a.loadPermissions],label:"Search permissions","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["md"])]),_:1})]),_:1})]),_:1}),l(V,{class:"mb-4"},{default:n(()=>[l(b,{class:"py-3"},{default:n(()=>[o("div",J,[l(N,{modelValue:i.viewMode,"onUpdate:modelValue":e[4]||(e[4]=t=>i.viewMode=t),mandatory:"",density:"compact",class:"mr-4"},{default:n(()=>[l(f,{value:"flat",size:"small"},{default:n(()=>[l(v,{start:""},{default:n(()=>e[19]||(e[19]=[u("mdi-format-list-bulleted")])),_:1,__:[19]}),e[20]||(e[20]=u(" Flat View "))]),_:1,__:[20]}),l(f,{value:"grouped",size:"small"},{default:n(()=>[l(v,{start:""},{default:n(()=>e[21]||(e[21]=[u("mdi-folder")])),_:1,__:[21]}),e[22]||(e[22]=u(" Grouped View "))]),_:1,__:[22]})]),_:1},8,["modelValue"]),e[24]||(e[24]=o("span",{class:"text-caption text-grey mr-2"},"Filter by Group:",-1)),(m(!0),p(G,null,C(i.groups,t=>(m(),P(h,{key:t.name,color:a.getGroupColor(t.name),size:"small",variant:i.selectedGroup===t.name?"flat":"outlined",class:R([{"font-weight-bold":i.selectedGroup===t.name},"group-filter-chip"]),onClick:_=>a.filterByGroup(t.name),style:{cursor:"pointer"}},{default:n(()=>[u(r(t.name)+" ",1),l(h,{size:"x-small",color:i.selectedGroup===t.name?"white":a.getGroupColor(t.name),variant:"flat",class:"ml-2"},{default:n(()=>[u(r(t.permissions_count||0),1)]),_:2},1032,["color"])]),_:2},1032,["color","variant","class","onClick"]))),128)),i.selectedGroup?(m(),P(h,{key:0,size:"small",color:"grey",variant:"text","prepend-icon":"mdi-close",onClick:a.clearGroupFilter,style:{cursor:"pointer"},class:"ml-2"},{default:n(()=>e[23]||(e[23]=[u(" Clear Filter ")])),_:1,__:[23]},8,["onClick"])):y("",!0)])]),_:1})]),_:1}),l(V,null,{default:n(()=>[l(x,{class:"d-flex justify-space-between align-center"},{default:n(()=>[e[26]||(e[26]=o("span",null,"Permissions",-1)),o("span",W,[e[25]||(e[25]=u(" Total Records: ")),o("strong",null,r(s.pagination.total||0),1),i.permissions.length>0&&i.viewMode==="flat"?(m(),p("span",X," | Showing "+r((s.currentPage-1)*s.perPage+1)+" to "+r(Math.min(s.currentPage*s.perPage,s.pagination.total))+" of "+r(s.pagination.total),1)):y("",!0)])]),_:1,__:[26]}),l(b,null,{default:n(()=>[i.viewMode==="grouped"?(m(),p("div",Y,[(m(!0),p(G,null,C(i.groupedPermissions,(t,_)=>(m(),p("div",{key:_,class:"mb-6"},[o("h3",Z,[u(r(_.charAt(0).toUpperCase()+_.slice(1))+" ",1),l(h,{size:"small",color:"primary",variant:"text",class:"ml-2"},{default:n(()=>[u(r(t.length)+" permission"+r(t.length!==1?"s":""),1)]),_:2},1024)]),l(F,null,{default:n(()=>[o("thead",null,[o("tr",null,[o("th",{class:"sortable",onClick:e[5]||(e[5]=g=>a.onSort("name"))},[o("div",$,[e[27]||(e[27]=u(" Name ")),l(v,{icon:s.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),o("th",{class:"sortable",onClick:e[6]||(e[6]=g=>a.onSort("slug"))},[o("div",ee,[e[28]||(e[28]=u(" Slug ")),l(v,{icon:s.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[29]||(e[29]=o("th",null,"Description",-1)),e[30]||(e[30]=o("th",null,"Roles",-1)),e[31]||(e[31]=o("th",null,"Actions",-1))])]),o("tbody",null,[(m(!0),p(G,null,C(t,g=>(m(),p("tr",{key:g.id},[o("td",null,[o("div",se,r(g.name),1)]),o("td",null,[l(h,{size:"small",variant:"outlined"},{default:n(()=>[u(r(g.slug),1)]),_:2},1024)]),o("td",null,[o("span",te,r(g.description||"No description"),1)]),o("td",null,[l(h,{size:"small",color:"info",variant:"text"},{default:n(()=>[u(r(g.roles_count||0)+" role"+r((g.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),o("td",null,[l(f,{size:"small",icon:"mdi-pencil",onClick:Q=>a.openDialog(g),variant:"text"},null,8,["onClick"]),l(f,{size:"small",icon:"mdi-delete",onClick:Q=>a.deletePermission(g),variant:"text",color:"error",disabled:(g.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128))])]),_:2},1024)]))),128))])):(m(),P(F,{key:1},{default:n(()=>[o("thead",null,[o("tr",null,[o("th",{class:"sortable",onClick:e[7]||(e[7]=t=>a.onSort("name"))},[o("div",le,[e[32]||(e[32]=u(" Name ")),l(v,{icon:s.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),o("th",{class:"sortable",onClick:e[8]||(e[8]=t=>a.onSort("slug"))},[o("div",oe,[e[33]||(e[33]=u(" Slug ")),l(v,{icon:s.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),o("th",{class:"sortable",onClick:e[9]||(e[9]=t=>a.onSort("group"))},[o("div",ie,[e[34]||(e[34]=u(" Group ")),l(v,{icon:s.getSortIcon("group"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[35]||(e[35]=o("th",null,"Description",-1)),e[36]||(e[36]=o("th",null,"Roles",-1)),e[37]||(e[37]=o("th",null,"Actions",-1))])]),o("tbody",null,[(m(!0),p(G,null,C(i.permissions,t=>(m(),p("tr",{key:t.id},[o("td",null,[o("div",ne,r(t.name),1)]),o("td",null,[l(h,{size:"small",variant:"outlined"},{default:n(()=>[u(r(t.slug),1)]),_:2},1024)]),o("td",null,[l(h,{size:"small",color:a.getGroupColor(t.group)},{default:n(()=>[u(r(t.group),1)]),_:2},1032,["color"])]),o("td",null,[o("span",re,r(t.description||"No description"),1)]),o("td",null,[l(h,{size:"small",color:"info",variant:"text"},{default:n(()=>[u(r(t.roles_count||0)+" role"+r((t.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),o("td",null,[l(f,{size:"small",icon:"mdi-pencil",onClick:_=>a.openDialog(t),variant:"text"},null,8,["onClick"]),l(f,{size:"small",icon:"mdi-delete",onClick:_=>a.deletePermission(t),variant:"text",color:"error",disabled:(t.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128)),i.permissions.length===0?(m(),p("tr",ae,e[38]||(e[38]=[o("td",{colspan:"6",class:"text-center py-4"},"No permissions found",-1)]))):y("",!0)])]),_:1})),i.viewMode==="flat"?(m(),p("div",ue,[o("div",de,[i.permissions.length>0?(m(),p("span",me," Showing "+r((s.currentPage-1)*s.perPage+1)+" to "+r(Math.min(s.currentPage*s.perPage,s.pagination.total))+" of "+r(s.pagination.total)+" records ",1)):(m(),p("span",pe," No records found "))]),s.pagination.last_page>1?(m(),P(U,{key:0,modelValue:s.currentPage,"onUpdate:modelValue":[e[10]||(e[10]=t=>s.currentPage=t),a.loadPermissions],length:s.pagination.last_page},null,8,["modelValue","length","onUpdate:modelValue"])):y("",!0)])):y("",!0)]),_:1})]),_:1}),l(I,{modelValue:i.dialog,"onUpdate:modelValue":e[16]||(e[16]=t=>i.dialog=t),"max-width":"600",persistent:""},{default:n(()=>[l(V,null,{default:n(()=>[l(x,null,{default:n(()=>[u(r(i.editingPermission?"Edit Permission":"Add New Permission"),1)]),_:1}),l(b,null,{default:n(()=>[l(E,{ref:"permissionForm",onSubmit:H(a.savePermission,["prevent"])},{default:n(()=>[l(w,{modelValue:i.form.name,"onUpdate:modelValue":e[11]||(e[11]=t=>i.form.name=t),label:"Permission Name",rules:[i.rules.required],required:"",hint:"Display name for the permission (e.g., 'Manage Pages')","persistent-hint":"",class:"mb-4",onBlur:a.autoGenerateSlugFromName},null,8,["modelValue","rules","onBlur"]),l(w,{modelValue:i.form.slug,"onUpdate:modelValue":e[12]||(e[12]=t=>i.form.slug=t),label:"Slug",hint:"URL-friendly identifier (auto-generated if empty)","persistent-hint":"",class:"mb-4"},null,8,["modelValue"]),l(S,{modelValue:i.form.group,"onUpdate:modelValue":e[14]||(e[14]=t=>i.form.group=t),items:i.groups,"item-title":t=>typeof t=="string"?t:t.name,"item-value":t=>typeof t=="string"?t:t.name,label:"Group",rules:[i.rules.required],required:"",hint:"Category/group for organizing permissions","persistent-hint":"",class:"mb-4"},{"append-item":n(()=>[l(A,null,{default:n(()=>[l(w,{modelValue:i.newGroup,"onUpdate:modelValue":e[13]||(e[13]=t=>i.newGroup=t),label:"Add New Group","prepend-inner-icon":"mdi-plus",variant:"outlined",density:"compact",onKeyup:L(a.addNewGroup,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["modelValue","items","item-title","item-value","rules"]),l(D,{modelValue:i.form.description,"onUpdate:modelValue":e[15]||(e[15]=t=>i.form.description=t),label:"Description",hint:"Brief description of what this permission allows","persistent-hint":"",rows:"2",class:"mb-4"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),l(q,null,{default:n(()=>[l(B),l(f,{onClick:a.closeDialog,variant:"text"},{default:n(()=>e[39]||(e[39]=[u("Cancel")])),_:1,__:[39]},8,["onClick"]),l(f,{onClick:a.savePermission,color:"primary",loading:s.saving},{default:n(()=>[u(r(i.editingPermission?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const ve=j(T,[["render",ge]]);export{ve as default};
