import{_ as E,d as m,a as s,b as l,w as i,f as d,r as u,h as y,t as r,F as z,e as N,c as g,g as f,o as c}from"./app-iP0VSsOb.js";import{a as I}from"./adminPaginationMixin-DN7Wb3ng.js";const H={mixins:[I],data(){return{subscriptions:[],statusFilter:null,showDialog:!1,selectedSubscription:null,showDeleteDialog:!1,subscriptionToDelete:null,statusOptions:[{title:"Active",value:"active"},{title:"Unsubscribed",value:"unsubscribed"}]}},async mounted(){await this.loadSubscriptions()},methods:{onSort(t){this.handleSort(t),this.loadSubscriptions()},async loadSubscriptions(){try{this.loading=!0;const t=this.buildPaginationParams();this.search&&(t.search=this.search),this.statusFilter&&(t.status=this.statusFilter);const e=await f.get("/api/v1/newsletters",{params:t,headers:this.getAuthHeaders()});this.subscriptions=e.data.data||[],this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load subscriptions")}finally{this.loading=!1}},async viewSubscription(t){try{const e=await f.get(`/api/v1/newsletters/${t.id}`,{headers:this.getAuthHeaders()});this.selectedSubscription=e.data,this.showDialog=!0}catch(e){this.handleApiError(e,"Failed to load subscription details")}},closeDialog(){this.showDialog=!1,this.selectedSubscription=null},async unsubscribe(t){try{this.saving=!0,await f.put(`/api/v1/newsletters/${t.id}`,{status:"unsubscribed"},{headers:this.getAuthHeaders()}),this.showSuccess("Subscription updated successfully"),await this.loadSubscriptions()}catch(e){this.handleApiError(e,"Failed to unsubscribe")}finally{this.saving=!1}},async resubscribe(t){try{this.saving=!0,await f.put(`/api/v1/newsletters/${t.id}`,{status:"active"},{headers:this.getAuthHeaders()}),this.showSuccess("Subscription reactivated successfully"),await this.loadSubscriptions()}catch(e){this.handleApiError(e,"Failed to resubscribe")}finally{this.saving=!1}},async unsubscribeFromDialog(){this.selectedSubscription&&(await this.unsubscribe(this.selectedSubscription),this.closeDialog())},async resubscribeFromDialog(){this.selectedSubscription&&(await this.resubscribe(this.selectedSubscription),this.closeDialog())},confirmDelete(t){this.subscriptionToDelete=t,this.showDeleteDialog=!0},async deleteSubscription(){if(this.subscriptionToDelete)try{this.saving=!0,await f.delete(`/api/v1/newsletters/${this.subscriptionToDelete.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Subscription deleted successfully"),this.showDeleteDialog=!1,this.subscriptionToDelete=null,await this.loadSubscriptions()}catch(t){this.handleApiError(t,"Failed to delete subscription")}finally{this.saving=!1}},async exportSubscriptions(){try{const t=await f.get("/api/v1/newsletters/export/csv",{headers:this.getAuthHeaders(),responseType:"blob"}),e=window.URL.createObjectURL(new Blob([t.data])),v=document.createElement("a");v.href=e,v.setAttribute("download",`newsletter_subscriptions_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(v),v.click(),v.remove(),this.showSuccess("Subscriptions exported successfully")}catch(t){this.handleApiError(t,"Failed to export subscriptions")}},getStatusColor(t){switch(t){case"active":return"success";case"unsubscribed":return"error";default:return"grey"}}}},j={class:"d-flex justify-space-between align-center mb-6"},B={class:"text-caption text-grey"},O={key:0},R={class:"d-flex align-center"},L={class:"d-flex align-center"},M={class:"d-flex align-center"},q={class:"d-flex align-center"},G=["href"],J={key:0},K={class:"d-flex justify-space-between align-center mt-4"},Q={class:"text-caption text-grey"},W={key:0},X={key:1},Y={class:"d-flex align-center"},Z={class:"mb-4"},$={class:"text-body-1"},ee=["href"],te={class:"mb-4"},se={class:"text-body-1"},le={class:"mb-4"},ie={class:"text-body-2"},oe={class:"mb-4"},ne={class:"text-body-2"},ae={class:"mb-4"},re={class:"text-body-2"};function de(t,e,v,ue,n,a){const b=u("v-btn"),k=u("v-select"),p=u("v-col"),F=u("v-text-field"),C=u("v-row"),_=u("v-card-text"),S=u("v-card"),w=u("v-card-title"),h=u("v-icon"),x=u("v-chip"),U=u("v-table"),T=u("v-pagination"),V=u("v-spacer"),A=u("v-card-actions"),P=u("v-dialog");return c(),m("div",null,[s("div",j,[e[12]||(e[12]=s("h1",{class:"text-h4"},"Newsletter Subscriptions",-1)),l(b,{color:"primary","prepend-icon":"mdi-download",onClick:a.exportSubscriptions},{default:i(()=>e[11]||(e[11]=[d("Export to CSV")])),_:1,__:[11]},8,["onClick"])]),l(S,{class:"mb-4"},{default:i(()=>[l(_,null,{default:i(()=>[l(C,null,{default:i(()=>[l(p,{cols:"12",md:"3"},{default:i(()=>[l(k,{modelValue:t.perPage,"onUpdate:modelValue":[e[0]||(e[0]=o=>t.perPage=o),t.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(p,{cols:"12",md:"3"},{default:i(()=>[l(k,{modelValue:n.statusFilter,"onUpdate:modelValue":[e[1]||(e[1]=o=>n.statusFilter=o),a.loadSubscriptions],items:n.statusOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(p,{cols:"12",md:"6"},{default:i(()=>[l(F,{modelValue:t.search,"onUpdate:modelValue":[e[2]||(e[2]=o=>t.search=o),a.loadSubscriptions],label:"Search by email","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(S,null,{default:i(()=>[l(w,{class:"d-flex justify-space-between align-center"},{default:i(()=>[e[14]||(e[14]=s("span",null,"Subscriptions",-1)),s("span",B,[e[13]||(e[13]=d(" Total Records: ")),s("strong",null,r(t.pagination.total||0),1),n.subscriptions.length>0?(c(),m("span",O," | Showing "+r((t.currentPage-1)*t.perPage+1)+" to "+r(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+r(t.pagination.total),1)):y("",!0)])]),_:1,__:[14]}),l(_,null,{default:i(()=>[l(U,null,{default:i(()=>[s("thead",null,[s("tr",null,[s("th",{class:"sortable",onClick:e[3]||(e[3]=o=>a.onSort("email"))},[s("div",R,[e[15]||(e[15]=d(" Email ")),l(h,{icon:t.getSortIcon("email"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[4]||(e[4]=o=>a.onSort("status"))},[s("div",L,[e[16]||(e[16]=d(" Status ")),l(h,{icon:t.getSortIcon("status"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[5]||(e[5]=o=>a.onSort("subscribed_at"))},[s("div",M,[e[17]||(e[17]=d(" Subscribed At ")),l(h,{icon:t.getSortIcon("subscribed_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[6]||(e[6]=o=>a.onSort("unsubscribed_at"))},[s("div",q,[e[18]||(e[18]=d(" Unsubscribed At ")),l(h,{icon:t.getSortIcon("unsubscribed_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[19]||(e[19]=s("th",null,"Actions",-1))])]),s("tbody",null,[(c(!0),m(z,null,N(n.subscriptions,o=>(c(),m("tr",{key:o.id},[s("td",null,[s("a",{href:`mailto:${o.email}`,class:"text-primary text-decoration-none"},r(o.email),9,G)]),s("td",null,[l(x,{color:a.getStatusColor(o.status),size:"small"},{default:i(()=>[d(r(o.status),1)]),_:2},1032,["color"])]),s("td",null,r(t.formatDate(o.subscribed_at)),1),s("td",null,r(o.unsubscribed_at?t.formatDate(o.unsubscribed_at):"-"),1),s("td",null,[l(b,{size:"small",icon:"mdi-eye",onClick:D=>a.viewSubscription(o),variant:"text",class:"mr-1",title:"View Details"},null,8,["onClick"]),o.status==="active"?(c(),g(b,{key:0,size:"small",icon:"mdi-email-remove",onClick:D=>a.unsubscribe(o),variant:"text",color:"error",title:"Unsubscribe"},null,8,["onClick"])):(c(),g(b,{key:1,size:"small",icon:"mdi-email-check",onClick:D=>a.resubscribe(o),variant:"text",color:"success",title:"Resubscribe"},null,8,["onClick"])),l(b,{size:"small",icon:"mdi-delete",onClick:D=>a.confirmDelete(o),variant:"text",color:"error",class:"ml-1",title:"Delete"},null,8,["onClick"])])]))),128)),n.subscriptions.length===0&&!t.loading?(c(),m("tr",J,e[20]||(e[20]=[s("td",{colspan:"5",class:"text-center py-4"},"No subscriptions found",-1)]))):y("",!0)])]),_:1}),s("div",K,[s("div",Q,[n.subscriptions.length>0?(c(),m("span",W," Showing "+r((t.currentPage-1)*t.perPage+1)+" to "+r(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+r(t.pagination.total)+" records ",1)):(c(),m("span",X," No records found "))]),t.pagination.last_page>1?(c(),g(T,{key:0,modelValue:t.currentPage,"onUpdate:modelValue":[e[7]||(e[7]=o=>t.currentPage=o),a.loadSubscriptions],length:t.pagination.last_page},null,8,["modelValue","length","onUpdate:modelValue"])):y("",!0)])]),_:1})]),_:1}),l(P,{modelValue:n.showDialog,"onUpdate:modelValue":e[8]||(e[8]=o=>n.showDialog=o),"max-width":"600",scrollable:""},{default:i(()=>[n.selectedSubscription?(c(),g(S,{key:0},{default:i(()=>[l(w,{class:"d-flex justify-space-between align-center bg-primary text-white"},{default:i(()=>[s("div",Y,[l(h,{icon:"mdi-email",class:"mr-2"}),e[21]||(e[21]=s("span",null,"Subscription Details",-1))]),l(b,{icon:"mdi-close",variant:"text",onClick:a.closeDialog,color:"white"},null,8,["onClick"])]),_:1}),l(_,{class:"pa-6"},{default:i(()=>[l(C,null,{default:i(()=>[l(p,{cols:"12"},{default:i(()=>[s("div",Z,[e[22]||(e[22]=s("div",{class:"text-caption text-grey mb-1"},"Email",-1)),s("div",$,[s("a",{href:`mailto:${n.selectedSubscription.email}`,class:"text-primary text-decoration-none"},r(n.selectedSubscription.email),9,ee)])])]),_:1}),l(p,{cols:"12",md:"6"},{default:i(()=>[s("div",te,[e[23]||(e[23]=s("div",{class:"text-caption text-grey mb-1"},"Status",-1)),s("div",se,[l(x,{color:a.getStatusColor(n.selectedSubscription.status),size:"small"},{default:i(()=>[d(r(n.selectedSubscription.status),1)]),_:1},8,["color"])])])]),_:1}),l(p,{cols:"12",md:"6"},{default:i(()=>[s("div",le,[e[24]||(e[24]=s("div",{class:"text-caption text-grey mb-1"},"Subscribed At",-1)),s("div",ie,r(t.formatDateTime(n.selectedSubscription.subscribed_at)),1)])]),_:1}),n.selectedSubscription.unsubscribed_at?(c(),g(p,{key:0,cols:"12",md:"6"},{default:i(()=>[s("div",oe,[e[25]||(e[25]=s("div",{class:"text-caption text-grey mb-1"},"Unsubscribed At",-1)),s("div",ne,r(t.formatDateTime(n.selectedSubscription.unsubscribed_at)),1)])]),_:1})):y("",!0),l(p,{cols:"12",md:"6"},{default:i(()=>[s("div",ae,[e[26]||(e[26]=s("div",{class:"text-caption text-grey mb-1"},"Created At",-1)),s("div",re,r(t.formatDateTime(n.selectedSubscription.created_at)),1)])]),_:1})]),_:1})]),_:1}),l(A,{class:"pa-4 bg-grey-lighten-5"},{default:i(()=>[l(V),n.selectedSubscription.status==="active"?(c(),g(b,{key:0,color:"error","prepend-icon":"mdi-email-remove",onClick:a.unsubscribeFromDialog},{default:i(()=>e[27]||(e[27]=[d(" Unsubscribe ")])),_:1,__:[27]},8,["onClick"])):(c(),g(b,{key:1,color:"success","prepend-icon":"mdi-email-check",onClick:a.resubscribeFromDialog},{default:i(()=>e[28]||(e[28]=[d(" Resubscribe ")])),_:1,__:[28]},8,["onClick"])),l(b,{color:"grey",variant:"text",onClick:a.closeDialog},{default:i(()=>e[29]||(e[29]=[d("Close")])),_:1,__:[29]},8,["onClick"])]),_:1})]),_:1})):y("",!0)]),_:1},8,["modelValue"]),l(P,{modelValue:n.showDeleteDialog,"onUpdate:modelValue":e[10]||(e[10]=o=>n.showDeleteDialog=o),"max-width":"400"},{default:i(()=>[l(S,null,{default:i(()=>[l(w,{class:"text-h6"},{default:i(()=>e[30]||(e[30]=[d("Confirm Delete")])),_:1,__:[30]}),l(_,null,{default:i(()=>{var o;return[e[31]||(e[31]=d(" Are you sure you want to delete the subscription for ")),s("strong",null,r((o=n.subscriptionToDelete)==null?void 0:o.email),1),e[32]||(e[32]=d("? This action cannot be undone. "))]}),_:1,__:[31,32]}),l(A,null,{default:i(()=>[l(V),l(b,{color:"grey",variant:"text",onClick:e[9]||(e[9]=o=>n.showDeleteDialog=!1)},{default:i(()=>e[33]||(e[33]=[d("Cancel")])),_:1,__:[33]}),l(b,{color:"error",onClick:a.deleteSubscription,loading:t.saving},{default:i(()=>e[34]||(e[34]=[d("Delete")])),_:1,__:[34]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const pe=E(H,[["render",de],["__scopeId","data-v-de50eb9b"]]);export{pe as default};
