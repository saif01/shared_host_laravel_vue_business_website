import{_ as T,c,g as r,a as l,w as o,r as a,b,o as u,d,f as v,h as w,F as A,e as D,t as g,i as j}from"./app-lD5pKros.js";import{a as G}from"./adminPaginationMixin-DN7Wb3ng.js";const J={mixins:[G],data(){return{roles:[],permissions:[],groupedPermissions:{},dialog:!1,permissionDialog:!1,editingRole:null,selectedRole:null,loadingPermissions:!1,savingPermissions:!1,selectedPermissions:[],activeFilter:null,activeOptions:[{title:"Active",value:!0},{title:"Inactive",value:!1}],form:{name:"",slug:"",description:"",is_active:!0,order:0},rules:{required:s=>!!s||"This field is required"},autoGeneratingSlug:!1}},async mounted(){await this.loadRoles(),await this.loadPermissions()},methods:{async loadRoles(){var s;try{this.loading=!0;const e=this.buildPaginationParams();this.search&&(e.search=this.search),this.activeFilter!==null&&(e.active=this.activeFilter);const f=await b.get("/api/v1/roles",{params:e,headers:this.getAuthHeaders()});f.data.data?(this.roles=f.data.data||[],this.updatePagination(f.data)):(this.roles=f.data||[],this.pagination={current_page:1,last_page:1,per_page:this.roles.length,total:this.roles.length}),this.roles.length===0&&console.warn("No roles found. Run the seeder to create default roles.")}catch(e){((s=e.response)==null?void 0:s.status)===404?this.handleApiError(e,"Roles endpoint not found. Please ensure migrations and seeders have run."):this.handleApiError(e,"Failed to load roles")}finally{this.loading=!1}},async loadPermissions(){try{const s=await b.get("/api/v1/permissions",{headers:this.getAuthHeaders()});this.groupedPermissions=s.data,this.permissions=[],Object.values(s.data).forEach(e=>{this.permissions.push(...e)})}catch(s){this.handleApiError(s,"Failed to load permissions")}},openDialog(s){s?(this.editingRole=s,this.form={name:s.name,slug:s.slug,description:s.description||"",is_active:s.is_active,order:s.order||0}):(this.editingRole=null,this.form={name:"",slug:"",description:"",is_active:!0,order:0}),this.dialog=!0},closeDialog(){this.dialog=!1,this.editingRole=null,this.form={name:"",slug:"",description:"",is_active:!0,order:0},this.$refs.roleForm&&this.$refs.roleForm.resetValidation()},autoGenerateSlugFromName(){!this.form.slug&&this.form.name&&!this.editingRole&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))},async saveRole(){var s,e,f,C;if(!this.$refs.roleForm){this.showError("Form reference not found");return}if(this.$refs.roleForm.validate()){!this.form.slug&&this.form.name&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")),this.saving=!0;try{const i=this.editingRole?`/api/v1/roles/${this.editingRole.id}`:"/api/v1/roles",n=this.editingRole?"put":"post",m={name:this.form.name.trim(),description:this.form.description?this.form.description.trim():null,is_active:this.form.is_active===!0||this.form.is_active==="true"||this.form.is_active===1,order:parseInt(this.form.order)||0};this.editingRole?this.form.slug!==this.editingRole.slug&&(this.form.slug&&this.form.slug.trim()?m.slug=this.form.slug.trim():m.slug=""):this.form.slug&&this.form.slug.trim()&&(m.slug=this.form.slug.trim()),await b[n](i,m,{headers:this.getAuthHeaders()}),this.showSuccess(this.editingRole?"Role updated successfully":"Role created successfully"),this.closeDialog(),await this.loadRoles()}catch(i){if(console.error("Error saving role:",i),console.error("Error response:",i.response),(e=(s=i.response)==null?void 0:s.data)!=null&&e.errors){const n=i.response.data.errors,m=[];Object.keys(n).forEach(h=>{Array.isArray(n[h])?m.push(`${h}: ${n[h][0]}`):m.push(`${h}: ${n[h]}`)})}else(C=(f=i.response)==null?void 0:f.data)!=null&&C.message&&i.response.data.message;this.handleApiError(i,"Error saving role")}finally{this.saving=!1}}},async deleteRole(s){if(s.is_system){this.showError("System roles cannot be deleted");return}if(confirm(`Are you sure you want to delete the role "${s.name}"?`))try{await b.delete(`/api/v1/roles/${s.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Role deleted successfully"),await this.loadRoles()}catch(e){this.handleApiError(e,"Error deleting role")}},async openPermissionDialog(s){this.selectedRole=s,this.selectedPermissions=s.permissions?s.permissions.map(e=>e.id):[],this.permissionDialog=!0},closePermissionDialog(){this.permissionDialog=!1,this.selectedRole=null,this.selectedPermissions=[]},isPermissionSelected(s){return this.selectedPermissions.includes(s)},togglePermission(s){const e=this.selectedPermissions.indexOf(s);e>-1?this.selectedPermissions.splice(e,1):this.selectedPermissions.push(s)},async savePermissions(){this.savingPermissions=!0;try{await b.put(`/api/v1/roles/${this.selectedRole.id}/permissions`,{permissions:this.selectedPermissions},{headers:this.getAuthHeaders()}),this.showSuccess("Permissions updated successfully"),this.closePermissionDialog(),await this.loadRoles()}catch(s){this.handleApiError(s,"Error saving permissions")}finally{this.savingPermissions=!1}},onPerPageChange(){this.resetPagination(),this.loadRoles()},onSort(s){this.handleSort(s),this.loadRoles()}}},K={class:"d-flex justify-space-between align-center mb-6"},Q={class:"d-flex align-center"},W={class:"d-flex align-center"},X={class:"d-flex align-center"},Y={class:"font-weight-medium"},Z={class:"text-caption text-grey"},$={key:1,class:"text-caption"},ee={key:0},se={key:0,class:"text-center py-4"},ie={key:1},le={class:"text-h6 mb-3"};function te(s,e,f,C,i,n){const m=a("v-btn"),h=a("v-select"),R=a("v-col"),P=a("v-text-field"),U=a("v-row"),V=a("v-card-text"),k=a("v-card"),S=a("v-card-title"),x=a("v-icon"),_=a("v-chip"),N=a("v-table"),O=a("v-pagination"),B=a("v-alert"),I=a("v-textarea"),M=a("v-switch"),H=a("v-form"),F=a("v-spacer"),E=a("v-card-actions"),z=a("v-dialog"),q=a("v-progress-circular"),L=a("v-checkbox");return u(),c("div",null,[r("div",K,[e[16]||(e[16]=r("h1",{class:"text-h4"},"Role Management",-1)),l(m,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=t=>n.openDialog(null))},{default:o(()=>e[15]||(e[15]=[d(" Add New Role ")])),_:1,__:[15]})]),l(k,{class:"mb-4"},{default:o(()=>[l(V,null,{default:o(()=>[l(U,null,{default:o(()=>[l(R,{cols:"12",md:"4"},{default:o(()=>[l(h,{modelValue:s.perPage,"onUpdate:modelValue":[e[1]||(e[1]=t=>s.perPage=t),n.onPerPageChange],items:s.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(R,{cols:"12",md:"4"},{default:o(()=>[l(h,{modelValue:i.activeFilter,"onUpdate:modelValue":[e[2]||(e[2]=t=>i.activeFilter=t),n.loadRoles],items:i.activeOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(R,{cols:"12",md:"4"},{default:o(()=>[l(P,{modelValue:s.search,"onUpdate:modelValue":[e[3]||(e[3]=t=>s.search=t),n.loadRoles],label:"Search roles","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(k,null,{default:o(()=>[l(S,null,{default:o(()=>e[17]||(e[17]=[d("Roles")])),_:1,__:[17]}),l(V,null,{default:o(()=>[l(N,null,{default:o(()=>[r("thead",null,[r("tr",null,[r("th",{class:"sortable",onClick:e[4]||(e[4]=t=>n.onSort("name"))},[r("div",Q,[e[18]||(e[18]=d(" Name ")),l(x,{icon:s.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),r("th",{class:"sortable",onClick:e[5]||(e[5]=t=>n.onSort("slug"))},[r("div",W,[e[19]||(e[19]=d(" Slug ")),l(x,{icon:s.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[21]||(e[21]=r("th",null,"Permissions",-1)),r("th",{class:"sortable",onClick:e[6]||(e[6]=t=>n.onSort("is_active"))},[r("div",X,[e[20]||(e[20]=d(" Status ")),l(x,{icon:s.getSortIcon("is_active"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[22]||(e[22]=r("th",null,"Type",-1)),e[23]||(e[23]=r("th",null,"Actions",-1))])]),r("tbody",null,[(u(!0),c(A,null,D(i.roles,t=>(u(),c("tr",{key:t.id},[r("td",null,[r("div",Y,g(t.name),1),r("div",Z,g(t.description||"No description"),1)]),r("td",null,[l(_,{size:"small",variant:"outlined"},{default:o(()=>[d(g(t.slug),1)]),_:2},1024)]),r("td",null,[l(_,{size:"small",color:"primary",variant:"text"},{default:o(()=>[d(g(t.permissions?t.permissions.length:0)+" permissions ",1)]),_:2},1024)]),r("td",null,[l(_,{color:t.is_active?"success":"error",size:"small"},{default:o(()=>[d(g(t.is_active?"Active":"Inactive"),1)]),_:2},1032,["color"])]),r("td",null,[t.is_system?(u(),v(_,{key:0,color:"warning",size:"small"},{default:o(()=>e[24]||(e[24]=[d(" System ")])),_:1,__:[24]})):(u(),c("span",$,"Custom"))]),r("td",null,[l(m,{size:"small",icon:"mdi-pencil",onClick:p=>n.openDialog(t),variant:"text",disabled:t.is_system},null,8,["onClick","disabled"]),l(m,{size:"small",icon:"mdi-shield-key",onClick:p=>n.openPermissionDialog(t),variant:"text"},null,8,["onClick"]),l(m,{size:"small",icon:"mdi-delete",onClick:p=>n.deleteRole(t),variant:"text",color:"error",disabled:t.is_system},null,8,["onClick","disabled"])])]))),128)),i.roles.length===0?(u(),c("tr",ee,e[25]||(e[25]=[r("td",{colspan:"6",class:"text-center py-4"},"No roles found",-1)]))):w("",!0)])]),_:1}),s.pagination.last_page>1?(u(),v(O,{key:0,modelValue:s.currentPage,"onUpdate:modelValue":[e[7]||(e[7]=t=>s.currentPage=t),n.loadRoles],length:s.pagination.last_page,class:"mt-4"},null,8,["modelValue","length","onUpdate:modelValue"])):w("",!0)]),_:1})]),_:1}),l(z,{modelValue:i.dialog,"onUpdate:modelValue":e[13]||(e[13]=t=>i.dialog=t),"max-width":"600",persistent:""},{default:o(()=>[l(k,null,{default:o(()=>[l(S,null,{default:o(()=>[d(g(i.editingRole?"Edit Role":"Add New Role"),1)]),_:1}),l(V,null,{default:o(()=>[i.editingRole&&i.editingRole.is_system?(u(),v(B,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:o(()=>e[26]||(e[26]=[r("strong",null,"System Role:",-1),d(" This is a system role. Core properties (name, slug, description, status, order) cannot be modified. Only permissions can be updated using the permissions button. ")])),_:1,__:[26]})):w("",!0),l(H,{ref:"roleForm",onSubmit:j(n.saveRole,["prevent"])},{default:o(()=>[l(P,{modelValue:i.form.name,"onUpdate:modelValue":e[8]||(e[8]=t=>i.form.name=t),label:"Role Name",rules:[i.rules.required],required:"",hint:"Display name for the role","persistent-hint":"",class:"mb-4",disabled:i.editingRole&&i.editingRole.is_system,onBlur:n.autoGenerateSlugFromName},null,8,["modelValue","rules","disabled","onBlur"]),l(P,{modelValue:i.form.slug,"onUpdate:modelValue":e[9]||(e[9]=t=>i.form.slug=t),label:"Slug",hint:"URL-friendly identifier (auto-generated if empty)","persistent-hint":"",class:"mb-4",disabled:i.editingRole&&i.editingRole.is_system},null,8,["modelValue","disabled"]),l(I,{modelValue:i.form.description,"onUpdate:modelValue":e[10]||(e[10]=t=>i.form.description=t),label:"Description",hint:"Brief description of the role","persistent-hint":"",rows:"2",class:"mb-4",disabled:i.editingRole&&i.editingRole.is_system},null,8,["modelValue","disabled"]),l(P,{modelValue:i.form.order,"onUpdate:modelValue":e[11]||(e[11]=t=>i.form.order=t),modelModifiers:{number:!0},label:"Order",type:"number",hint:"Display order (lower numbers first)","persistent-hint":"",class:"mb-4",disabled:i.editingRole&&i.editingRole.is_system},null,8,["modelValue","disabled"]),l(M,{modelValue:i.form.is_active,"onUpdate:modelValue":e[12]||(e[12]=t=>i.form.is_active=t),label:"Active",hint:"Inactive roles cannot be assigned to users","persistent-hint":"",class:"mb-4",disabled:i.editingRole&&i.editingRole.is_system},null,8,["modelValue","disabled"])]),_:1},8,["onSubmit"])]),_:1}),l(E,null,{default:o(()=>[l(F),l(m,{onClick:n.closeDialog,variant:"text"},{default:o(()=>e[27]||(e[27]=[d("Cancel")])),_:1,__:[27]},8,["onClick"]),i.editingRole&&i.editingRole.is_system?(u(),v(m,{key:0,onClick:n.closeDialog,color:"primary"},{default:o(()=>e[28]||(e[28]=[d(" Close ")])),_:1,__:[28]},8,["onClick"])):(u(),v(m,{key:1,onClick:n.saveRole,color:"primary",loading:s.saving},{default:o(()=>[d(g(i.editingRole?"Update":"Create"),1)]),_:1},8,["onClick","loading"]))]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(z,{modelValue:i.permissionDialog,"onUpdate:modelValue":e[14]||(e[14]=t=>i.permissionDialog=t),"max-width":"800",persistent:""},{default:o(()=>[l(k,null,{default:o(()=>[l(S,null,{default:o(()=>{var t,p;return[d(" Manage Permissions - "+g((t=i.selectedRole)==null?void 0:t.name)+" ",1),(p=i.selectedRole)!=null&&p.is_system?(u(),v(_,{key:0,color:"warning",size:"small",class:"ml-2"},{default:o(()=>e[29]||(e[29]=[d(" System Role ")])),_:1,__:[29]})):w("",!0)]}),_:1}),l(V,null,{default:o(()=>[i.loadingPermissions?(u(),c("div",se,[l(q,{indeterminate:"",color:"primary"})])):(u(),c("div",ie,[(u(!0),c(A,null,D(i.groupedPermissions,(t,p)=>(u(),c("div",{key:p,class:"mb-6"},[r("h3",le,g(p.charAt(0).toUpperCase()+p.slice(1)),1),l(U,null,{default:o(()=>[(u(!0),c(A,null,D(t,y=>(u(),v(R,{key:y.id,cols:"12",md:"6"},{default:o(()=>[l(L,{"model-value":n.isPermissionSelected(y.id),"onUpdate:modelValue":oe=>n.togglePermission(y.id),label:y.name,hint:y.description,"persistent-hint":"",density:"compact"},null,8,["model-value","onUpdate:modelValue","label","hint"])]),_:2},1024))),128))]),_:2},1024)]))),128))]))]),_:1}),l(E,null,{default:o(()=>[l(F),l(m,{onClick:n.closePermissionDialog,variant:"text"},{default:o(()=>e[30]||(e[30]=[d("Cancel")])),_:1,__:[30]},8,["onClick"]),l(m,{onClick:n.savePermissions,color:"primary",loading:i.savingPermissions},{default:o(()=>e[31]||(e[31]=[d(" Save Permissions ")])),_:1,__:[31]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const ae=T(J,[["render",te]]);export{ae as default};
