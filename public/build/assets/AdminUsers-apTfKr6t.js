import{_ as G,d as c,a,b as r,w as l,f as p,r as d,h as v,t as m,F as V,e as z,i as H,c as P,L as W,M as J,y as E,g as U,o as u}from"./app-CRA7hU86.js";import{a as Y}from"./adminPaginationMixin-DN7Wb3ng.js";import{r as K,n as Q}from"./uploads-CnEkgyD_.js";const X={mixins:[Y],data(){return{users:[],roles:[],roleFilter:null,roleOptions:[],dialog:!1,editingUser:null,saving:!1,form:{name:"",email:"",role_ids:[],password:"",password_confirmation:"",avatar:""},rules:{required:t=>Array.isArray(t)?t.length>0||"At least one role is required":!!t||"This field is required",email:t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||"Invalid email",minLength:t=>t?t.length>=8||"Password must be at least 8 characters":!0},currentUserId:null,showPassword:!1,showPasswordConfirmation:!1,avatarFile:null,uploadingAvatar:!1}},async mounted(){await this.loadRoles(),await this.loadUsers(),this.loadCurrentUser()},methods:{async loadUsers(){try{this.loading=!0;const t=this.buildPaginationParams();this.search&&(t.search=this.search),this.roleFilter&&(t.role=this.roleFilter);const e=await U.get("/api/v1/users",{params:t,headers:this.getAuthHeaders()}),g=e.data.data||[];this.users=g,this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load users")}finally{this.loading=!1}},async loadRoles(){try{const t=await U.get("/api/v1/users/roles",{headers:this.getAuthHeaders()});this.roles=t.data.roles,this.roleOptions=this.roles.map(e=>({title:e.label,value:e.value}))}catch(t){console.error("Error loading roles:",t)}},loadCurrentUser(){const t=localStorage.getItem("admin_token");U.get("/api/v1/auth/user",{headers:{Authorization:`Bearer ${t}`}}).then(e=>{this.currentUserId=e.data.id}).catch(()=>{})},openDialog(t){if(this.avatarFile=null,t){this.editingUser=t;const e=t.roles?t.roles.map(f=>f.id):[],g=this.normalizeImageInput(t.avatar||"");this.form={name:t.name,email:t.email,role_ids:e,password:"",password_confirmation:"",avatar:g}}else{this.editingUser=null;const e=this.roles.length>0?this.roles[0].value:null;this.form={name:"",email:"",role_ids:e?[e]:[],password:"",password_confirmation:"",avatar:""}}this.dialog=!0},closeDialog(){this.dialog=!1,this.editingUser=null;const t=this.roles.length>0?this.roles[0].value:null;this.form={name:"",email:"",role_ids:t?[t]:[],password:"",password_confirmation:"",avatar:""},this.showPassword=!1,this.showPasswordConfirmation=!1,this.avatarFile=null,this.$refs.form&&this.$refs.form.resetValidation()},async handleAvatarUpload(){var g;if(!this.avatarFile)return;const t=Array.isArray(this.avatarFile)?this.avatarFile[0]:this.avatarFile;if(!t)return;if(!t.type.startsWith("image/")){this.showError("Please select a valid image file"),this.avatarFile=null;return}const e=5*1024*1024;if(t.size>e){this.showError("File size must be less than 5MB"),this.avatarFile=null;return}this.uploadingAvatar=!0;try{const f=new FormData;f.append("image",t),f.append("folder","users"),this.form.name&&f.append("prefix",this.form.name);const s=localStorage.getItem("admin_token"),n=await U.post("/api/v1/upload/image",f,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"multipart/form-data"}});if(n.data.success){const i=this.normalizeImageInput(n.data.path||n.data.url);this.form.avatar=i,this.avatarFile=null,this.showSuccess("Avatar uploaded successfully")}else throw new Error(n.data.message||"Failed to upload avatar")}catch(f){console.error("Error uploading avatar:",f);let s="Failed to upload avatar";f.response?s=((g=f.response.data)==null?void 0:g.message)||f.response.statusText||s:f.message&&(s=f.message),this.showError(s),this.avatarFile=null}finally{this.uploadingAvatar=!1}},clearAvatar(){this.form.avatar="",this.avatarFile=null},async saveUser(){var t,e,g,f;if(this.form.password&&this.form.password!==this.form.password_confirmation){this.showError("Passwords do not match");return}if(!this.editingUser&&!this.form.password){this.showError("Password is required for new users");return}if(this.editingUser&&this.form.password&&!this.form.password_confirmation){this.showError("Please confirm the password");return}if(this.$refs.form.validate()){this.saving=!0;try{const s=localStorage.getItem("admin_token"),n=this.editingUser?`/api/v1/users/${this.editingUser.id}`:"/api/v1/users",i={...this.form};this.form.role_ids&&(i.role_ids=Array.isArray(this.form.role_ids)?this.form.role_ids:[this.form.role_ids]),this.form.password?i.password_confirmation=this.form.password_confirmation:(delete i.password,delete i.password_confirmation),i.avatar=this.normalizeImageInput(i.avatar),delete i.role;const w=this.editingUser?"put":"post";await U[w](n,i,{headers:{Authorization:`Bearer ${s}`}}),this.showSuccess(this.editingUser?"User updated successfully":"User created successfully"),this.closeDialog(),await this.loadUsers()}catch(s){console.error("Error saving user:",s);let n="Error saving user";if((e=(t=s.response)==null?void 0:t.data)!=null&&e.errors){const i=s.response.data.errors,w=[];Object.keys(i).forEach(b=>{w.push(i[b][0])}),n=w.join(", ")}else(f=(g=s.response)==null?void 0:g.data)!=null&&f.message&&(n=s.response.data.message);this.showError(n)}finally{this.saving=!1}}},async deleteUser(t){if(t.id===this.currentUserId){this.showError("You cannot delete your own account");return}if(confirm(`Are you sure you want to delete ${t.name}?`))try{const e=localStorage.getItem("admin_token");await U.delete(`/api/v1/users/${t.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.showSuccess("User deleted successfully"),await this.loadUsers()}catch(e){this.handleApiError(e,"Error deleting user")}},getRoleLabel(t){const e=this.roles.find(g=>g.slug===t);return e?e.label:t},getRoleColor(t){return{administrator:"error",editor:"primary","hr-user":"success",staff:"info"}[t]||"primary"},onPerPageChange(){this.resetPagination(),this.loadUsers()},onSort(t){this.handleSort(t),this.loadUsers()},normalizeImageInput(t){return Q(t)},resolveImageUrl(t){return K(t)}}},Z={class:"page-header"},$={class:"text-caption text-grey"},ee={key:0},te={class:"d-flex align-center"},se={class:"d-flex align-center"},re={class:"d-flex align-center"},oe={class:"d-flex align-center gap-2"},ae={class:"d-flex flex-wrap gap-1"},le={class:"d-flex"},ne={class:"d-flex align-center gap-2"},ie={key:1,class:"text-white"},de={key:0,class:"d-flex flex-wrap gap-1"},me={key:1,class:"text-caption text-grey"},ue={key:0},pe={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},fe={class:"text-caption text-grey"},ce={key:0},ge={key:0,class:"ml-2"},he={key:1},ve={key:0,class:"d-flex align-center gap-2"},we={key:1,class:"text-grey text-caption align-self-center"},_e={class:"mb-4"},ye={key:0,class:"mb-3 text-center"};function Ue(t,e,g,f,s,n){const i=d("v-btn"),w=d("v-select"),b=d("v-col"),y=d("v-text-field"),R=d("v-row"),C=d("v-card-text"),A=d("v-card"),F=d("v-card-title"),k=d("v-icon"),_=d("v-skeleton-loader"),x=d("v-img"),S=d("v-avatar"),I=d("v-chip"),q=d("v-table"),N=d("v-pagination"),M=d("v-list-item"),B=d("v-progress-circular"),D=d("v-file-input"),L=d("v-form"),O=d("v-spacer"),T=d("v-card-actions"),j=d("v-dialog");return u(),c("div",null,[a("div",Z,[e[20]||(e[20]=a("h1",{class:"text-h4 page-title"},"User Management",-1)),r(i,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=o=>n.openDialog(null)),class:"add-button"},{default:l(()=>e[19]||(e[19]=[p(" Add New User ")])),_:1,__:[19]})]),r(A,{class:"mb-4"},{default:l(()=>[r(C,null,{default:l(()=>[r(R,null,{default:l(()=>[r(b,{cols:"12",md:"4"},{default:l(()=>[r(w,{modelValue:t.perPage,"onUpdate:modelValue":[e[1]||(e[1]=o=>t.perPage=o),n.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),r(b,{cols:"12",md:"4"},{default:l(()=>[r(w,{modelValue:s.roleFilter,"onUpdate:modelValue":[e[2]||(e[2]=o=>s.roleFilter=o),n.loadUsers],items:s.roleOptions,label:"Filter by Role",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),r(b,{cols:"12",md:"4"},{default:l(()=>[r(y,{modelValue:t.search,"onUpdate:modelValue":e[3]||(e[3]=o=>t.search=o),label:"Search by name or email","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:n.loadUsers},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),r(A,null,{default:l(()=>[r(F,{class:"d-flex justify-space-between align-center"},{default:l(()=>[e[22]||(e[22]=a("span",null,"Users",-1)),a("span",$,[e[21]||(e[21]=p(" Total Records: ")),a("strong",null,m(t.pagination.total||0),1),s.users.length>0?(u(),c("span",ee," | Showing "+m((t.currentPage-1)*t.perPage+1)+" to "+m(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+m(t.pagination.total),1)):v("",!0)])]),_:1,__:[22]}),r(C,null,{default:l(()=>[r(q,null,{default:l(()=>[a("thead",null,[a("tr",null,[a("th",{class:"sortable",onClick:e[4]||(e[4]=o=>n.onSort("name"))},[a("div",te,[e[23]||(e[23]=p(" Name ")),r(k,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),a("th",{class:"sortable",onClick:e[5]||(e[5]=o=>n.onSort("email"))},[a("div",se,[e[24]||(e[24]=p(" Email ")),r(k,{icon:t.getSortIcon("email"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[26]||(e[26]=a("th",null,"Role",-1)),a("th",{class:"sortable",onClick:e[6]||(e[6]=o=>n.onSort("created_at"))},[a("div",re,[e[25]||(e[25]=p(" Created ")),r(k,{icon:t.getSortIcon("created_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[27]||(e[27]=a("th",null,"Actions",-1))])]),a("tbody",null,[t.loading?(u(),c(V,{key:0},z(5,o=>a("tr",{key:`skeleton-${o}`},[a("td",null,[a("div",oe,[r(_,{type:"avatar",width:"32",height:"32"}),r(_,{type:"text",width:"150"})])]),a("td",null,[r(_,{type:"text",width:"200"})]),a("td",null,[a("div",ae,[r(_,{type:"chip",width:"80",height:"24",class:"mr-1"}),r(_,{type:"chip",width:"70",height:"24"})])]),a("td",null,[r(_,{type:"text",width:"120"})]),a("td",null,[a("div",le,[r(_,{type:"button",width:"32",height:"32",class:"mr-1"}),r(_,{type:"button",width:"32",height:"32"})])])])),64)):(u(),c(V,{key:1},[(u(!0),c(V,null,z(s.users,o=>(u(),c("tr",{key:o.id},[a("td",null,[a("div",ne,[r(S,{size:"32",color:"primary"},{default:l(()=>[o.avatar?(u(),P(x,{key:0,src:o.avatar,alt:o.name},null,8,["src","alt"])):(u(),c("span",ie,m(o.name.charAt(0).toUpperCase()),1))]),_:2},1024),p(" "+m(o.name),1)])]),a("td",null,m(o.email),1),a("td",null,[o.roles&&o.roles.length>0?(u(),c("div",de,[(u(!0),c(V,null,z(o.roles,h=>(u(),P(I,{key:h.id,color:n.getRoleColor(h.slug),size:"small"},{default:l(()=>[p(m(h.name),1)]),_:2},1032,["color"]))),128))])):(u(),c("span",me,"No roles"))]),a("td",null,m(t.formatDate(o.created_at)),1),a("td",null,[r(i,{size:"small",icon:"mdi-pencil",onClick:h=>n.openDialog(o),variant:"text"},null,8,["onClick"]),r(i,{size:"small",icon:"mdi-delete",onClick:h=>n.deleteUser(o),variant:"text",color:"error",disabled:o.id===s.currentUserId},null,8,["onClick","disabled"])])]))),128)),s.users.length===0?(u(),c("tr",ue,e[28]||(e[28]=[a("td",{colspan:"5",class:"text-center py-4"},"No users found",-1)]))):v("",!0)],64))])]),_:1}),a("div",pe,[a("div",fe,[s.users.length>0&&t.pagination.total>0?(u(),c("span",ce,[e[29]||(e[29]=p(" Showing ")),a("strong",null,m((t.currentPage-1)*t.perPage+1),1),e[30]||(e[30]=p(" to ")),a("strong",null,m(Math.min(t.currentPage*t.perPage,t.pagination.total)),1),e[31]||(e[31]=p(" of ")),a("strong",null,m(t.pagination.total.toLocaleString()),1),e[32]||(e[32]=p(" records ")),t.pagination.last_page>1?(u(),c("span",ge," (Page "+m(t.currentPage)+" of "+m(t.pagination.last_page)+") ",1)):v("",!0)])):(u(),c("span",he," No records found "))]),t.pagination.last_page>1?(u(),c("div",ve,[r(N,{modelValue:t.currentPage,"onUpdate:modelValue":[e[7]||(e[7]=o=>t.currentPage=o),n.loadUsers],length:t.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):v("",!0)])]),_:1})]),_:1}),r(j,{modelValue:s.dialog,"onUpdate:modelValue":e[18]||(e[18]=o=>s.dialog=o),"max-width":"600",persistent:""},{default:l(()=>[r(A,null,{default:l(()=>[r(F,null,{default:l(()=>[p(m(s.editingUser?"Edit User":"Add New User"),1)]),_:1}),r(C,null,{default:l(()=>[r(L,{ref:"form",onSubmit:H(n.saveUser,["prevent"])},{default:l(()=>[r(y,{modelValue:s.form.name,"onUpdate:modelValue":e[8]||(e[8]=o=>s.form.name=o),label:"Full Name",rules:[s.rules.required],required:"",class:"mb-4"},null,8,["modelValue","rules"]),r(y,{modelValue:s.form.email,"onUpdate:modelValue":e[9]||(e[9]=o=>s.form.email=o),label:"Email",type:"email",rules:[s.rules.required,s.rules.email],required:"",class:"mb-4"},null,8,["modelValue","rules"]),r(w,{modelValue:s.form.role_ids,"onUpdate:modelValue":e[10]||(e[10]=o=>s.form.role_ids=o),items:s.roles,"item-title":"label","item-value":"value",label:"Roles",rules:[s.rules.required],required:"",multiple:"",chips:"",class:"mb-4"},{item:l(({props:o,item:h})=>[r(M,W(J(o)),{title:l(()=>[p(m(h.raw.label)+" ",1),h.raw.is_system?(u(),P(I,{key:0,size:"x-small",color:"warning",class:"ml-2"},{default:l(()=>e[33]||(e[33]=[p(" System ")])),_:1,__:[33]})):v("",!0)]),subtitle:l(()=>[p(m(h.raw.description),1)]),_:2},1040)]),selection:l(({item:o,index:h})=>[h<2?(u(),P(I,{key:0,size:"small",class:"mr-1"},{default:l(()=>[p(m(o.raw.label),1)]),_:2},1024)):v("",!0),h===2?(u(),c("span",we," (+"+m(s.form.role_ids.length-2)+" others) ",1)):v("",!0)]),_:1},8,["modelValue","items","rules"]),r(y,{modelValue:s.form.password,"onUpdate:modelValue":e[12]||(e[12]=o=>s.form.password=o),label:"Password",type:s.showPassword?"text":"password",rules:s.editingUser?[]:[s.rules.required,s.rules.minLength],required:!s.editingUser,hint:"Leave blank to keep current password","persistent-hint":"",class:"mb-4"},{"append-inner":l(()=>[r(i,{icon:"",variant:"text",size:"small",onClick:e[11]||(e[11]=o=>s.showPassword=!s.showPassword)},{default:l(()=>[r(k,null,{default:l(()=>[p(m(s.showPassword?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","type","rules","required"]),!s.editingUser||s.form.password?(u(),P(y,{key:0,modelValue:s.form.password_confirmation,"onUpdate:modelValue":e[14]||(e[14]=o=>s.form.password_confirmation=o),label:"Confirm Password",type:s.showPasswordConfirmation?"text":"password",rules:s.form.password?[()=>!!s.form.password_confirmation||"Please confirm your password",()=>s.form.password_confirmation===s.form.password||"Passwords do not match"]:[],required:!!s.form.password,class:"mb-4"},{"append-inner":l(()=>[r(i,{icon:"",variant:"text",size:"small",onClick:e[13]||(e[13]=o=>s.showPasswordConfirmation=!s.showPasswordConfirmation)},{default:l(()=>[r(k,null,{default:l(()=>[p(m(s.showPasswordConfirmation?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","type","rules","required"])):v("",!0),a("div",_e,[e[35]||(e[35]=a("div",{class:"text-subtitle-2 font-weight-medium mb-2"},"Avatar",-1)),s.form.avatar?(u(),c("div",ye,[r(S,{size:"80",class:"mb-2"},{default:l(()=>[r(x,{src:s.form.avatar?n.resolveImageUrl(s.form.avatar):"",alt:"Avatar Preview"},null,8,["src"])]),_:1}),a("div",null,[r(i,{size:"small",variant:"text",color:"error","prepend-icon":"mdi-delete",onClick:n.clearAvatar},{default:l(()=>e[34]||(e[34]=[p("Remove Avatar")])),_:1,__:[34]},8,["onClick"])])])):v("",!0),r(D,{modelValue:s.avatarFile,"onUpdate:modelValue":[e[15]||(e[15]=o=>s.avatarFile=o),n.handleAvatarUpload],label:"Upload Avatar",variant:"outlined",density:"comfortable",color:"primary",accept:"image/*","prepend-icon":"mdi-image",hint:"Upload an avatar image (JPG, PNG, GIF, WebP - Max 5MB). Recommended size: 200x200px","persistent-hint":"","show-size":"",class:"mb-3"},E({_:2},[s.uploadingAvatar?{name:"append-inner",fn:l(()=>[r(B,{indeterminate:"",size:"20",color:"primary"})]),key:"0"}:void 0]),1032,["modelValue","onUpdate:modelValue"]),r(y,{modelValue:s.form.avatar,"onUpdate:modelValue":e[17]||(e[17]=o=>s.form.avatar=o),label:"Or Enter Avatar URL",variant:"outlined",density:"comfortable",color:"primary",hint:"Enter a direct URL to the avatar image","persistent-hint":"","prepend-inner-icon":"mdi-link"},E({_:2},[s.form.avatar&&!s.avatarFile?{name:"append-inner",fn:l(()=>[r(i,{icon:"mdi-open-in-new",variant:"text",size:"small",onClick:e[16]||(e[16]=o=>t.window.open(n.resolveImageUrl(s.form.avatar),"_blank"))})]),key:"0"}:void 0]),1032,["modelValue"])])]),_:1},8,["onSubmit"])]),_:1}),r(T,null,{default:l(()=>[r(O),r(i,{onClick:n.closeDialog,variant:"text"},{default:l(()=>e[36]||(e[36]=[p("Cancel")])),_:1,__:[36]},8,["onClick"]),r(i,{onClick:n.saveUser,color:"primary",loading:s.saving},{default:l(()=>[p(m(s.editingUser?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Ve=G(X,[["render",Ue],["__scopeId","data-v-e2fc90ef"]]);export{Ve as default};
