import{_ as F,c as m,e as t,a as s,w as l,r as d,b as i,t as r,g as y,h as b,F as I,d as E,f as h,o as u}from"./app-DjJ9iHSO.js";import{a as H}from"./adminPaginationMixin-DN7Wb3ng.js";import{h as N}from"./moment-C5S46NFB.js";const q={mixins:[H],data(){return{logs:[],statistics:{total:0,successful:0,failed:0,unique_users:0,unique_ips:0},statusFilter:null,statusOptions:[{title:"Success",value:"success"},{title:"Failed",value:"failed"}],viewDialog:!1,selectedLog:null}},async mounted(){await this.loadStatistics(),await this.loadLogs()},methods:{async loadStatistics(){try{const o=await h.get("/api/v1/login-logs/statistics",{headers:this.getAuthHeaders()});this.statistics=o.data}catch(o){console.error("Error loading statistics:",o)}},async loadLogs(){try{this.loading=!0;const o=this.buildPaginationParams();this.search&&(o.search=this.search),this.statusFilter&&(o.status=this.statusFilter);const e=await h.get("/api/v1/login-logs",{params:o,headers:this.getAuthHeaders()});this.logs=e.data.data||[],this.updatePagination(e.data)}catch(o){this.handleApiError(o,"Failed to load login logs")}finally{this.loading=!1}},viewLog(o){this.selectedLog=o,this.viewDialog=!0},async deleteLog(o){if(confirm("Are you sure you want to delete this login log?"))try{await h.delete(`/api/v1/login-logs/${o.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Login log deleted successfully"),await this.loadStatistics(),await this.loadLogs()}catch(e){this.handleApiError(e,"Error deleting login log")}},formatDate(o){return o?N(o).format("YYYY-MM-DD HH:mm:ss"):"-"},truncateText(o,e){return o?o.length>e?o.substring(0,e)+"...":o:"-"},onPerPageChange(){this.resetPagination(),this.loadLogs()},onSort(o){this.handleSort(o),this.loadLogs()}}},B={class:"d-flex align-center"},M={class:"text-h6"},T={class:"d-flex align-center"},Y={class:"text-h6"},O={class:"d-flex align-center"},R={class:"text-h6"},j={class:"d-flex align-center"},G={class:"text-h6"},J={class:"d-flex align-center"},K={class:"d-flex align-center"},Q={class:"d-flex align-center"},W={class:"d-flex align-center"},X={key:1,class:"text-grey"},Z=["title"],$={key:0,class:"text-caption text-grey"},ee={key:1},te={key:0},se={class:"mb-3"},le={class:"mb-3"},oe={key:1,class:"text-grey ml-2"},ne={class:"mb-3"},ae={class:"mb-3"},ie={class:"mb-3"},re={key:0,class:"text-grey ml-2"},de={key:1,class:"text-grey ml-2"},ue={class:"mb-3"},ce={key:0,class:"ml-2"},me={key:1,class:"text-grey ml-2"},ge={class:"mb-2"};function _e(o,e,ve,fe,a,c){const _=d("v-icon"),v=d("v-card-text"),f=d("v-card"),g=d("v-col"),L=d("v-row"),k=d("v-select"),w=d("v-text-field"),V=d("v-card-title"),p=d("v-chip"),x=d("v-btn"),S=d("v-table"),P=d("v-pagination"),C=d("v-textarea"),z=d("v-spacer"),U=d("v-card-actions"),A=d("v-dialog");return u(),m("div",null,[e[38]||(e[38]=t("div",{class:"page-header"},[t("h1",{class:"text-h4 page-title"},"Login Log Management")],-1)),s(L,{class:"mb-4"},{default:l(()=>[s(g,{cols:"12",md:"3"},{default:l(()=>[s(f,null,{default:l(()=>[s(v,null,{default:l(()=>[t("div",B,[s(_,{color:"primary",size:"40",class:"mr-3"},{default:l(()=>e[10]||(e[10]=[i("mdi-login")])),_:1,__:[10]}),t("div",null,[t("div",M,r(a.statistics.total||0),1),e[11]||(e[11]=t("div",{class:"text-caption text-grey"},"Total Logins",-1))])])]),_:1})]),_:1})]),_:1}),s(g,{cols:"12",md:"3"},{default:l(()=>[s(f,null,{default:l(()=>[s(v,null,{default:l(()=>[t("div",T,[s(_,{color:"success",size:"40",class:"mr-3"},{default:l(()=>e[12]||(e[12]=[i("mdi-check-circle")])),_:1,__:[12]}),t("div",null,[t("div",Y,r(a.statistics.successful||0),1),e[13]||(e[13]=t("div",{class:"text-caption text-grey"},"Successful",-1))])])]),_:1})]),_:1})]),_:1}),s(g,{cols:"12",md:"3"},{default:l(()=>[s(f,null,{default:l(()=>[s(v,null,{default:l(()=>[t("div",O,[s(_,{color:"error",size:"40",class:"mr-3"},{default:l(()=>e[14]||(e[14]=[i("mdi-close-circle")])),_:1,__:[14]}),t("div",null,[t("div",R,r(a.statistics.failed||0),1),e[15]||(e[15]=t("div",{class:"text-caption text-grey"},"Failed",-1))])])]),_:1})]),_:1})]),_:1}),s(g,{cols:"12",md:"3"},{default:l(()=>[s(f,null,{default:l(()=>[s(v,null,{default:l(()=>[t("div",j,[s(_,{color:"info",size:"40",class:"mr-3"},{default:l(()=>e[16]||(e[16]=[i("mdi-account-group")])),_:1,__:[16]}),t("div",null,[t("div",G,r(a.statistics.unique_users||0),1),e[17]||(e[17]=t("div",{class:"text-caption text-grey"},"Unique Users",-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),s(f,{class:"mb-4"},{default:l(()=>[s(v,null,{default:l(()=>[s(L,null,{default:l(()=>[s(g,{cols:"12",md:"3"},{default:l(()=>[s(k,{modelValue:o.perPage,"onUpdate:modelValue":[e[0]||(e[0]=n=>o.perPage=n),c.onPerPageChange],items:o.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(g,{cols:"12",md:"3"},{default:l(()=>[s(k,{modelValue:a.statusFilter,"onUpdate:modelValue":[e[1]||(e[1]=n=>a.statusFilter=n),c.loadLogs],items:a.statusOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(g,{cols:"12",md:"6"},{default:l(()=>[s(w,{modelValue:o.search,"onUpdate:modelValue":[e[2]||(e[2]=n=>o.search=n),c.loadLogs],label:"Search (email, IP, user agent)","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(f,null,{default:l(()=>[s(V,null,{default:l(()=>e[18]||(e[18]=[i("Login Logs")])),_:1,__:[18]}),s(v,null,{default:l(()=>[s(S,null,{default:l(()=>[t("thead",null,[t("tr",null,[t("th",{class:"sortable",onClick:e[3]||(e[3]=n=>c.onSort("email"))},[t("div",J,[e[19]||(e[19]=i(" Email ")),s(_,{icon:o.getSortIcon("email"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[23]||(e[23]=t("th",null,"User",-1)),t("th",{class:"sortable",onClick:e[4]||(e[4]=n=>c.onSort("ip_address"))},[t("div",K,[e[20]||(e[20]=i(" IP Address ")),s(_,{icon:o.getSortIcon("ip_address"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[24]||(e[24]=t("th",null,"User Agent",-1)),t("th",{class:"sortable",onClick:e[5]||(e[5]=n=>c.onSort("status"))},[t("div",Q,[e[21]||(e[21]=i(" Status ")),s(_,{icon:o.getSortIcon("status"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[25]||(e[25]=t("th",null,"Failure Reason",-1)),t("th",{class:"sortable",onClick:e[6]||(e[6]=n=>c.onSort("created_at"))},[t("div",W,[e[22]||(e[22]=i(" Date ")),s(_,{icon:o.getSortIcon("created_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[26]||(e[26]=t("th",null,"Actions",-1))])]),t("tbody",null,[(u(!0),m(I,null,E(a.logs,n=>(u(),m("tr",{key:n.id},[t("td",null,r(n.email),1),t("td",null,[n.user?(u(),y(p,{key:0,size:"small",color:"primary",variant:"text"},{default:l(()=>[i(r(n.user.name),1)]),_:2},1024)):(u(),m("span",X,"-"))]),t("td",null,[s(p,{size:"small",variant:"outlined"},{default:l(()=>[i(r(n.ip_address||"-"),1)]),_:2},1024)]),t("td",null,[t("span",{class:"text-caption",title:n.user_agent},r(c.truncateText(n.user_agent,50)),9,Z)]),t("td",null,[s(p,{color:n.status==="success"?"success":"error",size:"small"},{default:l(()=>[i(r(n.status),1)]),_:2},1032,["color"])]),t("td",null,[n.failure_reason?(u(),m("span",$,r(n.failure_reason),1)):(u(),m("span",ee,"-"))]),t("td",null,r(c.formatDate(n.created_at)),1),t("td",null,[s(x,{size:"small",icon:"mdi-eye",onClick:D=>c.viewLog(n),variant:"text"},null,8,["onClick"]),s(x,{size:"small",icon:"mdi-delete",onClick:D=>c.deleteLog(n),variant:"text",color:"error"},null,8,["onClick"])])]))),128)),a.logs.length===0?(u(),m("tr",te,e[27]||(e[27]=[t("td",{colspan:"8",class:"text-center py-4"},"No login logs found",-1)]))):b("",!0)])]),_:1}),o.pagination.last_page>1?(u(),y(P,{key:0,modelValue:o.currentPage,"onUpdate:modelValue":[e[7]||(e[7]=n=>o.currentPage=n),c.loadLogs],length:o.pagination.last_page,class:"mt-4"},null,8,["modelValue","length","onUpdate:modelValue"])):b("",!0)]),_:1})]),_:1}),s(A,{modelValue:a.viewDialog,"onUpdate:modelValue":e[9]||(e[9]=n=>a.viewDialog=n),"max-width":"700"},{default:l(()=>[a.selectedLog?(u(),y(f,{key:0},{default:l(()=>[s(V,null,{default:l(()=>e[28]||(e[28]=[i("Login Log Details")])),_:1,__:[28]}),s(v,null,{default:l(()=>[s(L,null,{default:l(()=>[s(g,{cols:"12",md:"6"},{default:l(()=>[t("div",se,[e[29]||(e[29]=t("strong",null,"Email:",-1)),i(" "+r(a.selectedLog.email),1)]),t("div",le,[e[30]||(e[30]=t("strong",null,"User:",-1)),a.selectedLog.user?(u(),y(p,{key:0,size:"small",color:"primary",variant:"text",class:"ml-2"},{default:l(()=>[i(r(a.selectedLog.user.name)+" ("+r(a.selectedLog.user.email)+") ",1)]),_:1})):(u(),m("span",oe,"-"))]),t("div",ne,[e[31]||(e[31]=t("strong",null,"Status:",-1)),s(p,{color:a.selectedLog.status==="success"?"success":"error",size:"small",class:"ml-2"},{default:l(()=>[i(r(a.selectedLog.status),1)]),_:1},8,["color"])])]),_:1}),s(g,{cols:"12",md:"6"},{default:l(()=>[t("div",ae,[e[32]||(e[32]=t("strong",null,"IP Address:",-1)),i(" "+r(a.selectedLog.ip_address||"-"),1)]),t("div",ie,[e[33]||(e[33]=t("strong",null,"Failure Reason:",-1)),a.selectedLog.failure_reason?(u(),m("span",re,r(a.selectedLog.failure_reason),1)):(u(),m("span",de,"-"))]),t("div",ue,[e[34]||(e[34]=t("strong",null,"Logged In At:",-1)),a.selectedLog.logged_in_at?(u(),m("span",ce,r(c.formatDate(a.selectedLog.logged_in_at)),1)):(u(),m("span",me,"-"))])]),_:1}),s(g,{cols:"12"},{default:l(()=>[e[35]||(e[35]=t("div",{class:"mb-2"},[t("strong",null,"User Agent:")],-1)),s(C,{value:a.selectedLog.user_agent||"-",readonly:"",variant:"outlined",density:"compact",rows:"3"},null,8,["value"])]),_:1,__:[35]}),s(g,{cols:"12"},{default:l(()=>[t("div",ge,[e[36]||(e[36]=t("strong",null,"Created At:",-1)),i(" "+r(c.formatDate(a.selectedLog.created_at)),1)])]),_:1})]),_:1})]),_:1}),s(U,null,{default:l(()=>[s(z),s(x,{onClick:e[8]||(e[8]=n=>a.viewDialog=!1),variant:"text"},{default:l(()=>e[37]||(e[37]=[i("Close")])),_:1,__:[37]})]),_:1})]),_:1})):b("",!0)]),_:1},8,["modelValue"])])}const xe=F(q,[["render",_e],["__scopeId","data-v-ecbee73f"]]);export{xe as default};
