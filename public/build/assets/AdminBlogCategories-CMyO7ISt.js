import{_ as J,d as c,a as o,b as l,w as s,f as u,r as n,h as y,t as p,F as I,e as D,c as V,m as K,g as b,o as g}from"./app-De8cIRNB.js";import{a as Q}from"./adminPaginationMixin-DN7Wb3ng.js";import{r as X,n as Y}from"./uploads-CnEkgyD_.js";const Z={mixins:[Q],data(){return{categories:[],showDialog:!1,editingCategory:null,saving:!1,publishedFilter:null,publishedOptions:[{title:"Published",value:!0},{title:"Draft",value:!1}],form:{name:"",slug:"",type:"post",description:"",image:"",parent_id:null,order:0,published:!0},allCategories:[],originalSlug:null,originalId:null,imageFile:null,imagePreview:null,uploadingImage:!1}},computed:{parentCategoryOptions(){return this.allCategories.filter(t=>this.editingCategory&&t.id===this.editingCategory.id?!1:t.type==="post").map(t=>({id:t.id,name:t.name,type:t.type}))}},watch:{"form.image"(t){t&&!this.imageFile?this.imagePreview=this.resolveImageUrl(t):!t&&!this.imageFile&&(this.imagePreview=null)}},async mounted(){await Promise.all([this.loadCategories(),this.loadAllCategories()])},methods:{async loadCategories(){try{this.loading=!0;const t=this.buildPaginationParams();t.type="post",this.search&&(t.search=this.search),this.publishedFilter!==null&&(t.published=this.publishedFilter);const e=await b.get("/api/v1/blog-categories",{params:t,headers:this.getAuthHeaders()}),m=e.data.data||[];this.categories=m.map(d=>({...d,image:this.resolveImageUrl(d.image)})),this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load blog categories")}finally{this.loading=!1}},async loadAllCategories(){var t;try{const e=await b.get("/api/v1/blog-categories",{params:{per_page:1e3},headers:this.getAuthHeaders()}).catch(()=>({data:{data:[]}}));this.allCategories=((t=e.data)==null?void 0:t.data)||[]}catch(e){console.error("Error loading all categories:",e),this.allCategories=[]}},openDialog(t=null){this.editingCategory=t,t?this.loadCategoryForEdit(t):this.resetForm(),this.showDialog=!0},async loadCategoryForEdit(t){try{this.loading=!0;const e=t.id||t.slug,d=(await b.get(`/api/v1/blog-categories/${e}`,{headers:this.getAuthHeaders()})).data,a=this.normalizeImageInput(d.image||"");this.form={name:d.name||"",slug:d.slug||"",type:"post",description:d.description||"",image:a,parent_id:d.parent_id||null,order:d.order||0,published:d.published!==!1},this.originalSlug=d.slug,this.originalId=d.id,this.imageFile=null,this.imagePreview=this.resolveImageUrl(d.image||a)}catch(e){this.handleApiError(e,"Failed to load category"),this.closeDialog()}finally{this.loading=!1}},resetForm(){this.form={name:"",slug:"",type:"post",description:"",image:"",parent_id:null,order:0,published:!0},this.imageFile=null,this.imagePreview=null},generateSlug(){this.form.name&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""))},handleImageSelect(t){if(t){const e=Array.isArray(t)?t[0]:t;if(e&&e.size>5242880){this.showError("Image file size must be less than 5MB"),this.imageFile=null;return}if(e&&!e.type.startsWith("image/")){this.showError("Please select a valid image file"),this.imageFile=null;return}if(this.imageFile=e,e){const m=new FileReader;m.onload=d=>{this.imagePreview=d.target.result},m.onerror=()=>{this.showError("Failed to read image file"),this.imageFile=null,this.imagePreview=null},m.readAsDataURL(e)}else this.imagePreview=null}else this.imageFile=null,this.form.image||(this.imagePreview=null)},removeImage(){confirm("Are you sure you want to remove this image?")&&(this.imagePreview=null,this.imageFile=null,this.form.image="")},async uploadImage(){var e,m,d,a;if(!this.imageFile)return null;const t=Array.isArray(this.imageFile)?this.imageFile[0]:this.imageFile;if(!t)return null;this.uploadingImage=!0;try{const r=new FormData;r.append("image",t),r.append("folder","blog/categories"),this.form.name&&r.append("prefix",this.form.name);const h=await b.post("/api/v1/upload/image",r,{headers:{...this.getAuthHeaders(),"Content-Type":"multipart/form-data"}});if(h.data.success){const _=this.normalizeImageInput(h.data.path||h.data.url);return this.form.image=_,this.imagePreview=this.resolveImageUrl(h.data.url||_),this.imageFile=null,_}else throw new Error(h.data.message||"Failed to upload image")}catch(r){const h=((m=(e=r.response)==null?void 0:e.data)==null?void 0:m.message)||((a=(d=r.response)==null?void 0:d.data)==null?void 0:a.error)||"Failed to upload image";throw new Error(h)}finally{this.uploadingImage=!1}},async saveCategory(){const{valid:t}=await this.$refs.formRef.validate();if(!t){this.showError("Please fill in all required fields");return}try{if(this.saving=!0,this.imageFile)try{const m=await this.uploadImage();m&&(this.form.image=m)}catch(m){this.showError(m.message||"Failed to upload image");return}const e={...this.form,type:"post",image:this.normalizeImageInput(this.form.image)};if(this.editingCategory){const m=this.originalId||this.editingCategory.id||this.originalSlug||this.editingCategory.slug;await b.put(`/api/v1/blog-categories/${m}`,e,{headers:this.getAuthHeaders()}),this.showSuccess("Blog category updated successfully")}else await b.post("/api/v1/blog-categories",e,{headers:this.getAuthHeaders()}),this.showSuccess("Blog category created successfully");this.closeDialog(),await Promise.all([this.loadCategories(),this.loadAllCategories()])}catch(e){this.handleApiError(e,"Failed to save blog category")}finally{this.saving=!1}},editCategory(t){this.openDialog(t)},async deleteCategory(t){var e,m;if(confirm("Are you sure you want to delete this blog category? This action cannot be undone."))try{const d=t.id||t.slug;await b.delete(`/api/v1/blog-categories/${d}`,{headers:this.getAuthHeaders()}),this.showSuccess("Blog category deleted successfully"),await Promise.all([this.loadCategories(),this.loadAllCategories()])}catch(d){const a=((m=(e=d.response)==null?void 0:e.data)==null?void 0:m.error)||"Error deleting blog category";this.showError(a)}},closeDialog(){this.showDialog=!1,this.editingCategory=null,this.originalSlug=null,this.originalId=null,this.imageFile=null,this.imagePreview=null,this.resetForm(),this.$refs.formRef&&this.$refs.formRef.resetValidation()},onPerPageChange(){this.resetPagination(),this.loadCategories()},onSort(t){this.handleSort(t),this.loadCategories()},normalizeImageInput(t){return Y(t)},resolveImageUrl(t){return X(t)}}},$={class:"page-header"},ee={class:"text-caption text-grey"},te={key:0},le={class:"d-flex align-center"},ie={class:"d-flex align-center"},ae={class:"d-flex align-center"},oe={class:"d-flex align-center"},se={class:"d-flex"},re={class:"font-weight-medium"},ne={key:0,class:"text-caption text-grey"},de={key:0,class:"text-body-2"},me={key:1,class:"text-caption text-grey"},ge={key:0},ue={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},pe={class:"text-caption text-grey"},he={key:0},ce={key:0,class:"ml-2"},fe={key:1},ve={key:0,class:"d-flex align-center gap-2"},ye={class:"text-h5 font-weight-bold"},_e={class:"d-flex flex-column flex-md-row gap-4"},be={key:0,class:"flex-shrink-0"},we={class:"mt-2"},Ce={class:"flex-grow-1"},Pe={key:1,class:"text-caption text-medium-emphasis mt-2"};function Ve(t,e,m,d,a,r){const h=n("v-btn"),_=n("v-select"),f=n("v-col"),w=n("v-text-field"),U=n("v-row"),F=n("v-card-text"),P=n("v-card"),x=n("v-card-title"),C=n("v-icon"),v=n("v-skeleton-loader"),S=n("v-img"),z=n("v-avatar"),A=n("v-chip"),E=n("v-table"),B=n("v-pagination"),R=n("v-textarea"),M=n("v-label"),N=n("v-progress-circular"),L=n("v-file-input"),O=n("v-alert"),H=n("v-list-item"),T=n("v-switch"),j=n("v-form"),q=n("v-spacer"),W=n("v-card-actions"),G=n("v-dialog");return g(),c("div",null,[o("div",$,[e[20]||(e[20]=o("h1",{class:"text-h4 page-title"},"Blog Categories Management",-1)),l(h,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=i=>r.openDialog()),class:"add-button"},{default:s(()=>e[19]||(e[19]=[u("Create Category")])),_:1,__:[19]})]),l(P,{class:"mb-4"},{default:s(()=>[l(F,null,{default:s(()=>[l(U,null,{default:s(()=>[l(f,{cols:"12",md:"4"},{default:s(()=>[l(_,{modelValue:t.perPage,"onUpdate:modelValue":[e[1]||(e[1]=i=>t.perPage=i),r.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(f,{cols:"12",md:"4"},{default:s(()=>[l(_,{modelValue:a.publishedFilter,"onUpdate:modelValue":[e[2]||(e[2]=i=>a.publishedFilter=i),r.loadCategories],items:a.publishedOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(f,{cols:"12",md:"4"},{default:s(()=>[l(w,{modelValue:t.search,"onUpdate:modelValue":[e[3]||(e[3]=i=>t.search=i),r.loadCategories],label:"Search categories","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(P,null,{default:s(()=>[l(x,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[22]||(e[22]=o("span",null,"Blog Categories",-1)),o("span",ee,[e[21]||(e[21]=u(" Total Records: ")),o("strong",null,p(t.pagination.total||0),1),a.categories.length>0?(g(),c("span",te," | Showing "+p((t.currentPage-1)*t.perPage+1)+" to "+p(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+p(t.pagination.total),1)):y("",!0)])]),_:1,__:[22]}),l(F,null,{default:s(()=>[l(E,null,{default:s(()=>[o("thead",null,[o("tr",null,[e[27]||(e[27]=o("th",null,"Image",-1)),o("th",{class:"sortable",onClick:e[4]||(e[4]=i=>r.onSort("name"))},[o("div",le,[e[23]||(e[23]=u(" Name ")),l(C,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),o("th",{class:"sortable",onClick:e[5]||(e[5]=i=>r.onSort("slug"))},[o("div",ie,[e[24]||(e[24]=u(" Slug ")),l(C,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[28]||(e[28]=o("th",null,"Parent",-1)),o("th",{class:"sortable",onClick:e[6]||(e[6]=i=>r.onSort("order"))},[o("div",ae,[e[25]||(e[25]=u(" Order ")),l(C,{icon:t.getSortIcon("order"),size:"small",class:"ml-1"},null,8,["icon"])])]),o("th",{class:"sortable",onClick:e[7]||(e[7]=i=>r.onSort("published"))},[o("div",oe,[e[26]||(e[26]=u(" Status ")),l(C,{icon:t.getSortIcon("published"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[29]||(e[29]=o("th",null,"Actions",-1))])]),o("tbody",null,[t.loading?(g(),c(I,{key:0},D(5,i=>o("tr",{key:`skeleton-${i}`},[o("td",null,[l(v,{type:"avatar",width:"40",height:"40"})]),o("td",null,[l(v,{type:"text",width:"150",class:"mb-1"}),l(v,{type:"text",width:"100",height:"16"})]),o("td",null,[l(v,{type:"chip",width:"120",height:"24"})]),o("td",null,[l(v,{type:"text",width:"100"})]),o("td",null,[l(v,{type:"text",width:"50"})]),o("td",null,[l(v,{type:"chip",width:"80",height:"24"})]),o("td",null,[o("div",se,[l(v,{type:"button",width:"32",height:"32",class:"mr-1"}),l(v,{type:"button",width:"32",height:"32"})])])])),64)):(g(),c(I,{key:1},[(g(!0),c(I,null,D(a.categories,i=>(g(),c("tr",{key:i.id},[o("td",null,[i.image?(g(),V(z,{key:0,size:"40"},{default:s(()=>[l(S,{src:r.resolveImageUrl(i.image),cover:""},null,8,["src"])]),_:2},1024)):(g(),V(z,{key:1,size:"40",color:"grey-lighten-2"},{default:s(()=>[l(C,{icon:"mdi-folder"})]),_:1}))]),o("td",null,[o("div",re,p(i.name),1),i.children&&i.children.length>0?(g(),c("div",ne,p(i.children.length)+" sub-category(ies) ",1)):y("",!0)]),o("td",null,[l(A,{size:"small",variant:"outlined"},{default:s(()=>[u(p(i.slug),1)]),_:2},1024)]),o("td",null,[i.parent?(g(),c("span",de,p(i.parent.name),1)):(g(),c("span",me,"Root"))]),o("td",null,p(i.order||0),1),o("td",null,[l(A,{color:i.published?"success":"error",size:"small"},{default:s(()=>[u(p(i.published?"Published":"Draft"),1)]),_:2},1032,["color"])]),o("td",null,[l(h,{size:"small",icon:"mdi-pencil",onClick:k=>r.editCategory(i),variant:"text",color:"primary"},null,8,["onClick"]),l(h,{size:"small",icon:"mdi-delete",onClick:k=>r.deleteCategory(i),variant:"text",color:"error"},null,8,["onClick"])])]))),128)),a.categories.length===0?(g(),c("tr",ge,e[30]||(e[30]=[o("td",{colspan:"7",class:"text-center py-4"},"No categories found",-1)]))):y("",!0)],64))])]),_:1}),o("div",ue,[o("div",pe,[a.categories.length>0&&t.pagination.total>0?(g(),c("span",he,[e[31]||(e[31]=u(" Showing ")),o("strong",null,p((t.currentPage-1)*t.perPage+1),1),e[32]||(e[32]=u(" to ")),o("strong",null,p(Math.min(t.currentPage*t.perPage,t.pagination.total)),1),e[33]||(e[33]=u(" of ")),o("strong",null,p(t.pagination.total.toLocaleString()),1),e[34]||(e[34]=u(" records ")),t.pagination.last_page>1?(g(),c("span",ce," (Page "+p(t.currentPage)+" of "+p(t.pagination.last_page)+") ",1)):y("",!0)])):(g(),c("span",fe,"No records found"))]),t.pagination.last_page>1?(g(),c("div",ve,[l(B,{modelValue:t.currentPage,"onUpdate:modelValue":[e[8]||(e[8]=i=>t.currentPage=i),r.loadCategories],length:t.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):y("",!0)])]),_:1})]),_:1}),l(G,{modelValue:a.showDialog,"onUpdate:modelValue":e[18]||(e[18]=i=>a.showDialog=i),"max-width":"800",scrollable:"",persistent:""},{default:s(()=>[l(P,null,{default:s(()=>[l(x,{class:"d-flex align-center justify-space-between bg-primary text-white pa-4"},{default:s(()=>[o("span",ye,p(a.editingCategory?"Edit Blog Category":"Create New Blog Category"),1),l(h,{icon:"mdi-close",variant:"text",color:"white",onClick:r.closeDialog},null,8,["onClick"])]),_:1}),l(F,{class:"pa-6"},{default:s(()=>[l(j,{ref:"formRef"},{default:s(()=>[l(U,null,{default:s(()=>[l(f,{cols:"12"},{default:s(()=>[l(w,{modelValue:a.form.name,"onUpdate:modelValue":e[9]||(e[9]=i=>a.form.name=i),label:"Category Name *",variant:"outlined",rules:[i=>!!i||"Name is required"]},null,8,["modelValue","rules"])]),_:1}),l(f,{cols:"12",md:"6"},{default:s(()=>[l(w,{modelValue:a.form.slug,"onUpdate:modelValue":e[10]||(e[10]=i=>a.form.slug=i),label:"Slug *",variant:"outlined",hint:"URL-friendly version of name",rules:[i=>!!i||"Slug is required"]},{append:s(()=>[l(h,{icon:"mdi-refresh",size:"small",variant:"text",onClick:r.generateSlug},null,8,["onClick"])]),_:1},8,["modelValue","rules"])]),_:1}),l(f,{cols:"12",md:"6"},{default:s(()=>[l(w,{modelValue:a.form.type,"onUpdate:modelValue":e[11]||(e[11]=i=>a.form.type=i),label:"Type",variant:"outlined",disabled:"",hint:"Blog categories are always type 'post'"},null,8,["modelValue"])]),_:1}),l(f,{cols:"12"},{default:s(()=>[l(R,{modelValue:a.form.description,"onUpdate:modelValue":e[12]||(e[12]=i=>a.form.description=i),label:"Description",variant:"outlined",rows:"3",hint:"Brief description of the category"},null,8,["modelValue"])]),_:1}),l(f,{cols:"12"},{default:s(()=>[l(M,{class:"mb-2"},{default:s(()=>e[35]||(e[35]=[u("Category Image")])),_:1,__:[35]}),l(P,{variant:"outlined",class:"pa-4"},{default:s(()=>[o("div",_e,[a.imagePreview||a.form.image?(g(),c("div",be,[l(S,{src:a.imagePreview||r.resolveImageUrl(a.form.image),"max-width":"200","max-height":"200",contain:"",class:"rounded border",style:{"min-width":"150px","min-height":"150px"}},null,8,["src"]),o("div",we,[l(h,{color:"error",size:"small",variant:"text",onClick:r.removeImage,"prepend-icon":"mdi-delete"},{default:s(()=>e[36]||(e[36]=[u(" Remove Image ")])),_:1,__:[36]},8,["onClick"])])])):y("",!0),o("div",Ce,[l(L,{modelValue:a.imageFile,"onUpdate:modelValue":[e[13]||(e[13]=i=>a.imageFile=i),r.handleImageSelect],accept:"image/*",label:"Select Category Image",variant:"outlined","prepend-icon":"","prepend-inner-icon":"mdi-image","show-size":"",clearable:"",hint:"Recommended size: 400x400px or larger. Max file size: 5MB","persistent-hint":""},{append:s(()=>[a.uploadingImage?(g(),V(N,{key:0,indeterminate:"",color:"primary",size:"24"})):y("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"]),a.imageFile&&a.imageFile.size>5242880?(g(),V(O,{key:0,type:"warning",variant:"tonal",density:"compact",class:"mt-2"},{default:s(()=>e[37]||(e[37]=[u(" File size is larger than 5MB. Please choose a smaller image. ")])),_:1,__:[37]})):y("",!0),!a.imagePreview&&!a.form.image&&!a.imageFile?(g(),c("div",Pe," No image selected. Upload an image to display with this category. ")):y("",!0),l(w,{modelValue:a.form.image,"onUpdate:modelValue":e[14]||(e[14]=i=>a.form.image=i),label:"Or enter image URL directly",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-link",hint:"Enter a direct image URL",class:"mt-2",clearable:""},null,8,["modelValue"])])])]),_:1})]),_:1}),l(f,{cols:"12",md:"6"},{default:s(()=>[l(_,{modelValue:a.form.parent_id,"onUpdate:modelValue":e[15]||(e[15]=i=>a.form.parent_id=i),items:r.parentCategoryOptions,"item-title":"name","item-value":"id",label:"Parent Category",variant:"outlined",clearable:"",hint:"Select parent category for hierarchical structure"},{item:s(({props:i,item:k})=>[l(H,K(i,{title:k.raw.name}),{prepend:s(()=>[l(C,{icon:"mdi-folder",class:"mr-2"})]),_:2},1040,["title"])]),_:1},8,["modelValue","items"])]),_:1}),l(f,{cols:"12",md:"6"},{default:s(()=>[l(w,{modelValue:a.form.order,"onUpdate:modelValue":e[16]||(e[16]=i=>a.form.order=i),modelModifiers:{number:!0},label:"Display Order",variant:"outlined",type:"number",hint:"Lower numbers appear first"},null,8,["modelValue"])]),_:1}),l(f,{cols:"12"},{default:s(()=>[l(T,{modelValue:a.form.published,"onUpdate:modelValue":e[17]||(e[17]=i=>a.form.published=i),label:"Published",color:"success"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),l(W,{class:"pa-4 bg-grey-lighten-4"},{default:s(()=>[l(q),l(h,{variant:"text",onClick:r.closeDialog},{default:s(()=>e[38]||(e[38]=[u("Cancel")])),_:1,__:[38]},8,["onClick"]),l(h,{color:"primary",variant:"flat",onClick:r.saveCategory,loading:a.saving},{default:s(()=>[u(p(a.editingCategory?"Update":"Create")+" Category ",1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Ue=J(Z,[["render",Ve],["__scopeId","data-v-db46ee13"]]);export{Ue as default};
