import{_ as j,d as c,a as l,b as o,w as a,f as p,r as n,h as w,t as d,F as E,e as S,c as y,i as G,D as H,E as W,y as x,g as U,o as u}from"./app-aVdZPH9_.js";import{a as J}from"./adminPaginationMixin-DN7Wb3ng.js";const Y={mixins:[J],data(){return{users:[],roles:[],roleFilter:null,roleOptions:[],dialog:!1,editingUser:null,saving:!1,form:{name:"",email:"",role_ids:[],password:"",password_confirmation:"",avatar:""},rules:{required:s=>Array.isArray(s)?s.length>0||"At least one role is required":!!s||"This field is required",email:s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)||"Invalid email",minLength:s=>s?s.length>=8||"Password must be at least 8 characters":!0},currentUserId:null,showPassword:!1,showPasswordConfirmation:!1,avatarFile:null,uploadingAvatar:!1}},async mounted(){await this.loadRoles(),await this.loadUsers(),this.loadCurrentUser()},methods:{async loadUsers(){try{this.loading=!0;const s=this.buildPaginationParams();this.search&&(s.search=this.search),this.roleFilter&&(s.role=this.roleFilter);const e=await U.get("/api/v1/users",{params:s,headers:this.getAuthHeaders()});this.users=e.data.data,this.updatePagination(e.data)}catch(s){this.handleApiError(s,"Failed to load users")}finally{this.loading=!1}},async loadRoles(){try{const s=await U.get("/api/v1/users/roles",{headers:this.getAuthHeaders()});this.roles=s.data.roles,this.roleOptions=this.roles.map(e=>({title:e.label,value:e.value}))}catch(s){console.error("Error loading roles:",s)}},loadCurrentUser(){const s=localStorage.getItem("admin_token");U.get("/api/v1/auth/user",{headers:{Authorization:`Bearer ${s}`}}).then(e=>{this.currentUserId=e.data.id}).catch(()=>{})},openDialog(s){if(this.avatarFile=null,s){this.editingUser=s;const e=s.roles?s.roles.map(g=>g.id):[];this.form={name:s.name,email:s.email,role_ids:e,password:"",password_confirmation:"",avatar:s.avatar||""}}else{this.editingUser=null;const e=this.roles.length>0?this.roles[0].value:null;this.form={name:"",email:"",role_ids:e?[e]:[],password:"",password_confirmation:"",avatar:""}}this.dialog=!0},closeDialog(){this.dialog=!1,this.editingUser=null;const s=this.roles.length>0?this.roles[0].value:null;this.form={name:"",email:"",role_ids:s?[s]:[],password:"",password_confirmation:"",avatar:""},this.showPassword=!1,this.showPasswordConfirmation=!1,this.avatarFile=null,this.$refs.form&&this.$refs.form.resetValidation()},async handleAvatarUpload(){var g;if(!this.avatarFile)return;const s=Array.isArray(this.avatarFile)?this.avatarFile[0]:this.avatarFile;if(!s)return;if(!s.type.startsWith("image/")){this.showError("Please select a valid image file"),this.avatarFile=null;return}const e=5*1024*1024;if(s.size>e){this.showError("File size must be less than 5MB"),this.avatarFile=null;return}this.uploadingAvatar=!0;try{const f=new FormData;f.append("image",s),f.append("folder","users"),this.form.name&&f.append("prefix",this.form.name);const r=localStorage.getItem("admin_token"),i=await U.post("/api/v1/upload/image",f,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"multipart/form-data"}});if(i.data.success)this.form.avatar=i.data.url,this.avatarFile=null,this.showSuccess("Avatar uploaded successfully");else throw new Error(i.data.message||"Failed to upload avatar")}catch(f){console.error("Error uploading avatar:",f);let r="Failed to upload avatar";f.response?r=((g=f.response.data)==null?void 0:g.message)||f.response.statusText||r:f.message&&(r=f.message),this.showError(r),this.avatarFile=null}finally{this.uploadingAvatar=!1}},clearAvatar(){this.form.avatar="",this.avatarFile=null},async saveUser(){var s,e,g,f;if(this.form.password&&this.form.password!==this.form.password_confirmation){this.showError("Passwords do not match");return}if(!this.editingUser&&!this.form.password){this.showError("Password is required for new users");return}if(this.editingUser&&this.form.password&&!this.form.password_confirmation){this.showError("Please confirm the password");return}if(this.$refs.form.validate()){this.saving=!0;try{const r=localStorage.getItem("admin_token"),i=this.editingUser?`/api/v1/users/${this.editingUser.id}`:"/api/v1/users",m={...this.form};this.form.role_ids&&(m.role_ids=Array.isArray(this.form.role_ids)?this.form.role_ids:[this.form.role_ids]),this.form.password?m.password_confirmation=this.form.password_confirmation:(delete m.password,delete m.password_confirmation),delete m.role;const v=this.editingUser?"put":"post";await U[v](i,m,{headers:{Authorization:`Bearer ${r}`}}),this.showSuccess(this.editingUser?"User updated successfully":"User created successfully"),this.closeDialog(),await this.loadUsers()}catch(r){console.error("Error saving user:",r);let i="Error saving user";if((e=(s=r.response)==null?void 0:s.data)!=null&&e.errors){const m=r.response.data.errors,v=[];Object.keys(m).forEach(b=>{v.push(m[b][0])}),i=v.join(", ")}else(f=(g=r.response)==null?void 0:g.data)!=null&&f.message&&(i=r.response.data.message);this.showError(i)}finally{this.saving=!1}}},async deleteUser(s){if(s.id===this.currentUserId){this.showError("You cannot delete your own account");return}if(confirm(`Are you sure you want to delete ${s.name}?`))try{const e=localStorage.getItem("admin_token");await U.delete(`/api/v1/users/${s.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.showSuccess("User deleted successfully"),await this.loadUsers()}catch(e){this.handleApiError(e,"Error deleting user")}},getRoleLabel(s){const e=this.roles.find(g=>g.slug===s);return e?e.label:s},getRoleColor(s){return{administrator:"error",editor:"primary","hr-user":"success",staff:"info"}[s]||"primary"},onPerPageChange(){this.resetPagination(),this.loadUsers()},onSort(s){this.handleSort(s),this.loadUsers()}}},K={class:"page-header"},Q={class:"text-caption text-grey"},X={key:0},Z={class:"d-flex align-center"},$={class:"d-flex align-center"},ee={class:"d-flex align-center"},se={class:"d-flex align-center gap-2"},re={key:1,class:"text-white"},te={key:0,class:"d-flex flex-wrap gap-1"},oe={key:1,class:"text-caption text-grey"},ae={key:0},le={class:"d-flex justify-space-between align-center mt-4"},ie={class:"text-caption text-grey"},ne={key:0},de={key:1},me={key:1,class:"text-grey text-caption align-self-center"},ue={class:"mb-4"},pe={key:0,class:"mb-3 text-center"};function fe(s,e,g,f,r,i){const m=n("v-btn"),v=n("v-select"),b=n("v-col"),_=n("v-text-field"),I=n("v-row"),P=n("v-card-text"),V=n("v-card"),A=n("v-card-title"),k=n("v-icon"),F=n("v-img"),z=n("v-avatar"),C=n("v-chip"),R=n("v-table"),q=n("v-pagination"),N=n("v-list-item"),D=n("v-progress-circular"),B=n("v-file-input"),M=n("v-form"),L=n("v-spacer"),O=n("v-card-actions"),T=n("v-dialog");return u(),c("div",null,[l("div",K,[e[20]||(e[20]=l("h1",{class:"text-h4 page-title"},"User Management",-1)),o(m,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=t=>i.openDialog(null)),class:"add-button"},{default:a(()=>e[19]||(e[19]=[p(" Add New User ")])),_:1,__:[19]})]),o(V,{class:"mb-4"},{default:a(()=>[o(P,null,{default:a(()=>[o(I,null,{default:a(()=>[o(b,{cols:"12",md:"4"},{default:a(()=>[o(v,{modelValue:s.perPage,"onUpdate:modelValue":[e[1]||(e[1]=t=>s.perPage=t),i.onPerPageChange],items:s.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(b,{cols:"12",md:"4"},{default:a(()=>[o(v,{modelValue:r.roleFilter,"onUpdate:modelValue":[e[2]||(e[2]=t=>r.roleFilter=t),i.loadUsers],items:r.roleOptions,label:"Filter by Role",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(b,{cols:"12",md:"4"},{default:a(()=>[o(_,{modelValue:s.search,"onUpdate:modelValue":e[3]||(e[3]=t=>s.search=t),label:"Search by name or email","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:i.loadUsers},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),o(V,null,{default:a(()=>[o(A,{class:"d-flex justify-space-between align-center"},{default:a(()=>[e[22]||(e[22]=l("span",null,"Users",-1)),l("span",Q,[e[21]||(e[21]=p(" Total Records: ")),l("strong",null,d(s.pagination.total||0),1),r.users.length>0?(u(),c("span",X," | Showing "+d((s.currentPage-1)*s.perPage+1)+" to "+d(Math.min(s.currentPage*s.perPage,s.pagination.total))+" of "+d(s.pagination.total),1)):w("",!0)])]),_:1,__:[22]}),o(P,null,{default:a(()=>[o(R,null,{default:a(()=>[l("thead",null,[l("tr",null,[l("th",{class:"sortable",onClick:e[4]||(e[4]=t=>i.onSort("name"))},[l("div",Z,[e[23]||(e[23]=p(" Name ")),o(k,{icon:s.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),l("th",{class:"sortable",onClick:e[5]||(e[5]=t=>i.onSort("email"))},[l("div",$,[e[24]||(e[24]=p(" Email ")),o(k,{icon:s.getSortIcon("email"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[26]||(e[26]=l("th",null,"Role",-1)),l("th",{class:"sortable",onClick:e[6]||(e[6]=t=>i.onSort("created_at"))},[l("div",ee,[e[25]||(e[25]=p(" Created ")),o(k,{icon:s.getSortIcon("created_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[27]||(e[27]=l("th",null,"Actions",-1))])]),l("tbody",null,[(u(!0),c(E,null,S(r.users,t=>(u(),c("tr",{key:t.id},[l("td",null,[l("div",se,[o(z,{size:"32",color:"primary"},{default:a(()=>[t.avatar?(u(),y(F,{key:0,src:t.avatar,alt:t.name},null,8,["src","alt"])):(u(),c("span",re,d(t.name.charAt(0).toUpperCase()),1))]),_:2},1024),p(" "+d(t.name),1)])]),l("td",null,d(t.email),1),l("td",null,[t.roles&&t.roles.length>0?(u(),c("div",te,[(u(!0),c(E,null,S(t.roles,h=>(u(),y(C,{key:h.id,color:i.getRoleColor(h.slug),size:"small"},{default:a(()=>[p(d(h.name),1)]),_:2},1032,["color"]))),128))])):(u(),c("span",oe,"No roles"))]),l("td",null,d(s.formatDate(t.created_at)),1),l("td",null,[o(m,{size:"small",icon:"mdi-pencil",onClick:h=>i.openDialog(t),variant:"text"},null,8,["onClick"]),o(m,{size:"small",icon:"mdi-delete",onClick:h=>i.deleteUser(t),variant:"text",color:"error",disabled:t.id===r.currentUserId},null,8,["onClick","disabled"])])]))),128)),r.users.length===0?(u(),c("tr",ae,e[28]||(e[28]=[l("td",{colspan:"5",class:"text-center py-4"},"No users found",-1)]))):w("",!0)])]),_:1}),l("div",le,[l("div",ie,[r.users.length>0?(u(),c("span",ne," Showing "+d((s.currentPage-1)*s.perPage+1)+" to "+d(Math.min(s.currentPage*s.perPage,s.pagination.total))+" of "+d(s.pagination.total)+" records ",1)):(u(),c("span",de," No records found "))]),s.pagination.last_page>1?(u(),y(q,{key:0,modelValue:s.currentPage,"onUpdate:modelValue":[e[7]||(e[7]=t=>s.currentPage=t),i.loadUsers],length:s.pagination.last_page},null,8,["modelValue","length","onUpdate:modelValue"])):w("",!0)])]),_:1})]),_:1}),o(T,{modelValue:r.dialog,"onUpdate:modelValue":e[18]||(e[18]=t=>r.dialog=t),"max-width":"600",persistent:""},{default:a(()=>[o(V,null,{default:a(()=>[o(A,null,{default:a(()=>[p(d(r.editingUser?"Edit User":"Add New User"),1)]),_:1}),o(P,null,{default:a(()=>[o(M,{ref:"form",onSubmit:G(i.saveUser,["prevent"])},{default:a(()=>[o(_,{modelValue:r.form.name,"onUpdate:modelValue":e[8]||(e[8]=t=>r.form.name=t),label:"Full Name",rules:[r.rules.required],required:"",class:"mb-4"},null,8,["modelValue","rules"]),o(_,{modelValue:r.form.email,"onUpdate:modelValue":e[9]||(e[9]=t=>r.form.email=t),label:"Email",type:"email",rules:[r.rules.required,r.rules.email],required:"",class:"mb-4"},null,8,["modelValue","rules"]),o(v,{modelValue:r.form.role_ids,"onUpdate:modelValue":e[10]||(e[10]=t=>r.form.role_ids=t),items:r.roles,"item-title":"label","item-value":"value",label:"Roles",rules:[r.rules.required],required:"",multiple:"",chips:"",class:"mb-4"},{item:a(({props:t,item:h})=>[o(N,H(W(t)),{title:a(()=>[p(d(h.raw.label)+" ",1),h.raw.is_system?(u(),y(C,{key:0,size:"x-small",color:"warning",class:"ml-2"},{default:a(()=>e[29]||(e[29]=[p(" System ")])),_:1,__:[29]})):w("",!0)]),subtitle:a(()=>[p(d(h.raw.description),1)]),_:2},1040)]),selection:a(({item:t,index:h})=>[h<2?(u(),y(C,{key:0,size:"small",class:"mr-1"},{default:a(()=>[p(d(t.raw.label),1)]),_:2},1024)):w("",!0),h===2?(u(),c("span",me," (+"+d(r.form.role_ids.length-2)+" others) ",1)):w("",!0)]),_:1},8,["modelValue","items","rules"]),o(_,{modelValue:r.form.password,"onUpdate:modelValue":e[12]||(e[12]=t=>r.form.password=t),label:"Password",type:r.showPassword?"text":"password",rules:r.editingUser?[]:[r.rules.required,r.rules.minLength],required:!r.editingUser,hint:"Leave blank to keep current password","persistent-hint":"",class:"mb-4"},{"append-inner":a(()=>[o(m,{icon:"",variant:"text",size:"small",onClick:e[11]||(e[11]=t=>r.showPassword=!r.showPassword)},{default:a(()=>[o(k,null,{default:a(()=>[p(d(r.showPassword?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","type","rules","required"]),!r.editingUser||r.form.password?(u(),y(_,{key:0,modelValue:r.form.password_confirmation,"onUpdate:modelValue":e[14]||(e[14]=t=>r.form.password_confirmation=t),label:"Confirm Password",type:r.showPasswordConfirmation?"text":"password",rules:r.form.password?[()=>!!r.form.password_confirmation||"Please confirm your password",()=>r.form.password_confirmation===r.form.password||"Passwords do not match"]:[],required:!!r.form.password,class:"mb-4"},{"append-inner":a(()=>[o(m,{icon:"",variant:"text",size:"small",onClick:e[13]||(e[13]=t=>r.showPasswordConfirmation=!r.showPasswordConfirmation)},{default:a(()=>[o(k,null,{default:a(()=>[p(d(r.showPasswordConfirmation?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","type","rules","required"])):w("",!0),l("div",ue,[e[31]||(e[31]=l("div",{class:"text-subtitle-2 font-weight-medium mb-2"},"Avatar",-1)),r.form.avatar?(u(),c("div",pe,[o(z,{size:"80",class:"mb-2"},{default:a(()=>[o(F,{src:r.form.avatar,alt:"Avatar Preview"},null,8,["src"])]),_:1}),l("div",null,[o(m,{size:"small",variant:"text",color:"error","prepend-icon":"mdi-delete",onClick:i.clearAvatar},{default:a(()=>e[30]||(e[30]=[p("Remove Avatar")])),_:1,__:[30]},8,["onClick"])])])):w("",!0),o(B,{modelValue:r.avatarFile,"onUpdate:modelValue":[e[15]||(e[15]=t=>r.avatarFile=t),i.handleAvatarUpload],label:"Upload Avatar",variant:"outlined",density:"comfortable",color:"primary",accept:"image/*","prepend-icon":"mdi-image",hint:"Upload an avatar image (JPG, PNG, GIF, WebP - Max 5MB). Recommended size: 200x200px","persistent-hint":"","show-size":"",class:"mb-3"},x({_:2},[r.uploadingAvatar?{name:"append-inner",fn:a(()=>[o(D,{indeterminate:"",size:"20",color:"primary"})]),key:"0"}:void 0]),1032,["modelValue","onUpdate:modelValue"]),o(_,{modelValue:r.form.avatar,"onUpdate:modelValue":e[17]||(e[17]=t=>r.form.avatar=t),label:"Or Enter Avatar URL",variant:"outlined",density:"comfortable",color:"primary",hint:"Enter a direct URL to the avatar image","persistent-hint":"","prepend-inner-icon":"mdi-link"},x({_:2},[r.form.avatar&&!r.avatarFile?{name:"append-inner",fn:a(()=>[o(m,{icon:"mdi-open-in-new",variant:"text",size:"small",onClick:e[16]||(e[16]=t=>s.window.open(r.form.avatar,"_blank"))})]),key:"0"}:void 0]),1032,["modelValue"])])]),_:1},8,["onSubmit"])]),_:1}),o(O,null,{default:a(()=>[o(L),o(m,{onClick:i.closeDialog,variant:"text"},{default:a(()=>e[32]||(e[32]=[p("Cancel")])),_:1,__:[32]},8,["onClick"]),o(m,{onClick:i.saveUser,color:"primary",loading:r.saving},{default:a(()=>[p(d(r.editingUser?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const ge=j(Y,[["render",fe],["__scopeId","data-v-0fa9c8d8"]]);export{ge as default};
