import{_ as H,c as g,e as o,a as l,w as i,b as a,r as u,g as y,h as V,F as G,d as C,t as d,i as L,k as K,f as k,o as m,l as R}from"./app-DEsViFz-.js";import{a as O}from"./adminPaginationMixin-DN7Wb3ng.js";const T={mixins:[O],data(){return{permissions:[],groupedPermissions:{},groups:[],dialog:!1,editingPermission:null,viewMode:"flat",searchQuery:"",selectedGroup:null,newGroup:"",form:{name:"",slug:"",group:"",description:""},rules:{required:t=>!!t||"This field is required"}}},async mounted(){await this.loadGroups(),await this.loadPermissions()},methods:{async loadPermissions(){try{this.loading=!0;const t={};this.searchQuery&&(t.search=this.searchQuery),this.selectedGroup&&(t.group=this.selectedGroup),this.viewMode==="grouped"?t.grouped=!0:(t.page=this.currentPage,t.per_page=this.perPage);const e=await k.get("/api/v1/permissions",{params:t,headers:this.getAuthHeaders()});this.viewMode==="grouped"?(this.groupedPermissions=e.data,this.permissions=[],Object.values(e.data).forEach(c=>{this.permissions.push(...c)}),this.pagination={current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length}):(e.data.data?(this.permissions=e.data.data||[],this.pagination={current_page:e.data.current_page,last_page:e.data.last_page,per_page:e.data.per_page,total:e.data.total}):(this.permissions=e.data||[],this.pagination={current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length}),this.groupedPermissions={},this.permissions.forEach(c=>{this.groupedPermissions[c.group]||(this.groupedPermissions[c.group]=[]),this.groupedPermissions[c.group].push(c)}))}catch(t){this.handleApiError(t,"Failed to load permissions")}finally{this.loading=!1}},async loadGroups(){try{const t=await k.get("/api/v1/permissions/groups",{headers:this.getAuthHeaders()});t.data&&t.data.length>0?typeof t.data[0]=="string"?this.groups=t.data.map(e=>({name:e,permissions_count:0})):this.groups=t.data:this.groups=[]}catch(t){console.error("Error loading groups:",t),this.groups=[]}},openDialog(t){t?(this.editingPermission=t,this.form={name:t.name,slug:t.slug,group:t.group,description:t.description||""}):(this.editingPermission=null,this.form={name:"",slug:"",group:"",description:""}),this.dialog=!0},closeDialog(){this.dialog=!1,this.editingPermission=null,this.form={name:"",slug:"",group:"",description:""},this.$refs.permissionForm&&this.$refs.permissionForm.resetValidation()},autoGenerateSlugFromName(){!this.form.slug&&this.form.name&&!this.editingPermission&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))},addNewGroup(){if(this.newGroup&&!this.groups.find(t=>t.name===this.newGroup||typeof t=="string"&&t===this.newGroup)){const t=this.newGroup.trim();this.groups.push({name:t,permissions_count:0}),this.form.group=t,this.newGroup=""}},async savePermission(){if(!this.$refs.permissionForm){this.showError("Form reference not found");return}if(this.$refs.permissionForm.validate()){!this.form.slug&&this.form.name&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")),this.saving=!0;try{const t=this.editingPermission?`/api/v1/permissions/${this.editingPermission.id}`:"/api/v1/permissions",e=this.editingPermission?"put":"post",c={name:this.form.name.trim(),slug:this.form.slug?this.form.slug.trim():null,group:this.form.group.trim(),description:this.form.description?this.form.description.trim():null};await k[e](t,c,{headers:this.getAuthHeaders()}),this.showSuccess(this.editingPermission?"Permission updated successfully":"Permission created successfully"),this.closeDialog(),await this.loadGroups(),await this.loadPermissions()}catch(t){this.handleApiError(t,"Error saving permission")}finally{this.saving=!1}}},async deletePermission(t){if((t.roles_count||0)>0){this.showError("Cannot delete permission that is assigned to roles. Please remove it from all roles first.");return}if(confirm(`Are you sure you want to delete the permission "${t.name}"?`))try{await k.delete(`/api/v1/permissions/${t.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Permission deleted successfully"),await this.loadPermissions()}catch(e){this.handleApiError(e,"Error deleting permission")}},getGroupColor(t){return{general:"primary",content:"success",users:"info",leads:"warning",careers:"purple",settings:"orange",system:"error"}[t]||"grey"},onPerPageChange(){this.resetPagination(),this.loadPermissions()},onSort(t){this.handleSort(t),this.loadPermissions()},filterByGroup(t){this.selectedGroup===t?this.clearGroupFilter():(this.selectedGroup=t,this.resetPagination(),this.loadPermissions())},clearGroupFilter(){this.selectedGroup=null,this.resetPagination(),this.loadPermissions()}},watch:{viewMode(){this.currentPage=1,this.loadPermissions()}}},j={class:"page-header"},J={class:"d-flex align-center flex-wrap",style:{gap:"8px"}},W={key:0},X={class:"text-h6 mb-3"},Y={class:"d-flex align-center"},Z={class:"d-flex align-center"},$={class:"font-weight-medium"},ee={class:"text-caption text-grey"},se={class:"d-flex align-center"},te={class:"d-flex align-center"},le={class:"d-flex align-center"},oe={class:"font-weight-medium"},ie={class:"text-caption text-grey"},ne={key:0};function re(t,e,c,ae,n,r){const f=u("v-btn"),x=u("v-select"),z=u("v-col"),P=u("v-text-field"),U=u("v-row"),w=u("v-card-text"),b=u("v-card"),v=u("v-icon"),N=u("v-btn-toggle"),h=u("v-chip"),S=u("v-card-title"),F=u("v-table"),A=u("v-pagination"),M=u("v-list-item"),D=u("v-textarea"),E=u("v-form"),B=u("v-spacer"),q=u("v-card-actions"),I=u("v-dialog");return m(),g("div",null,[o("div",j,[e[18]||(e[18]=o("h1",{class:"text-h4 page-title"},"Permission Management",-1)),l(f,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=s=>r.openDialog(null)),class:"add-button"},{default:i(()=>e[17]||(e[17]=[a(" Add New Permission ")])),_:1,__:[17]})]),l(b,{class:"mb-4"},{default:i(()=>[l(w,null,{default:i(()=>[l(U,null,{default:i(()=>[n.viewMode==="flat"?(m(),y(z,{key:0,cols:"12",md:"4"},{default:i(()=>[l(x,{modelValue:t.perPage,"onUpdate:modelValue":[e[1]||(e[1]=s=>t.perPage=s),r.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1})):V("",!0),l(z,{cols:"12",md:n.viewMode==="flat"?4:6},{default:i(()=>[l(x,{modelValue:n.selectedGroup,"onUpdate:modelValue":[e[2]||(e[2]=s=>n.selectedGroup=s),r.loadPermissions],items:n.groups,"item-title":s=>typeof s=="string"?s:s.name,"item-value":s=>typeof s=="string"?s:s.name,label:"Filter by Group","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","item-title","item-value","onUpdate:modelValue"])]),_:1},8,["md"]),l(z,{cols:"12",md:n.viewMode==="flat"?4:6},{default:i(()=>[l(P,{modelValue:n.searchQuery,"onUpdate:modelValue":[e[3]||(e[3]=s=>n.searchQuery=s),r.loadPermissions],label:"Search permissions","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["md"])]),_:1})]),_:1})]),_:1}),l(b,{class:"mb-4"},{default:i(()=>[l(w,{class:"py-3"},{default:i(()=>[o("div",J,[l(N,{modelValue:n.viewMode,"onUpdate:modelValue":e[4]||(e[4]=s=>n.viewMode=s),mandatory:"",density:"compact",class:"mr-4"},{default:i(()=>[l(f,{value:"flat",size:"small"},{default:i(()=>[l(v,{start:""},{default:i(()=>e[19]||(e[19]=[a("mdi-format-list-bulleted")])),_:1,__:[19]}),e[20]||(e[20]=a(" Flat View "))]),_:1,__:[20]}),l(f,{value:"grouped",size:"small"},{default:i(()=>[l(v,{start:""},{default:i(()=>e[21]||(e[21]=[a("mdi-folder")])),_:1,__:[21]}),e[22]||(e[22]=a(" Grouped View "))]),_:1,__:[22]})]),_:1},8,["modelValue"]),e[24]||(e[24]=o("span",{class:"text-caption text-grey mr-2"},"Filter by Group:",-1)),(m(!0),g(G,null,C(n.groups,s=>(m(),y(h,{key:s.name,color:r.getGroupColor(s.name),size:"small",variant:n.selectedGroup===s.name?"flat":"outlined",class:R([{"font-weight-bold":n.selectedGroup===s.name},"group-filter-chip"]),onClick:_=>r.filterByGroup(s.name),style:{cursor:"pointer"}},{default:i(()=>[a(d(s.name)+" ",1),l(h,{size:"x-small",color:n.selectedGroup===s.name?"white":r.getGroupColor(s.name),variant:"flat",class:"ml-2"},{default:i(()=>[a(d(s.permissions_count||0),1)]),_:2},1032,["color"])]),_:2},1032,["color","variant","class","onClick"]))),128)),n.selectedGroup?(m(),y(h,{key:0,size:"small",color:"grey",variant:"text","prepend-icon":"mdi-close",onClick:r.clearGroupFilter,style:{cursor:"pointer"},class:"ml-2"},{default:i(()=>e[23]||(e[23]=[a(" Clear Filter ")])),_:1,__:[23]},8,["onClick"])):V("",!0)])]),_:1})]),_:1}),l(b,null,{default:i(()=>[l(S,null,{default:i(()=>e[25]||(e[25]=[a("Permissions")])),_:1,__:[25]}),l(w,null,{default:i(()=>[n.viewMode==="grouped"?(m(),g("div",W,[(m(!0),g(G,null,C(n.groupedPermissions,(s,_)=>(m(),g("div",{key:_,class:"mb-6"},[o("h3",X,[a(d(_.charAt(0).toUpperCase()+_.slice(1))+" ",1),l(h,{size:"small",color:"primary",variant:"text",class:"ml-2"},{default:i(()=>[a(d(s.length)+" permission"+d(s.length!==1?"s":""),1)]),_:2},1024)]),l(F,null,{default:i(()=>[o("thead",null,[o("tr",null,[o("th",{class:"sortable",onClick:e[5]||(e[5]=p=>r.onSort("name"))},[o("div",Y,[e[26]||(e[26]=a(" Name ")),l(v,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),o("th",{class:"sortable",onClick:e[6]||(e[6]=p=>r.onSort("slug"))},[o("div",Z,[e[27]||(e[27]=a(" Slug ")),l(v,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[28]||(e[28]=o("th",null,"Description",-1)),e[29]||(e[29]=o("th",null,"Roles",-1)),e[30]||(e[30]=o("th",null,"Actions",-1))])]),o("tbody",null,[(m(!0),g(G,null,C(s,p=>(m(),g("tr",{key:p.id},[o("td",null,[o("div",$,d(p.name),1)]),o("td",null,[l(h,{size:"small",variant:"outlined"},{default:i(()=>[a(d(p.slug),1)]),_:2},1024)]),o("td",null,[o("span",ee,d(p.description||"No description"),1)]),o("td",null,[l(h,{size:"small",color:"info",variant:"text"},{default:i(()=>[a(d(p.roles_count||0)+" role"+d((p.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),o("td",null,[l(f,{size:"small",icon:"mdi-pencil",onClick:Q=>r.openDialog(p),variant:"text"},null,8,["onClick"]),l(f,{size:"small",icon:"mdi-delete",onClick:Q=>r.deletePermission(p),variant:"text",color:"error",disabled:(p.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128))])]),_:2},1024)]))),128))])):(m(),y(F,{key:1},{default:i(()=>[o("thead",null,[o("tr",null,[o("th",{class:"sortable",onClick:e[7]||(e[7]=s=>r.onSort("name"))},[o("div",se,[e[31]||(e[31]=a(" Name ")),l(v,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),o("th",{class:"sortable",onClick:e[8]||(e[8]=s=>r.onSort("slug"))},[o("div",te,[e[32]||(e[32]=a(" Slug ")),l(v,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),o("th",{class:"sortable",onClick:e[9]||(e[9]=s=>r.onSort("group"))},[o("div",le,[e[33]||(e[33]=a(" Group ")),l(v,{icon:t.getSortIcon("group"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[34]||(e[34]=o("th",null,"Description",-1)),e[35]||(e[35]=o("th",null,"Roles",-1)),e[36]||(e[36]=o("th",null,"Actions",-1))])]),o("tbody",null,[(m(!0),g(G,null,C(n.permissions,s=>(m(),g("tr",{key:s.id},[o("td",null,[o("div",oe,d(s.name),1)]),o("td",null,[l(h,{size:"small",variant:"outlined"},{default:i(()=>[a(d(s.slug),1)]),_:2},1024)]),o("td",null,[l(h,{size:"small",color:r.getGroupColor(s.group)},{default:i(()=>[a(d(s.group),1)]),_:2},1032,["color"])]),o("td",null,[o("span",ie,d(s.description||"No description"),1)]),o("td",null,[l(h,{size:"small",color:"info",variant:"text"},{default:i(()=>[a(d(s.roles_count||0)+" role"+d((s.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),o("td",null,[l(f,{size:"small",icon:"mdi-pencil",onClick:_=>r.openDialog(s),variant:"text"},null,8,["onClick"]),l(f,{size:"small",icon:"mdi-delete",onClick:_=>r.deletePermission(s),variant:"text",color:"error",disabled:(s.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128)),n.permissions.length===0?(m(),g("tr",ne,e[37]||(e[37]=[o("td",{colspan:"6",class:"text-center py-4"},"No permissions found",-1)]))):V("",!0)])]),_:1})),n.viewMode==="flat"&&t.pagination.last_page>1?(m(),y(A,{key:2,modelValue:t.currentPage,"onUpdate:modelValue":[e[10]||(e[10]=s=>t.currentPage=s),r.loadPermissions],length:t.pagination.last_page,class:"mt-4"},null,8,["modelValue","length","onUpdate:modelValue"])):V("",!0)]),_:1})]),_:1}),l(I,{modelValue:n.dialog,"onUpdate:modelValue":e[16]||(e[16]=s=>n.dialog=s),"max-width":"600",persistent:""},{default:i(()=>[l(b,null,{default:i(()=>[l(S,null,{default:i(()=>[a(d(n.editingPermission?"Edit Permission":"Add New Permission"),1)]),_:1}),l(w,null,{default:i(()=>[l(E,{ref:"permissionForm",onSubmit:L(r.savePermission,["prevent"])},{default:i(()=>[l(P,{modelValue:n.form.name,"onUpdate:modelValue":e[11]||(e[11]=s=>n.form.name=s),label:"Permission Name",rules:[n.rules.required],required:"",hint:"Display name for the permission (e.g., 'Manage Pages')","persistent-hint":"",class:"mb-4",onBlur:r.autoGenerateSlugFromName},null,8,["modelValue","rules","onBlur"]),l(P,{modelValue:n.form.slug,"onUpdate:modelValue":e[12]||(e[12]=s=>n.form.slug=s),label:"Slug",hint:"URL-friendly identifier (auto-generated if empty)","persistent-hint":"",class:"mb-4"},null,8,["modelValue"]),l(x,{modelValue:n.form.group,"onUpdate:modelValue":e[14]||(e[14]=s=>n.form.group=s),items:n.groups,"item-title":s=>typeof s=="string"?s:s.name,"item-value":s=>typeof s=="string"?s:s.name,label:"Group",rules:[n.rules.required],required:"",hint:"Category/group for organizing permissions","persistent-hint":"",class:"mb-4"},{"append-item":i(()=>[l(M,null,{default:i(()=>[l(P,{modelValue:n.newGroup,"onUpdate:modelValue":e[13]||(e[13]=s=>n.newGroup=s),label:"Add New Group","prepend-inner-icon":"mdi-plus",variant:"outlined",density:"compact",onKeyup:K(r.addNewGroup,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["modelValue","items","item-title","item-value","rules"]),l(D,{modelValue:n.form.description,"onUpdate:modelValue":e[15]||(e[15]=s=>n.form.description=s),label:"Description",hint:"Brief description of what this permission allows","persistent-hint":"",rows:"2",class:"mb-4"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),l(q,null,{default:i(()=>[l(B),l(f,{onClick:r.closeDialog,variant:"text"},{default:i(()=>e[38]||(e[38]=[a("Cancel")])),_:1,__:[38]},8,["onClick"]),l(f,{onClick:r.savePermission,color:"primary",loading:t.saving},{default:i(()=>[a(d(n.editingPermission?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const me=H(T,[["render",re]]);export{me as default};
