import{a as G}from"./adminPaginationMixin-DN7Wb3ng.js";import{r as J,n as K}from"./uploads-CnEkgyD_.js";import{_ as Q,d as c,a as o,b as l,w as s,f as u,r as n,g as y,t as p,F as k,e as A,c as P,m as X,o as m}from"./app-DFUhJa7k.js";const Y={mixins:[G],data(){return{categories:[],showDialog:!1,editingCategory:null,saving:!1,publishedFilter:null,publishedOptions:[{title:"Published",value:!0},{title:"Draft",value:!1}],form:{name:"",slug:"",type:"post",description:"",image:"",parent_id:null,order:0,published:!0},allCategories:[],originalSlug:null,originalId:null,imageFile:null,imagePreview:null,uploadingImage:!1}},computed:{parentCategoryOptions(){return this.allCategories.filter(t=>this.editingCategory&&t.id===this.editingCategory.id?!1:t.type==="post").map(t=>({id:t.id,name:t.name,type:t.type}))}},watch:{"form.image"(t){t&&!this.imageFile?this.imagePreview=this.resolveImageUrl(t):!t&&!this.imageFile&&(this.imagePreview=null)}},async mounted(){await Promise.all([this.loadCategories(),this.loadAllCategories()])},methods:{async loadCategories(){try{this.loading=!0;const t=this.buildPaginationParams();t.type="post",this.search&&(t.search=this.search),this.publishedFilter!==null&&(t.published=this.publishedFilter);const e=await this.$axios.get("/api/v1/blog-categories",{params:t,headers:this.getAuthHeaders()}),g=e.data.data||[];this.categories=g.map(d=>({...d,image:this.resolveImageUrl(d.image)})),this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load blog categories")}finally{this.loading=!1}},async loadAllCategories(){var t;try{const e=await this.$axios.get("/api/v1/blog-categories",{params:{per_page:1e3},headers:this.getAuthHeaders()}).catch(()=>({data:{data:[]}}));this.allCategories=((t=e.data)==null?void 0:t.data)||[]}catch(e){console.error("Error loading all categories:",e),this.allCategories=[]}},openDialog(t=null){this.editingCategory=t,t?this.loadCategoryForEdit(t):this.resetForm(),this.showDialog=!0},async loadCategoryForEdit(t){try{this.loading=!0;const e=t.id||t.slug,d=(await this.$axios.get(`/api/v1/blog-categories/${e}`,{headers:this.getAuthHeaders()})).data,a=this.normalizeImageInput(d.image||"");this.form={name:d.name||"",slug:d.slug||"",type:"post",description:d.description||"",image:a,parent_id:d.parent_id||null,order:d.order||0,published:d.published!==!1},this.originalSlug=d.slug,this.originalId=d.id,this.imageFile=null,this.imagePreview=this.resolveImageUrl(d.image||a)}catch(e){this.handleApiError(e,"Failed to load category"),this.closeDialog()}finally{this.loading=!1}},resetForm(){this.form={name:"",slug:"",type:"post",description:"",image:"",parent_id:null,order:0,published:!0},this.imageFile=null,this.imagePreview=null},generateSlug(){this.form.name&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""))},handleImageSelect(t){if(t){const e=Array.isArray(t)?t[0]:t;if(e&&e.size>5242880){this.showError("Image file size must be less than 5MB"),this.imageFile=null;return}if(e&&!e.type.startsWith("image/")){this.showError("Please select a valid image file"),this.imageFile=null;return}if(this.imageFile=e,e){const g=new FileReader;g.onload=d=>{this.imagePreview=d.target.result},g.onerror=()=>{this.showError("Failed to read image file"),this.imageFile=null,this.imagePreview=null},g.readAsDataURL(e)}else this.imagePreview=null}else this.imageFile=null,this.form.image||(this.imagePreview=null)},removeImage(){confirm("Are you sure you want to remove this image?")&&(this.imagePreview=null,this.imageFile=null,this.form.image="")},async uploadImage(){var e,g,d,a;if(!this.imageFile)return null;const t=Array.isArray(this.imageFile)?this.imageFile[0]:this.imageFile;if(!t)return null;this.uploadingImage=!0;try{const r=new FormData;r.append("image",t),r.append("folder","blog/categories"),this.form.name&&r.append("prefix",this.form.name);const h=await this.$axios.post("/api/v1/upload/image",r,{headers:{...this.getAuthHeaders(),"Content-Type":"multipart/form-data"}});if(h.data.success){const _=this.normalizeImageInput(h.data.path||h.data.url);return this.form.image=_,this.imagePreview=this.resolveImageUrl(h.data.url||_),this.imageFile=null,_}else throw new Error(h.data.message||"Failed to upload image")}catch(r){const h=((g=(e=r.response)==null?void 0:e.data)==null?void 0:g.message)||((a=(d=r.response)==null?void 0:d.data)==null?void 0:a.error)||"Failed to upload image";throw new Error(h)}finally{this.uploadingImage=!1}},async saveCategory(){const{valid:t}=await this.$refs.formRef.validate();if(!t){this.showError("Please fill in all required fields");return}try{if(this.saving=!0,this.imageFile)try{const g=await this.uploadImage();g&&(this.form.image=g)}catch(g){this.showError(g.message||"Failed to upload image");return}const e={...this.form,type:"post",image:this.normalizeImageInput(this.form.image)};if(this.editingCategory){const g=this.originalId||this.editingCategory.id||this.originalSlug||this.editingCategory.slug;await this.$axios.put(`/api/v1/blog-categories/${g}`,e,{headers:this.getAuthHeaders()}),this.showSuccess("Blog category updated successfully")}else await this.$axios.post("/api/v1/blog-categories",e,{headers:this.getAuthHeaders()}),this.showSuccess("Blog category created successfully");this.closeDialog(),await Promise.all([this.loadCategories(),this.loadAllCategories()])}catch(e){this.handleApiError(e,"Failed to save blog category")}finally{this.saving=!1}},editCategory(t){this.openDialog(t)},async deleteCategory(t){var e,g;if(confirm("Are you sure you want to delete this blog category? This action cannot be undone."))try{const d=t.id||t.slug;await this.$axios.delete(`/api/v1/blog-categories/${d}`,{headers:this.getAuthHeaders()}),this.showSuccess("Blog category deleted successfully"),await Promise.all([this.loadCategories(),this.loadAllCategories()])}catch(d){const a=((g=(e=d.response)==null?void 0:e.data)==null?void 0:g.error)||"Error deleting blog category";this.showError(a)}},closeDialog(){this.showDialog=!1,this.editingCategory=null,this.originalSlug=null,this.originalId=null,this.imageFile=null,this.imagePreview=null,this.resetForm(),this.$refs.formRef&&this.$refs.formRef.resetValidation()},onPerPageChange(){this.resetPagination(),this.loadCategories()},onSort(t){this.handleSort(t),this.loadCategories()},normalizeImageInput(t){return K(t)},resolveImageUrl(t){return J(t)}}},Z={class:"page-header"},$={class:"text-caption text-grey"},ee={key:0},te={class:"d-flex align-center"},le={class:"d-flex align-center"},ie={class:"d-flex align-center"},ae={class:"d-flex align-center"},oe={class:"d-flex"},se={class:"font-weight-medium"},re={key:0,class:"text-caption text-grey"},ne={key:0,class:"text-body-2"},de={key:1,class:"text-caption text-grey"},ge={key:0},me={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},ue={class:"text-caption text-grey"},pe={key:0},he={key:0,class:"ml-2"},ce={key:1},fe={key:0,class:"d-flex align-center gap-2"},ve={class:"text-h5 font-weight-bold"},ye={class:"d-flex flex-column flex-md-row gap-4"},_e={key:0,class:"flex-shrink-0"},be={class:"mt-2"},we={class:"flex-grow-1"},Ce={key:1,class:"text-caption text-medium-emphasis mt-2"};function Pe(t,e,g,d,a,r){const h=n("v-btn"),_=n("v-select"),f=n("v-col"),w=n("v-text-field"),I=n("v-row"),F=n("v-card-text"),C=n("v-card"),x=n("v-card-title"),b=n("v-icon"),v=n("v-skeleton-loader"),U=n("v-img"),S=n("v-avatar"),z=n("v-chip"),D=n("v-table"),B=n("v-pagination"),E=n("v-textarea"),M=n("v-label"),N=n("v-progress-circular"),R=n("v-file-input"),H=n("v-alert"),O=n("v-list-item"),L=n("v-switch"),T=n("v-form"),j=n("v-spacer"),q=n("v-card-actions"),W=n("v-dialog");return m(),c("div",null,[o("div",Z,[e[19]||(e[19]=o("h1",{class:"text-h4 page-title"},"Blog Categories Management",-1)),l(h,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=i=>r.openDialog()),class:"add-button"},{default:s(()=>e[18]||(e[18]=[u("Create Category")])),_:1,__:[18]})]),l(C,{class:"mb-4"},{default:s(()=>[l(F,null,{default:s(()=>[l(I,null,{default:s(()=>[l(f,{cols:"12",md:"4"},{default:s(()=>[l(_,{modelValue:t.perPage,"onUpdate:modelValue":[e[1]||(e[1]=i=>t.perPage=i),r.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(f,{cols:"12",md:"4"},{default:s(()=>[l(_,{modelValue:a.publishedFilter,"onUpdate:modelValue":[e[2]||(e[2]=i=>a.publishedFilter=i),r.loadCategories],items:a.publishedOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(f,{cols:"12",md:"4"},{default:s(()=>[l(w,{modelValue:t.search,"onUpdate:modelValue":[e[3]||(e[3]=i=>t.search=i),r.loadCategories],label:"Search categories","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(C,null,{default:s(()=>[l(x,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[21]||(e[21]=o("span",null,"Blog Categories",-1)),o("span",$,[e[20]||(e[20]=u(" Total Records: ")),o("strong",null,p(t.pagination.total||0),1),a.categories.length>0?(m(),c("span",ee," | Showing "+p((t.currentPage-1)*t.perPage+1)+" to "+p(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+p(t.pagination.total),1)):y("",!0)])]),_:1,__:[21]}),l(F,null,{default:s(()=>[l(D,null,{default:s(()=>[o("thead",null,[o("tr",null,[e[26]||(e[26]=o("th",null,"Image",-1)),o("th",{class:"sortable",onClick:e[4]||(e[4]=i=>r.onSort("name"))},[o("div",te,[e[22]||(e[22]=u(" Name ")),l(b,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),o("th",{class:"sortable",onClick:e[5]||(e[5]=i=>r.onSort("slug"))},[o("div",le,[e[23]||(e[23]=u(" Slug ")),l(b,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[27]||(e[27]=o("th",null,"Parent",-1)),o("th",{class:"sortable",onClick:e[6]||(e[6]=i=>r.onSort("order"))},[o("div",ie,[e[24]||(e[24]=u(" Order ")),l(b,{icon:t.getSortIcon("order"),size:"small",class:"ml-1"},null,8,["icon"])])]),o("th",{class:"sortable",onClick:e[7]||(e[7]=i=>r.onSort("published"))},[o("div",ae,[e[25]||(e[25]=u(" Status ")),l(b,{icon:t.getSortIcon("published"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[28]||(e[28]=o("th",null,"Actions",-1))])]),o("tbody",null,[t.loading?(m(),c(k,{key:0},A(5,i=>o("tr",{key:`skeleton-${i}`},[o("td",null,[l(v,{type:"avatar",width:"40",height:"40"})]),o("td",null,[l(v,{type:"text",width:"150",class:"mb-1"}),l(v,{type:"text",width:"100",height:"16"})]),o("td",null,[l(v,{type:"chip",width:"120",height:"24"})]),o("td",null,[l(v,{type:"text",width:"100"})]),o("td",null,[l(v,{type:"text",width:"50"})]),o("td",null,[l(v,{type:"chip",width:"80",height:"24"})]),o("td",null,[o("div",oe,[l(v,{type:"button",width:"32",height:"32",class:"mr-1"}),l(v,{type:"button",width:"32",height:"32"})])])])),64)):(m(),c(k,{key:1},[(m(!0),c(k,null,A(a.categories,i=>(m(),c("tr",{key:i.id},[o("td",null,[i.image?(m(),P(S,{key:0,size:"40"},{default:s(()=>[l(U,{src:r.resolveImageUrl(i.image),cover:""},null,8,["src"])]),_:2},1024)):(m(),P(S,{key:1,size:"40",color:"grey-lighten-2"},{default:s(()=>[l(b,{icon:"mdi-folder"})]),_:1}))]),o("td",null,[o("div",se,p(i.name),1),i.children&&i.children.length>0?(m(),c("div",re,p(i.children.length)+" sub-category(ies) ",1)):y("",!0)]),o("td",null,[l(z,{size:"small",variant:"outlined"},{default:s(()=>[u(p(i.slug),1)]),_:2},1024)]),o("td",null,[i.parent?(m(),c("span",ne,p(i.parent.name),1)):(m(),c("span",de,"Root"))]),o("td",null,p(i.order||0),1),o("td",null,[l(z,{color:i.published?"success":"error",size:"small"},{default:s(()=>[u(p(i.published?"Published":"Draft"),1)]),_:2},1032,["color"])]),o("td",null,[l(h,{size:"small",icon:"mdi-pencil",onClick:V=>r.editCategory(i),variant:"text",color:"primary"},null,8,["onClick"]),l(h,{size:"small",icon:"mdi-delete",onClick:V=>r.deleteCategory(i),variant:"text",color:"error"},null,8,["onClick"])])]))),128)),a.categories.length===0?(m(),c("tr",ge,e[29]||(e[29]=[o("td",{colspan:"7",class:"text-center py-4"},"No categories found",-1)]))):y("",!0)],64))])]),_:1}),o("div",me,[o("div",ue,[a.categories.length>0&&t.pagination.total>0?(m(),c("span",pe,[e[30]||(e[30]=u(" Showing ")),o("strong",null,p((t.currentPage-1)*t.perPage+1),1),e[31]||(e[31]=u(" to ")),o("strong",null,p(Math.min(t.currentPage*t.perPage,t.pagination.total)),1),e[32]||(e[32]=u(" of ")),o("strong",null,p(t.pagination.total.toLocaleString()),1),e[33]||(e[33]=u(" records ")),t.pagination.last_page>1?(m(),c("span",he," (Page "+p(t.currentPage)+" of "+p(t.pagination.last_page)+") ",1)):y("",!0)])):(m(),c("span",ce,"No records found"))]),t.pagination.last_page>1?(m(),c("div",fe,[l(B,{modelValue:t.currentPage,"onUpdate:modelValue":[e[8]||(e[8]=i=>t.currentPage=i),r.loadCategories],length:t.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):y("",!0)])]),_:1})]),_:1}),l(W,{modelValue:a.showDialog,"onUpdate:modelValue":e[17]||(e[17]=i=>a.showDialog=i),"max-width":"800",scrollable:"",persistent:""},{default:s(()=>[l(C,null,{default:s(()=>[l(x,{class:"d-flex align-center justify-space-between bg-primary text-white pa-4"},{default:s(()=>[o("span",ve,p(a.editingCategory?"Edit Blog Category":"Create New Blog Category"),1),l(h,{icon:"mdi-close",variant:"text",color:"white",onClick:r.closeDialog},null,8,["onClick"])]),_:1}),l(F,{class:"pa-6"},{default:s(()=>[l(T,{ref:"formRef"},{default:s(()=>[l(I,null,{default:s(()=>[l(f,{cols:"12"},{default:s(()=>[l(w,{modelValue:a.form.name,"onUpdate:modelValue":e[9]||(e[9]=i=>a.form.name=i),label:"Category Name *",variant:"outlined",rules:[i=>!!i||"Name is required"]},null,8,["modelValue","rules"])]),_:1}),l(f,{cols:"12",md:"6"},{default:s(()=>[l(w,{modelValue:a.form.slug,"onUpdate:modelValue":e[10]||(e[10]=i=>a.form.slug=i),label:"Slug *",variant:"outlined",hint:"URL-friendly version of name",rules:[i=>!!i||"Slug is required"]},{append:s(()=>[l(h,{icon:"mdi-refresh",size:"small",variant:"text",onClick:r.generateSlug},null,8,["onClick"])]),_:1},8,["modelValue","rules"])]),_:1}),l(f,{cols:"12",md:"6"},{default:s(()=>[l(w,{modelValue:a.form.type,"onUpdate:modelValue":e[11]||(e[11]=i=>a.form.type=i),label:"Type",variant:"outlined",disabled:"",hint:"Blog categories are always type 'post'"},null,8,["modelValue"])]),_:1}),l(f,{cols:"12"},{default:s(()=>[l(E,{modelValue:a.form.description,"onUpdate:modelValue":e[12]||(e[12]=i=>a.form.description=i),label:"Description",variant:"outlined",rows:"3",hint:"Brief description of the category"},null,8,["modelValue"])]),_:1}),l(f,{cols:"12"},{default:s(()=>[l(M,{class:"mb-2"},{default:s(()=>e[34]||(e[34]=[u("Category Image")])),_:1,__:[34]}),l(C,{variant:"outlined",class:"pa-4"},{default:s(()=>[o("div",ye,[a.imagePreview||a.form.image?(m(),c("div",_e,[l(U,{src:a.imagePreview||r.resolveImageUrl(a.form.image),"max-width":"200","max-height":"200",contain:"",class:"rounded border",style:{"min-width":"150px","min-height":"150px"}},null,8,["src"]),o("div",be,[l(h,{color:"error",size:"small",variant:"text",onClick:r.removeImage,"prepend-icon":"mdi-delete"},{default:s(()=>e[35]||(e[35]=[u(" Remove Image ")])),_:1,__:[35]},8,["onClick"])])])):y("",!0),o("div",we,[l(R,{modelValue:a.imageFile,"onUpdate:modelValue":[e[13]||(e[13]=i=>a.imageFile=i),r.handleImageSelect],accept:"image/*",label:"Select Category Image",variant:"outlined","prepend-icon":"","prepend-inner-icon":"mdi-image","show-size":"",clearable:"",hint:"Recommended size: 400x400px or larger. Max file size: 5MB","persistent-hint":""},{append:s(()=>[a.uploadingImage?(m(),P(N,{key:0,indeterminate:"",color:"primary",size:"24"})):y("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"]),a.imageFile&&a.imageFile.size>5242880?(m(),P(H,{key:0,type:"warning",variant:"tonal",density:"compact",class:"mt-2"},{default:s(()=>e[36]||(e[36]=[u(" File size is larger than 5MB. Please choose a smaller image. ")])),_:1,__:[36]})):y("",!0),!a.imagePreview&&!a.form.image&&!a.imageFile?(m(),c("div",Ce," No image selected. Upload an image to display with this category. ")):y("",!0)])])]),_:1})]),_:1}),l(f,{cols:"12",md:"6"},{default:s(()=>[l(_,{modelValue:a.form.parent_id,"onUpdate:modelValue":e[14]||(e[14]=i=>a.form.parent_id=i),items:r.parentCategoryOptions,"item-title":"name","item-value":"id",label:"Parent Category",variant:"outlined",clearable:"",hint:"Select parent category for hierarchical structure"},{item:s(({props:i,item:V})=>[l(O,X(i,{title:V.raw.name}),{prepend:s(()=>[l(b,{icon:"mdi-folder",class:"mr-2"})]),_:2},1040,["title"])]),_:1},8,["modelValue","items"])]),_:1}),l(f,{cols:"12",md:"6"},{default:s(()=>[l(w,{modelValue:a.form.order,"onUpdate:modelValue":e[15]||(e[15]=i=>a.form.order=i),modelModifiers:{number:!0},label:"Display Order",variant:"outlined",type:"number",hint:"Lower numbers appear first"},null,8,["modelValue"])]),_:1}),l(f,{cols:"12"},{default:s(()=>[l(L,{modelValue:a.form.published,"onUpdate:modelValue":e[16]||(e[16]=i=>a.form.published=i),label:"Published",color:"success"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),l(q,{class:"pa-4 bg-grey-lighten-4"},{default:s(()=>[l(j),l(h,{variant:"text",onClick:r.closeDialog},{default:s(()=>e[37]||(e[37]=[u("Cancel")])),_:1,__:[37]},8,["onClick"]),l(h,{color:"primary",variant:"flat",onClick:r.saveCategory,loading:a.saving},{default:s(()=>[u(p(a.editingCategory?"Update":"Create")+" Category ",1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Ie=Q(Y,[["render",Pe],["__scopeId","data-v-da4b5e71"]]);export{Ie as default};
