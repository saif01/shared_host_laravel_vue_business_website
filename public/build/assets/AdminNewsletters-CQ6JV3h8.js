import{_ as I,d as b,a as s,b as l,w as o,f as a,r as c,h,t as d,F as C,e as T,c as f,g as y,o as u}from"./app-DfM5fqPs.js";import{a as H}from"./adminPaginationMixin-DN7Wb3ng.js";const j={mixins:[H],data(){return{subscriptions:[],statusFilter:null,showDialog:!1,selectedSubscription:null,showDeleteDialog:!1,subscriptionToDelete:null,statusOptions:[{title:"Active",value:"active"},{title:"Unsubscribed",value:"unsubscribed"}]}},async mounted(){await this.loadSubscriptions()},methods:{onSort(t){this.handleSort(t),this.loadSubscriptions()},async loadSubscriptions(){try{this.loading=!0;const t=this.buildPaginationParams();this.search&&(t.search=this.search),this.statusFilter&&(t.status=this.statusFilter);const e=await y.get("/api/v1/newsletters",{params:t,headers:this.getAuthHeaders()});this.subscriptions=e.data.data||[],this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load subscriptions")}finally{this.loading=!1}},async viewSubscription(t){try{const e=await y.get(`/api/v1/newsletters/${t.id}`,{headers:this.getAuthHeaders()});this.selectedSubscription=e.data,this.showDialog=!0}catch(e){this.handleApiError(e,"Failed to load subscription details")}},closeDialog(){this.showDialog=!1,this.selectedSubscription=null},async unsubscribe(t){try{this.saving=!0,await y.put(`/api/v1/newsletters/${t.id}`,{status:"unsubscribed"},{headers:this.getAuthHeaders()}),this.showSuccess("Subscription updated successfully"),await this.loadSubscriptions()}catch(e){this.handleApiError(e,"Failed to unsubscribe")}finally{this.saving=!1}},async resubscribe(t){try{this.saving=!0,await y.put(`/api/v1/newsletters/${t.id}`,{status:"active"},{headers:this.getAuthHeaders()}),this.showSuccess("Subscription reactivated successfully"),await this.loadSubscriptions()}catch(e){this.handleApiError(e,"Failed to resubscribe")}finally{this.saving=!1}},async unsubscribeFromDialog(){this.selectedSubscription&&(await this.unsubscribe(this.selectedSubscription),this.closeDialog())},async resubscribeFromDialog(){this.selectedSubscription&&(await this.resubscribe(this.selectedSubscription),this.closeDialog())},confirmDelete(t){this.subscriptionToDelete=t,this.showDeleteDialog=!0},async deleteSubscription(){if(this.subscriptionToDelete)try{this.saving=!0,await y.delete(`/api/v1/newsletters/${this.subscriptionToDelete.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Subscription deleted successfully"),this.showDeleteDialog=!1,this.subscriptionToDelete=null,await this.loadSubscriptions()}catch(t){this.handleApiError(t,"Failed to delete subscription")}finally{this.saving=!1}},async exportSubscriptions(){try{const t=await y.get("/api/v1/newsletters/export/csv",{headers:this.getAuthHeaders(),responseType:"blob"}),e=window.URL.createObjectURL(new Blob([t.data])),v=document.createElement("a");v.href=e,v.setAttribute("download",`newsletter_subscriptions_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(v),v.click(),v.remove(),this.showSuccess("Subscriptions exported successfully")}catch(t){this.handleApiError(t,"Failed to export subscriptions")}},getStatusColor(t){switch(t){case"active":return"success";case"unsubscribed":return"error";default:return"grey"}}}},B={class:"d-flex justify-space-between align-center mb-6"},O={class:"text-caption text-grey"},R={key:0},L={class:"d-flex align-center"},M={class:"d-flex align-center"},q={class:"d-flex align-center"},G={class:"d-flex align-center"},J={class:"d-flex"},K=["href"],Q={key:0},W={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},X={class:"text-caption text-grey"},Y={key:0},Z={key:0,class:"ml-2"},$={key:1},ee={key:0,class:"d-flex align-center gap-2"},te={class:"d-flex align-center"},se={class:"mb-4"},le={class:"text-body-1"},ie=["href"],oe={class:"mb-4"},ne={class:"text-body-1"},ae={class:"mb-4"},re={class:"text-body-2"},de={class:"mb-4"},ue={class:"text-body-2"},ce={class:"mb-4"},pe={class:"text-body-2"};function be(t,e,v,me,n,r){const p=c("v-btn"),x=c("v-select"),m=c("v-col"),E=c("v-text-field"),V=c("v-row"),w=c("v-card-text"),S=c("v-card"),k=c("v-card-title"),_=c("v-icon"),g=c("v-skeleton-loader"),A=c("v-chip"),z=c("v-table"),N=c("v-pagination"),P=c("v-spacer"),F=c("v-card-actions"),U=c("v-dialog");return u(),b("div",null,[s("div",B,[e[12]||(e[12]=s("h1",{class:"text-h4"},"Newsletter Subscriptions",-1)),l(p,{color:"primary","prepend-icon":"mdi-download",onClick:r.exportSubscriptions},{default:o(()=>e[11]||(e[11]=[a("Export to CSV")])),_:1,__:[11]},8,["onClick"])]),l(S,{class:"mb-4"},{default:o(()=>[l(w,null,{default:o(()=>[l(V,null,{default:o(()=>[l(m,{cols:"12",md:"3"},{default:o(()=>[l(x,{modelValue:t.perPage,"onUpdate:modelValue":[e[0]||(e[0]=i=>t.perPage=i),t.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(m,{cols:"12",md:"3"},{default:o(()=>[l(x,{modelValue:n.statusFilter,"onUpdate:modelValue":[e[1]||(e[1]=i=>n.statusFilter=i),r.loadSubscriptions],items:n.statusOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(m,{cols:"12",md:"6"},{default:o(()=>[l(E,{modelValue:t.search,"onUpdate:modelValue":[e[2]||(e[2]=i=>t.search=i),r.loadSubscriptions],label:"Search by email","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(S,null,{default:o(()=>[l(k,{class:"d-flex justify-space-between align-center"},{default:o(()=>[e[14]||(e[14]=s("span",null,"Subscriptions",-1)),s("span",O,[e[13]||(e[13]=a(" Total Records: ")),s("strong",null,d(t.pagination.total||0),1),n.subscriptions.length>0?(u(),b("span",R," | Showing "+d((t.currentPage-1)*t.perPage+1)+" to "+d(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+d(t.pagination.total),1)):h("",!0)])]),_:1,__:[14]}),l(w,null,{default:o(()=>[l(z,null,{default:o(()=>[s("thead",null,[s("tr",null,[s("th",{class:"sortable",onClick:e[3]||(e[3]=i=>r.onSort("email"))},[s("div",L,[e[15]||(e[15]=a(" Email ")),l(_,{icon:t.getSortIcon("email"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[4]||(e[4]=i=>r.onSort("status"))},[s("div",M,[e[16]||(e[16]=a(" Status ")),l(_,{icon:t.getSortIcon("status"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[5]||(e[5]=i=>r.onSort("subscribed_at"))},[s("div",q,[e[17]||(e[17]=a(" Subscribed At ")),l(_,{icon:t.getSortIcon("subscribed_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[6]||(e[6]=i=>r.onSort("unsubscribed_at"))},[s("div",G,[e[18]||(e[18]=a(" Unsubscribed At ")),l(_,{icon:t.getSortIcon("unsubscribed_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[19]||(e[19]=s("th",null,"Actions",-1))])]),s("tbody",null,[t.loading?(u(),b(C,{key:0},T(5,i=>s("tr",{key:`skeleton-${i}`},[s("td",null,[l(g,{type:"text",width:"200"})]),s("td",null,[l(g,{type:"chip",width:"90",height:"24"})]),s("td",null,[l(g,{type:"text",width:"140"})]),s("td",null,[l(g,{type:"text",width:"140"})]),s("td",null,[s("div",J,[l(g,{type:"button",width:"32",height:"32",class:"mr-1"}),l(g,{type:"button",width:"32",height:"32",class:"mr-1"}),l(g,{type:"button",width:"32",height:"32"})])])])),64)):(u(),b(C,{key:1},[(u(!0),b(C,null,T(n.subscriptions,i=>(u(),b("tr",{key:i.id},[s("td",null,[s("a",{href:`mailto:${i.email}`,class:"text-primary text-decoration-none"},d(i.email),9,K)]),s("td",null,[l(A,{color:r.getStatusColor(i.status),size:"small"},{default:o(()=>[a(d(i.status),1)]),_:2},1032,["color"])]),s("td",null,d(t.formatDate(i.subscribed_at)),1),s("td",null,d(i.unsubscribed_at?t.formatDate(i.unsubscribed_at):"-"),1),s("td",null,[l(p,{size:"small",icon:"mdi-eye",onClick:D=>r.viewSubscription(i),variant:"text",class:"mr-1",title:"View Details"},null,8,["onClick"]),i.status==="active"?(u(),f(p,{key:0,size:"small",icon:"mdi-email-remove",onClick:D=>r.unsubscribe(i),variant:"text",color:"error",title:"Unsubscribe"},null,8,["onClick"])):(u(),f(p,{key:1,size:"small",icon:"mdi-email-check",onClick:D=>r.resubscribe(i),variant:"text",color:"success",title:"Resubscribe"},null,8,["onClick"])),l(p,{size:"small",icon:"mdi-delete",onClick:D=>r.confirmDelete(i),variant:"text",color:"error",class:"ml-1",title:"Delete"},null,8,["onClick"])])]))),128)),n.subscriptions.length===0?(u(),b("tr",Q,e[20]||(e[20]=[s("td",{colspan:"5",class:"text-center py-4"},"No subscriptions found",-1)]))):h("",!0)],64))])]),_:1}),s("div",W,[s("div",X,[n.subscriptions.length>0&&t.pagination.total>0?(u(),b("span",Y,[e[21]||(e[21]=a(" Showing ")),s("strong",null,d((t.currentPage-1)*t.perPage+1),1),e[22]||(e[22]=a(" to ")),s("strong",null,d(Math.min(t.currentPage*t.perPage,t.pagination.total)),1),e[23]||(e[23]=a(" of ")),s("strong",null,d(t.pagination.total.toLocaleString()),1),e[24]||(e[24]=a(" records ")),t.pagination.last_page>1?(u(),b("span",Z," (Page "+d(t.currentPage)+" of "+d(t.pagination.last_page)+") ",1)):h("",!0)])):(u(),b("span",$," No records found "))]),t.pagination.last_page>1?(u(),b("div",ee,[l(N,{modelValue:t.currentPage,"onUpdate:modelValue":[e[7]||(e[7]=i=>t.currentPage=i),r.loadSubscriptions],length:t.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):h("",!0)])]),_:1})]),_:1}),l(U,{modelValue:n.showDialog,"onUpdate:modelValue":e[8]||(e[8]=i=>n.showDialog=i),"max-width":"600",scrollable:""},{default:o(()=>[n.selectedSubscription?(u(),f(S,{key:0},{default:o(()=>[l(k,{class:"d-flex justify-space-between align-center bg-primary text-white"},{default:o(()=>[s("div",te,[l(_,{icon:"mdi-email",class:"mr-2"}),e[25]||(e[25]=s("span",null,"Subscription Details",-1))]),l(p,{icon:"mdi-close",variant:"text",onClick:r.closeDialog,color:"white"},null,8,["onClick"])]),_:1}),l(w,{class:"pa-6"},{default:o(()=>[l(V,null,{default:o(()=>[l(m,{cols:"12"},{default:o(()=>[s("div",se,[e[26]||(e[26]=s("div",{class:"text-caption text-grey mb-1"},"Email",-1)),s("div",le,[s("a",{href:`mailto:${n.selectedSubscription.email}`,class:"text-primary text-decoration-none"},d(n.selectedSubscription.email),9,ie)])])]),_:1}),l(m,{cols:"12",md:"6"},{default:o(()=>[s("div",oe,[e[27]||(e[27]=s("div",{class:"text-caption text-grey mb-1"},"Status",-1)),s("div",ne,[l(A,{color:r.getStatusColor(n.selectedSubscription.status),size:"small"},{default:o(()=>[a(d(n.selectedSubscription.status),1)]),_:1},8,["color"])])])]),_:1}),l(m,{cols:"12",md:"6"},{default:o(()=>[s("div",ae,[e[28]||(e[28]=s("div",{class:"text-caption text-grey mb-1"},"Subscribed At",-1)),s("div",re,d(t.formatDateTime(n.selectedSubscription.subscribed_at)),1)])]),_:1}),n.selectedSubscription.unsubscribed_at?(u(),f(m,{key:0,cols:"12",md:"6"},{default:o(()=>[s("div",de,[e[29]||(e[29]=s("div",{class:"text-caption text-grey mb-1"},"Unsubscribed At",-1)),s("div",ue,d(t.formatDateTime(n.selectedSubscription.unsubscribed_at)),1)])]),_:1})):h("",!0),l(m,{cols:"12",md:"6"},{default:o(()=>[s("div",ce,[e[30]||(e[30]=s("div",{class:"text-caption text-grey mb-1"},"Created At",-1)),s("div",pe,d(t.formatDateTime(n.selectedSubscription.created_at)),1)])]),_:1})]),_:1})]),_:1}),l(F,{class:"pa-4 bg-grey-lighten-5"},{default:o(()=>[l(P),n.selectedSubscription.status==="active"?(u(),f(p,{key:0,color:"error","prepend-icon":"mdi-email-remove",onClick:r.unsubscribeFromDialog},{default:o(()=>e[31]||(e[31]=[a(" Unsubscribe ")])),_:1,__:[31]},8,["onClick"])):(u(),f(p,{key:1,color:"success","prepend-icon":"mdi-email-check",onClick:r.resubscribeFromDialog},{default:o(()=>e[32]||(e[32]=[a(" Resubscribe ")])),_:1,__:[32]},8,["onClick"])),l(p,{color:"grey",variant:"text",onClick:r.closeDialog},{default:o(()=>e[33]||(e[33]=[a("Close")])),_:1,__:[33]},8,["onClick"])]),_:1})]),_:1})):h("",!0)]),_:1},8,["modelValue"]),l(U,{modelValue:n.showDeleteDialog,"onUpdate:modelValue":e[10]||(e[10]=i=>n.showDeleteDialog=i),"max-width":"400"},{default:o(()=>[l(S,null,{default:o(()=>[l(k,{class:"text-h6"},{default:o(()=>e[34]||(e[34]=[a("Confirm Delete")])),_:1,__:[34]}),l(w,null,{default:o(()=>{var i;return[e[35]||(e[35]=a(" Are you sure you want to delete the subscription for ")),s("strong",null,d((i=n.subscriptionToDelete)==null?void 0:i.email),1),e[36]||(e[36]=a("? This action cannot be undone. "))]}),_:1,__:[35,36]}),l(F,null,{default:o(()=>[l(P),l(p,{color:"grey",variant:"text",onClick:e[9]||(e[9]=i=>n.showDeleteDialog=!1)},{default:o(()=>e[37]||(e[37]=[a("Cancel")])),_:1,__:[37]}),l(p,{color:"error",onClick:r.deleteSubscription,loading:t.saving},{default:o(()=>e[38]||(e[38]=[a("Delete")])),_:1,__:[38]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const he=I(j,[["render",be],["__scopeId","data-v-717d18a0"]]);export{he as default};
