import{_ as L,c as h,g as i,a as t,w as l,r as a,b as y,o as u,d as m,f as b,h as v,F as A,e as I,t as f,i as O,n as j,j as M}from"./app-lD5pKros.js";import{a as H}from"./adminPaginationMixin-DN7Wb3ng.js";const T={mixins:[H],data(){return{users:[],roles:[],roleFilter:null,roleOptions:[],dialog:!1,editingUser:null,saving:!1,form:{name:"",email:"",role_ids:[],password:"",password_confirmation:"",avatar:""},rules:{required:s=>Array.isArray(s)?s.length>0||"At least one role is required":!!s||"This field is required",email:s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)||"Invalid email",minLength:s=>s?s.length>=8||"Password must be at least 8 characters":!0},currentUserId:null,showPassword:!1,showPasswordConfirmation:!1}},async mounted(){await this.loadRoles(),await this.loadUsers(),this.loadCurrentUser()},methods:{async loadUsers(){try{this.loading=!0;const s=this.buildPaginationParams();this.search&&(s.search=this.search),this.roleFilter&&(s.role=this.roleFilter);const e=await y.get("/api/v1/users",{params:s,headers:this.getAuthHeaders()});this.users=e.data.data,this.updatePagination(e.data)}catch(s){this.handleApiError(s,"Failed to load users")}finally{this.loading=!1}},async loadRoles(){try{const s=await y.get("/api/v1/users/roles",{headers:this.getAuthHeaders()});this.roles=s.data.roles,this.roleOptions=this.roles.map(e=>({title:e.label,value:e.value}))}catch(s){console.error("Error loading roles:",s)}},loadCurrentUser(){const s=localStorage.getItem("admin_token");y.get("/api/v1/auth/user",{headers:{Authorization:`Bearer ${s}`}}).then(e=>{this.currentUserId=e.data.id}).catch(()=>{})},openDialog(s){if(s){this.editingUser=s;const e=s.roles?s.roles.map(g=>g.id):[];this.form={name:s.name,email:s.email,role_ids:e,password:"",password_confirmation:"",avatar:s.avatar||""}}else{this.editingUser=null;const e=this.roles.length>0?this.roles[0].value:null;this.form={name:"",email:"",role_ids:e?[e]:[],password:"",password_confirmation:"",avatar:""}}this.dialog=!0},closeDialog(){this.dialog=!1,this.editingUser=null;const s=this.roles.length>0?this.roles[0].value:null;this.form={name:"",email:"",role_ids:s?[s]:[],password:"",password_confirmation:"",avatar:""},this.showPassword=!1,this.showPasswordConfirmation=!1,this.$refs.form&&this.$refs.form.resetValidation()},async saveUser(){var s,e,g,V;if(this.form.password&&this.form.password!==this.form.password_confirmation){this.showError("Passwords do not match");return}if(!this.editingUser&&!this.form.password){this.showError("Password is required for new users");return}if(this.editingUser&&this.form.password&&!this.form.password_confirmation){this.showError("Please confirm the password");return}if(this.$refs.form.validate()){this.saving=!0;try{const r=localStorage.getItem("admin_token"),n=this.editingUser?`/api/v1/users/${this.editingUser.id}`:"/api/v1/users",d={...this.form};this.form.role_ids&&(d.role_ids=Array.isArray(this.form.role_ids)?this.form.role_ids:[this.form.role_ids]),this.form.password?d.password_confirmation=this.form.password_confirmation:(delete d.password,delete d.password_confirmation),delete d.role;const c=this.editingUser?"put":"post";await y[c](n,d,{headers:{Authorization:`Bearer ${r}`}}),this.showSuccess(this.editingUser?"User updated successfully":"User created successfully"),this.closeDialog(),await this.loadUsers()}catch(r){console.error("Error saving user:",r);let n="Error saving user";if((e=(s=r.response)==null?void 0:s.data)!=null&&e.errors){const d=r.response.data.errors,c=[];Object.keys(d).forEach(_=>{c.push(d[_][0])}),n=c.join(", ")}else(V=(g=r.response)==null?void 0:g.data)!=null&&V.message&&(n=r.response.data.message);this.showError(n)}finally{this.saving=!1}}},async deleteUser(s){if(s.id===this.currentUserId){this.showError("You cannot delete your own account");return}if(confirm(`Are you sure you want to delete ${s.name}?`))try{const e=localStorage.getItem("admin_token");await y.delete(`/api/v1/users/${s.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.showSuccess("User deleted successfully"),await this.loadUsers()}catch(e){this.handleApiError(e,"Error deleting user")}},getRoleLabel(s){const e=this.roles.find(g=>g.slug===s);return e?e.label:s},getRoleColor(s){return{administrator:"error",editor:"primary","hr-user":"success",staff:"info"}[s]||"primary"},onPerPageChange(){this.resetPagination(),this.loadUsers()},onSort(s){this.handleSort(s),this.loadUsers()}}},Y={class:"d-flex justify-space-between align-center mb-6"},G={class:"d-flex align-center"},J={class:"d-flex align-center"},K={class:"d-flex align-center"},Q={class:"d-flex align-center gap-2"},W={class:"text-white"},X={key:0,class:"d-flex flex-wrap gap-1"},Z={key:1,class:"text-caption text-grey"},$={key:0},ee={key:1,class:"text-grey text-caption align-self-center"};function se(s,e,g,V,r,n){const d=a("v-btn"),c=a("v-select"),_=a("v-col"),w=a("v-text-field"),S=a("v-row"),k=a("v-card-text"),P=a("v-card"),x=a("v-card-title"),U=a("v-icon"),E=a("v-avatar"),C=a("v-chip"),q=a("v-table"),z=a("v-pagination"),R=a("v-list-item"),F=a("v-form"),N=a("v-spacer"),D=a("v-card-actions"),B=a("v-dialog");return u(),h("div",null,[i("div",Y,[e[18]||(e[18]=i("h1",{class:"text-h4"},"User Management",-1)),t(d,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=o=>n.openDialog(null))},{default:l(()=>e[17]||(e[17]=[m(" Add New User ")])),_:1,__:[17]})]),t(P,{class:"mb-4"},{default:l(()=>[t(k,null,{default:l(()=>[t(S,null,{default:l(()=>[t(_,{cols:"12",md:"4"},{default:l(()=>[t(c,{modelValue:s.perPage,"onUpdate:modelValue":[e[1]||(e[1]=o=>s.perPage=o),n.onPerPageChange],items:s.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),t(_,{cols:"12",md:"4"},{default:l(()=>[t(c,{modelValue:r.roleFilter,"onUpdate:modelValue":[e[2]||(e[2]=o=>r.roleFilter=o),n.loadUsers],items:r.roleOptions,label:"Filter by Role",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),t(_,{cols:"12",md:"4"},{default:l(()=>[t(w,{modelValue:s.search,"onUpdate:modelValue":e[3]||(e[3]=o=>s.search=o),label:"Search by name or email","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:n.loadUsers},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),t(P,null,{default:l(()=>[t(x,null,{default:l(()=>e[19]||(e[19]=[m("Users")])),_:1,__:[19]}),t(k,null,{default:l(()=>[t(q,null,{default:l(()=>[i("thead",null,[i("tr",null,[i("th",{class:"sortable",onClick:e[4]||(e[4]=o=>n.onSort("name"))},[i("div",G,[e[20]||(e[20]=m(" Name ")),t(U,{icon:s.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),i("th",{class:"sortable",onClick:e[5]||(e[5]=o=>n.onSort("email"))},[i("div",J,[e[21]||(e[21]=m(" Email ")),t(U,{icon:s.getSortIcon("email"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[23]||(e[23]=i("th",null,"Role",-1)),i("th",{class:"sortable",onClick:e[6]||(e[6]=o=>n.onSort("created_at"))},[i("div",K,[e[22]||(e[22]=m(" Created ")),t(U,{icon:s.getSortIcon("created_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[24]||(e[24]=i("th",null,"Actions",-1))])]),i("tbody",null,[(u(!0),h(A,null,I(r.users,o=>(u(),h("tr",{key:o.id},[i("td",null,[i("div",Q,[t(E,{size:"32",color:"primary"},{default:l(()=>[i("span",W,f(o.name.charAt(0).toUpperCase()),1)]),_:2},1024),m(" "+f(o.name),1)])]),i("td",null,f(o.email),1),i("td",null,[o.roles&&o.roles.length>0?(u(),h("div",X,[(u(!0),h(A,null,I(o.roles,p=>(u(),b(C,{key:p.id,color:n.getRoleColor(p.slug),size:"small"},{default:l(()=>[m(f(p.name),1)]),_:2},1032,["color"]))),128))])):(u(),h("span",Z,"No roles"))]),i("td",null,f(s.formatDate(o.created_at)),1),i("td",null,[t(d,{size:"small",icon:"mdi-pencil",onClick:p=>n.openDialog(o),variant:"text"},null,8,["onClick"]),t(d,{size:"small",icon:"mdi-delete",onClick:p=>n.deleteUser(o),variant:"text",color:"error",disabled:o.id===r.currentUserId},null,8,["onClick","disabled"])])]))),128)),r.users.length===0?(u(),h("tr",$,e[25]||(e[25]=[i("td",{colspan:"5",class:"text-center py-4"},"No users found",-1)]))):v("",!0)])]),_:1}),s.pagination.last_page>1?(u(),b(z,{key:0,modelValue:s.currentPage,"onUpdate:modelValue":[e[7]||(e[7]=o=>s.currentPage=o),n.loadUsers],length:s.pagination.last_page,class:"mt-4"},null,8,["modelValue","length","onUpdate:modelValue"])):v("",!0)]),_:1})]),_:1}),t(B,{modelValue:r.dialog,"onUpdate:modelValue":e[16]||(e[16]=o=>r.dialog=o),"max-width":"600",persistent:""},{default:l(()=>[t(P,null,{default:l(()=>[t(x,null,{default:l(()=>[m(f(r.editingUser?"Edit User":"Add New User"),1)]),_:1}),t(k,null,{default:l(()=>[t(F,{ref:"form",onSubmit:O(n.saveUser,["prevent"])},{default:l(()=>[t(w,{modelValue:r.form.name,"onUpdate:modelValue":e[8]||(e[8]=o=>r.form.name=o),label:"Full Name",rules:[r.rules.required],required:"",class:"mb-4"},null,8,["modelValue","rules"]),t(w,{modelValue:r.form.email,"onUpdate:modelValue":e[9]||(e[9]=o=>r.form.email=o),label:"Email",type:"email",rules:[r.rules.required,r.rules.email],required:"",class:"mb-4"},null,8,["modelValue","rules"]),t(c,{modelValue:r.form.role_ids,"onUpdate:modelValue":e[10]||(e[10]=o=>r.form.role_ids=o),items:r.roles,"item-title":"label","item-value":"value",label:"Roles",rules:[r.rules.required],required:"",multiple:"",chips:"",class:"mb-4"},{item:l(({props:o,item:p})=>[t(R,j(M(o)),{title:l(()=>[m(f(p.raw.label)+" ",1),p.raw.is_system?(u(),b(C,{key:0,size:"x-small",color:"warning",class:"ml-2"},{default:l(()=>e[26]||(e[26]=[m(" System ")])),_:1,__:[26]})):v("",!0)]),subtitle:l(()=>[m(f(p.raw.description),1)]),_:2},1040)]),selection:l(({item:o,index:p})=>[p<2?(u(),b(C,{key:0,size:"small",class:"mr-1"},{default:l(()=>[m(f(o.raw.label),1)]),_:2},1024)):v("",!0),p===2?(u(),h("span",ee," (+"+f(r.form.role_ids.length-2)+" others) ",1)):v("",!0)]),_:1},8,["modelValue","items","rules"]),t(w,{modelValue:r.form.password,"onUpdate:modelValue":e[12]||(e[12]=o=>r.form.password=o),label:"Password",type:r.showPassword?"text":"password",rules:r.editingUser?[]:[r.rules.required,r.rules.minLength],required:!r.editingUser,hint:"Leave blank to keep current password","persistent-hint":"",class:"mb-4"},{"append-inner":l(()=>[t(d,{icon:"",variant:"text",size:"small",onClick:e[11]||(e[11]=o=>r.showPassword=!r.showPassword)},{default:l(()=>[t(U,null,{default:l(()=>[m(f(r.showPassword?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","type","rules","required"]),!r.editingUser||r.form.password?(u(),b(w,{key:0,modelValue:r.form.password_confirmation,"onUpdate:modelValue":e[14]||(e[14]=o=>r.form.password_confirmation=o),label:"Confirm Password",type:r.showPasswordConfirmation?"text":"password",rules:r.form.password?[()=>!!r.form.password_confirmation||"Please confirm your password",()=>r.form.password_confirmation===r.form.password||"Passwords do not match"]:[],required:!!r.form.password,class:"mb-4"},{"append-inner":l(()=>[t(d,{icon:"",variant:"text",size:"small",onClick:e[13]||(e[13]=o=>r.showPasswordConfirmation=!r.showPasswordConfirmation)},{default:l(()=>[t(U,null,{default:l(()=>[m(f(r.showPasswordConfirmation?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","type","rules","required"])):v("",!0),t(w,{modelValue:r.form.avatar,"onUpdate:modelValue":e[15]||(e[15]=o=>r.form.avatar=o),label:"Avatar URL",hint:"URL to user's avatar image","persistent-hint":"",class:"mb-4"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),t(D,null,{default:l(()=>[t(N),t(d,{onClick:n.closeDialog,variant:"text"},{default:l(()=>e[27]||(e[27]=[m("Cancel")])),_:1,__:[27]},8,["onClick"]),t(d,{onClick:n.saveUser,color:"primary",loading:r.saving},{default:l(()=>[m(f(r.editingUser?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const te=L(T,[["render",se],["__scopeId","data-v-114ad1c6"]]);export{te as default};
