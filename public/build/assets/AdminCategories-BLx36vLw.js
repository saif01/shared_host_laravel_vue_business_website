import{_ as j,d as f,a as s,b as l,w as o,f as c,r as n,h as y,t as p,F as G,e as W,c as b,m as J,g as _,o as u}from"./app-iP0VSsOb.js";import{a as K}from"./adminPaginationMixin-DN7Wb3ng.js";import{r as Q,n as X}from"./uploads-CnEkgyD_.js";const Y={mixins:[K],data(){return{categories:[],showDialog:!1,editingCategory:null,saving:!1,typeFilter:"product",publishedFilter:null,typeOptions:[{title:"Product",value:"product"},{title:"Service",value:"service"},{title:"Post",value:"post"},{title:"General",value:"general"}],publishedOptions:[{title:"Published",value:!0},{title:"Draft",value:!1}],form:{name:"",slug:"",type:"product",description:"",image:"",parent_id:null,order:0,published:!0},allCategories:[],originalSlug:null,imageFile:null,imagePreview:null,uploadingImage:!1}},computed:{parentCategoryOptions(){return this.allCategories.filter(t=>this.editingCategory&&t.id===this.editingCategory.id?!1:t.type===this.form.type).map(t=>({id:t.id,name:t.name,type:t.type}))}},watch:{"form.image"(t){t&&!this.imageFile?this.imagePreview=this.resolveImageUrl(t):!t&&!this.imageFile&&(this.imagePreview=null)}},async mounted(){await Promise.all([this.loadCategories(),this.loadAllCategories()])},methods:{async loadCategories(){try{this.loading=!0;const t=this.buildPaginationParams();this.search&&(t.search=this.search),this.typeFilter&&(t.type=this.typeFilter),this.publishedFilter!==null&&(t.published=this.publishedFilter);const e=await _.get("/api/v1/categories",{params:t,headers:this.getAuthHeaders()}),m=e.data.data||[];this.categories=m.map(d=>({...d,image:this.resolveImageUrl(d.image)})),this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load categories")}finally{this.loading=!1}},async loadAllCategories(){var t;try{const e=await _.get("/api/v1/categories",{params:{per_page:1e3},headers:this.getAuthHeaders()}).catch(()=>({data:{data:[]}}));this.allCategories=((t=e.data)==null?void 0:t.data)||[]}catch(e){console.error("Error loading all categories:",e),this.allCategories=[]}},openDialog(t=null){this.editingCategory=t,t?this.loadCategoryForEdit(t):this.resetForm(),this.showDialog=!0},async loadCategoryForEdit(t){try{const e=t.slug||t.id,d=(await _.get(`/api/v1/categories/${e}`,{headers:this.getAuthHeaders()})).data,a=this.normalizeImageInput(d.image||"");this.form={name:d.name||"",slug:d.slug||"",type:d.type||"product",description:d.description||"",image:a,parent_id:d.parent_id||null,order:d.order||0,published:d.published!==!1},this.originalSlug=d.slug,this.imageFile=null,this.imagePreview=this.resolveImageUrl(d.image||a)}catch(e){this.handleApiError(e,"Failed to load category")}},resetForm(){this.form={name:"",slug:"",type:this.typeFilter||"product",description:"",image:"",parent_id:null,order:0,published:!0},this.imageFile=null,this.imagePreview=null},generateSlug(){this.form.name&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""))},handleImageSelect(t){if(t){const e=Array.isArray(t)?t[0]:t;if(e&&e.size>5242880){this.showError("Image file size must be less than 5MB"),this.imageFile=null;return}if(e&&!e.type.startsWith("image/")){this.showError("Please select a valid image file"),this.imageFile=null;return}if(this.imageFile=e,e){const m=new FileReader;m.onload=d=>{this.imagePreview=d.target.result},m.onerror=()=>{this.showError("Failed to read image file"),this.imageFile=null,this.imagePreview=null},m.readAsDataURL(e)}else this.imagePreview=null}else this.imageFile=null,this.form.image||(this.imagePreview=null)},removeImage(){confirm("Are you sure you want to remove this image?")&&(this.imagePreview=null,this.imageFile=null,this.form.image="")},async uploadImage(){var e,m,d,a;if(!this.imageFile)return null;const t=Array.isArray(this.imageFile)?this.imageFile[0]:this.imageFile;if(!t)return null;this.uploadingImage=!0;try{const r=new FormData;r.append("image",t),r.append("folder","categories"),this.form.name&&r.append("prefix",this.form.name);const g=await _.post("/api/v1/upload/image",r,{headers:{...this.getAuthHeaders(),"Content-Type":"multipart/form-data"}});if(g.data.success){const v=this.normalizeImageInput(g.data.path||g.data.url);return this.form.image=v,this.imagePreview=this.resolveImageUrl(g.data.url||v),this.imageFile=null,v}else throw new Error(g.data.message||"Failed to upload image")}catch(r){const g=((m=(e=r.response)==null?void 0:e.data)==null?void 0:m.message)||((a=(d=r.response)==null?void 0:d.data)==null?void 0:a.error)||"Failed to upload image";throw new Error(g)}finally{this.uploadingImage=!1}},async saveCategory(){const{valid:t}=await this.$refs.formRef.validate();if(!t){this.showError("Please fill in all required fields");return}try{if(this.saving=!0,this.imageFile)try{const m=await this.uploadImage();m&&(this.form.image=m)}catch(m){this.showError(m.message||"Failed to upload image");return}const e={...this.form,image:this.normalizeImageInput(this.form.image)};if(this.editingCategory){const m=this.originalSlug||this.editingCategory.slug||this.editingCategory.id;await _.put(`/api/v1/categories/${m}`,e,{headers:this.getAuthHeaders()}),this.showSuccess("Category updated successfully")}else await _.post("/api/v1/categories",e,{headers:this.getAuthHeaders()}),this.showSuccess("Category created successfully");this.closeDialog(),await Promise.all([this.loadCategories(),this.loadAllCategories()])}catch(e){this.handleApiError(e,"Failed to save category")}finally{this.saving=!1}},editCategory(t){this.openDialog(t)},async deleteCategory(t){var e,m;if(confirm("Are you sure you want to delete this category? This action cannot be undone."))try{const d=t.slug||t.id;await _.delete(`/api/v1/categories/${d}`,{headers:this.getAuthHeaders()}),this.showSuccess("Category deleted successfully"),await Promise.all([this.loadCategories(),this.loadAllCategories()])}catch(d){const a=((m=(e=d.response)==null?void 0:e.data)==null?void 0:m.error)||"Error deleting category";this.showError(a)}},closeDialog(){this.showDialog=!1,this.editingCategory=null,this.originalSlug=null,this.imageFile=null,this.imagePreview=null,this.resetForm(),this.$refs.formRef&&this.$refs.formRef.resetValidation()},onPerPageChange(){this.resetPagination(),this.loadCategories()},onSort(t){this.handleSort(t),this.loadCategories()},normalizeImageInput(t){return X(t)},resolveImageUrl(t){return Q(t)}}},Z={class:"page-header"},$={class:"text-caption text-grey"},ee={key:0},te={class:"d-flex align-center"},le={class:"d-flex align-center"},ie={class:"d-flex align-center"},ae={class:"d-flex align-center"},oe={class:"font-weight-medium"},se={key:0,class:"text-caption text-grey"},re={key:0,class:"text-body-2"},ne={key:1,class:"text-caption text-grey"},de={key:0},me={class:"d-flex justify-space-between align-center mt-4"},ue={class:"text-caption text-grey"},ge={key:0},pe={key:1},ce={class:"text-h5 font-weight-bold"},he={class:"d-flex flex-column flex-md-row gap-4"},fe={key:0,class:"flex-shrink-0"},ve={class:"mt-2"},ye={class:"flex-grow-1"},_e={key:1,class:"text-caption text-medium-emphasis mt-2"};function Ce(t,e,m,d,a,r){const g=n("v-btn"),v=n("v-select"),h=n("v-col"),w=n("v-text-field"),U=n("v-row"),P=n("v-card-text"),F=n("v-card"),I=n("v-card-title"),C=n("v-icon"),S=n("v-img"),x=n("v-avatar"),V=n("v-chip"),z=n("v-table"),A=n("v-pagination"),D=n("v-textarea"),E=n("v-label"),R=n("v-progress-circular"),M=n("v-file-input"),N=n("v-alert"),O=n("v-list-item"),T=n("v-switch"),B=n("v-form"),H=n("v-spacer"),L=n("v-card-actions"),q=n("v-dialog");return u(),f("div",null,[s("div",Z,[e[21]||(e[21]=s("h1",{class:"text-h4 page-title"},"Product Categories Management",-1)),l(g,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=i=>r.openDialog()),class:"add-button"},{default:o(()=>e[20]||(e[20]=[c("Create Category")])),_:1,__:[20]})]),l(F,{class:"mb-4"},{default:o(()=>[l(P,null,{default:o(()=>[l(U,null,{default:o(()=>[l(h,{cols:"12",md:"3"},{default:o(()=>[l(v,{modelValue:t.perPage,"onUpdate:modelValue":[e[1]||(e[1]=i=>t.perPage=i),r.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(h,{cols:"12",md:"3"},{default:o(()=>[l(v,{modelValue:a.typeFilter,"onUpdate:modelValue":[e[2]||(e[2]=i=>a.typeFilter=i),r.loadCategories],items:a.typeOptions,label:"Filter by Type","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(h,{cols:"12",md:"3"},{default:o(()=>[l(v,{modelValue:a.publishedFilter,"onUpdate:modelValue":[e[3]||(e[3]=i=>a.publishedFilter=i),r.loadCategories],items:a.publishedOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(h,{cols:"12",md:"3"},{default:o(()=>[l(w,{modelValue:t.search,"onUpdate:modelValue":[e[4]||(e[4]=i=>t.search=i),r.loadCategories],label:"Search categories","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(F,null,{default:o(()=>[l(I,{class:"d-flex justify-space-between align-center"},{default:o(()=>[e[23]||(e[23]=s("span",null,"Categories",-1)),s("span",$,[e[22]||(e[22]=c(" Total Records: ")),s("strong",null,p(t.pagination.total||0),1),a.categories.length>0?(u(),f("span",ee," | Showing "+p((t.currentPage-1)*t.perPage+1)+" to "+p(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+p(t.pagination.total),1)):y("",!0)])]),_:1,__:[23]}),l(P,null,{default:o(()=>[l(z,null,{default:o(()=>[s("thead",null,[s("tr",null,[e[28]||(e[28]=s("th",null,"Image",-1)),s("th",{class:"sortable",onClick:e[5]||(e[5]=i=>r.onSort("name"))},[s("div",te,[e[24]||(e[24]=c(" Name ")),l(C,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[6]||(e[6]=i=>r.onSort("slug"))},[s("div",le,[e[25]||(e[25]=c(" Slug ")),l(C,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[29]||(e[29]=s("th",null,"Type",-1)),e[30]||(e[30]=s("th",null,"Parent",-1)),s("th",{class:"sortable",onClick:e[7]||(e[7]=i=>r.onSort("order"))},[s("div",ie,[e[26]||(e[26]=c(" Order ")),l(C,{icon:t.getSortIcon("order"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[8]||(e[8]=i=>r.onSort("published"))},[s("div",ae,[e[27]||(e[27]=c(" Status ")),l(C,{icon:t.getSortIcon("published"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[31]||(e[31]=s("th",null,"Actions",-1))])]),s("tbody",null,[(u(!0),f(G,null,W(a.categories,i=>(u(),f("tr",{key:i.id},[s("td",null,[i.image?(u(),b(x,{key:0,size:"40"},{default:o(()=>[l(S,{src:r.resolveImageUrl(i.image),cover:""},null,8,["src"])]),_:2},1024)):(u(),b(x,{key:1,size:"40",color:"grey-lighten-2"},{default:o(()=>[l(C,{icon:"mdi-folder"})]),_:1}))]),s("td",null,[s("div",oe,p(i.name),1),i.children&&i.children.length>0?(u(),f("div",se,p(i.children.length)+" sub-category(ies) ",1)):y("",!0)]),s("td",null,[l(V,{size:"small",variant:"outlined"},{default:o(()=>[c(p(i.slug),1)]),_:2},1024)]),s("td",null,[l(V,{size:"small",color:"primary",variant:"tonal"},{default:o(()=>[c(p(i.type),1)]),_:2},1024)]),s("td",null,[i.parent?(u(),f("span",re,p(i.parent.name),1)):(u(),f("span",ne,"Root"))]),s("td",null,p(i.order||0),1),s("td",null,[l(V,{color:i.published?"success":"error",size:"small"},{default:o(()=>[c(p(i.published?"Published":"Draft"),1)]),_:2},1032,["color"])]),s("td",null,[l(g,{size:"small",icon:"mdi-pencil",onClick:k=>r.editCategory(i),variant:"text",color:"primary"},null,8,["onClick"]),l(g,{size:"small",icon:"mdi-delete",onClick:k=>r.deleteCategory(i),variant:"text",color:"error"},null,8,["onClick"])])]))),128)),a.categories.length===0?(u(),f("tr",de,e[32]||(e[32]=[s("td",{colspan:"8",class:"text-center py-4"},"No categories found",-1)]))):y("",!0)])]),_:1}),s("div",me,[s("div",ue,[a.categories.length>0?(u(),f("span",ge," Showing "+p((t.currentPage-1)*t.perPage+1)+" to "+p(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+p(t.pagination.total)+" records ",1)):(u(),f("span",pe,"No records found"))]),t.pagination.last_page>1?(u(),b(A,{key:0,modelValue:t.currentPage,"onUpdate:modelValue":[e[9]||(e[9]=i=>t.currentPage=i),r.loadCategories],length:t.pagination.last_page},null,8,["modelValue","length","onUpdate:modelValue"])):y("",!0)])]),_:1})]),_:1}),l(q,{modelValue:a.showDialog,"onUpdate:modelValue":e[19]||(e[19]=i=>a.showDialog=i),"max-width":"800",scrollable:"",persistent:""},{default:o(()=>[l(F,null,{default:o(()=>[l(I,{class:"d-flex align-center justify-space-between bg-primary text-white pa-4"},{default:o(()=>[s("span",ce,p(a.editingCategory?"Edit Category":"Create New Category"),1),l(g,{icon:"mdi-close",variant:"text",color:"white",onClick:r.closeDialog},null,8,["onClick"])]),_:1}),l(P,{class:"pa-6"},{default:o(()=>[l(B,{ref:"formRef"},{default:o(()=>[l(U,null,{default:o(()=>[l(h,{cols:"12"},{default:o(()=>[l(w,{modelValue:a.form.name,"onUpdate:modelValue":e[10]||(e[10]=i=>a.form.name=i),label:"Category Name *",variant:"outlined",rules:[i=>!!i||"Name is required"]},null,8,["modelValue","rules"])]),_:1}),l(h,{cols:"12",md:"6"},{default:o(()=>[l(w,{modelValue:a.form.slug,"onUpdate:modelValue":e[11]||(e[11]=i=>a.form.slug=i),label:"Slug *",variant:"outlined",hint:"URL-friendly version of name",rules:[i=>!!i||"Slug is required"]},{append:o(()=>[l(g,{icon:"mdi-refresh",size:"small",variant:"text",onClick:r.generateSlug},null,8,["onClick"])]),_:1},8,["modelValue","rules"])]),_:1}),l(h,{cols:"12",md:"6"},{default:o(()=>[l(v,{modelValue:a.form.type,"onUpdate:modelValue":e[12]||(e[12]=i=>a.form.type=i),items:a.typeOptions,label:"Type *",variant:"outlined",rules:[i=>!!i||"Type is required"]},null,8,["modelValue","items","rules"])]),_:1}),l(h,{cols:"12"},{default:o(()=>[l(D,{modelValue:a.form.description,"onUpdate:modelValue":e[13]||(e[13]=i=>a.form.description=i),label:"Description",variant:"outlined",rows:"3",hint:"Brief description of the category"},null,8,["modelValue"])]),_:1}),l(h,{cols:"12"},{default:o(()=>[l(E,{class:"mb-2"},{default:o(()=>e[33]||(e[33]=[c("Category Image")])),_:1,__:[33]}),l(F,{variant:"outlined",class:"pa-4"},{default:o(()=>[s("div",he,[a.imagePreview||a.form.image?(u(),f("div",fe,[l(S,{src:a.imagePreview||r.resolveImageUrl(a.form.image),"max-width":"200","max-height":"200",contain:"",class:"rounded border",style:{"min-width":"150px","min-height":"150px"}},null,8,["src"]),s("div",ve,[l(g,{color:"error",size:"small",variant:"text",onClick:r.removeImage,"prepend-icon":"mdi-delete"},{default:o(()=>e[34]||(e[34]=[c(" Remove Image ")])),_:1,__:[34]},8,["onClick"])])])):y("",!0),s("div",ye,[l(M,{modelValue:a.imageFile,"onUpdate:modelValue":[e[14]||(e[14]=i=>a.imageFile=i),r.handleImageSelect],accept:"image/*",label:"Select Category Image",variant:"outlined","prepend-icon":"","prepend-inner-icon":"mdi-image","show-size":"",clearable:"",hint:"Recommended size: 400x400px or larger. Max file size: 5MB","persistent-hint":""},{append:o(()=>[a.uploadingImage?(u(),b(R,{key:0,indeterminate:"",color:"primary",size:"24"})):y("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"]),a.imageFile&&a.imageFile.size>5242880?(u(),b(N,{key:0,type:"warning",variant:"tonal",density:"compact",class:"mt-2"},{default:o(()=>e[35]||(e[35]=[c(" File size is larger than 5MB. Please choose a smaller image. ")])),_:1,__:[35]})):y("",!0),!a.imagePreview&&!a.form.image&&!a.imageFile?(u(),f("div",_e," No image selected. Upload an image to display with this category. ")):y("",!0),l(w,{modelValue:a.form.image,"onUpdate:modelValue":e[15]||(e[15]=i=>a.form.image=i),label:"Or enter image URL directly",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-link",hint:"Enter a direct image URL",class:"mt-2",clearable:""},null,8,["modelValue"])])])]),_:1})]),_:1}),l(h,{cols:"12",md:"6"},{default:o(()=>[l(v,{modelValue:a.form.parent_id,"onUpdate:modelValue":e[16]||(e[16]=i=>a.form.parent_id=i),items:r.parentCategoryOptions,"item-title":"name","item-value":"id",label:"Parent Category",variant:"outlined",clearable:"",hint:"Select parent category for hierarchical structure"},{item:o(({props:i,item:k})=>[l(O,J(i,{title:k.raw.name}),{prepend:o(()=>[l(C,{icon:"mdi-folder",class:"mr-2"})]),_:2},1040,["title"])]),_:1},8,["modelValue","items"])]),_:1}),l(h,{cols:"12",md:"6"},{default:o(()=>[l(w,{modelValue:a.form.order,"onUpdate:modelValue":e[17]||(e[17]=i=>a.form.order=i),modelModifiers:{number:!0},label:"Display Order",variant:"outlined",type:"number",hint:"Lower numbers appear first"},null,8,["modelValue"])]),_:1}),l(h,{cols:"12"},{default:o(()=>[l(T,{modelValue:a.form.published,"onUpdate:modelValue":e[18]||(e[18]=i=>a.form.published=i),label:"Published",color:"success"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),l(L,{class:"pa-4 bg-grey-lighten-4"},{default:o(()=>[l(H),l(g,{variant:"text",onClick:r.closeDialog},{default:o(()=>e[36]||(e[36]=[c("Cancel")])),_:1,__:[36]},8,["onClick"]),l(g,{color:"primary",variant:"flat",onClick:r.saveCategory,loading:a.saving},{default:o(()=>[c(p(a.editingCategory?"Update":"Create")+" Category ",1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Pe=j(Y,[["render",Ce],["__scopeId","data-v-95d5bfd2"]]);export{Pe as default};
