import{_ as F,d as g,a as t,b as s,w as o,r as u,f as r,t as i,h as y,F as I,e as E,c as L,g as x,o as d}from"./app-DsVQXQQK.js";import{a as M}from"./adminPaginationMixin-DN7Wb3ng.js";import{h as N}from"./moment-C5S46NFB.js";const T={mixins:[M],data(){return{logs:[],statistics:{total:0,successful:0,failed:0,unique_users:0,unique_ips:0},statusFilter:null,statusOptions:[{title:"Success",value:"success"},{title:"Failed",value:"failed"}],viewDialog:!1,selectedLog:null}},async mounted(){await this.loadStatistics(),await this.loadLogs()},methods:{async loadStatistics(){try{const l=await x.get("/api/v1/login-logs/statistics",{headers:this.getAuthHeaders()});this.statistics=l.data}catch(l){console.error("Error loading statistics:",l)}},async loadLogs(){try{this.loading=!0;const l=this.buildPaginationParams();this.search&&(l.search=this.search),this.statusFilter&&(l.status=this.statusFilter);const e=await x.get("/api/v1/login-logs",{params:l,headers:this.getAuthHeaders()});this.logs=e.data.data||[],this.updatePagination(e.data)}catch(l){this.handleApiError(l,"Failed to load login logs")}finally{this.loading=!1}},viewLog(l){this.selectedLog=l,this.viewDialog=!0},async deleteLog(l){if(confirm("Are you sure you want to delete this login log?"))try{await x.delete(`/api/v1/login-logs/${l.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Login log deleted successfully"),await this.loadStatistics(),await this.loadLogs()}catch(e){this.handleApiError(e,"Error deleting login log")}},formatDate(l){return l?N(l).format("YYYY-MM-DD HH:mm:ss"):"-"},truncateText(l,e){return l?l.length>e?l.substring(0,e)+"...":l:"-"},onPerPageChange(){this.resetPagination(),this.loadLogs()},onSort(l){this.handleSort(l),this.loadLogs()}}},H={class:"d-flex align-center"},q={class:"text-h6"},B={class:"d-flex align-center"},R={class:"text-h6"},Y={class:"d-flex align-center"},O={class:"text-h6"},j={class:"d-flex align-center"},G={class:"text-h6"},J={class:"d-flex align-center"},K={class:"text-h6"},Q={class:"text-caption text-grey"},W={key:0},X={class:"d-flex align-center"},Z={class:"d-flex align-center"},$={class:"d-flex align-center"},ee={class:"d-flex align-center"},te={key:1,class:"text-grey"},se=["title"],le={key:0,class:"text-caption text-grey"},oe={key:1},ne={key:0},ae={class:"d-flex justify-space-between align-center mt-4"},ie={class:"text-caption text-grey"},re={key:0},de={key:1},ue={class:"mb-3"},ge={class:"mb-3"},ce={key:1,class:"text-grey ml-2"},me={class:"mb-3"},_e={class:"mb-3"},pe={class:"mb-3"},fe={key:0,class:"text-grey ml-2"},ve={key:1,class:"text-grey ml-2"},ye={class:"mb-3"},Le={key:0,class:"ml-2"},he={key:1,class:"text-grey ml-2"},be={class:"mb-2"};function xe(l,e,ke,we,a,c){const _=u("v-icon"),p=u("v-card-text"),f=u("v-card"),m=u("v-col"),h=u("v-row"),k=u("v-select"),P=u("v-text-field"),w=u("v-card-title"),v=u("v-chip"),b=u("v-btn"),S=u("v-table"),V=u("v-pagination"),z=u("v-textarea"),C=u("v-spacer"),U=u("v-card-actions"),A=u("v-dialog");return d(),g("div",null,[e[41]||(e[41]=t("div",{class:"page-header"},[t("h1",{class:"text-h4 page-title"},"Login Log Management")],-1)),s(h,{class:"mb-4"},{default:o(()=>[s(m,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(p,null,{default:o(()=>[t("div",H,[s(_,{color:"primary",size:"40",class:"mr-3"},{default:o(()=>e[10]||(e[10]=[r("mdi-login")])),_:1,__:[10]}),t("div",null,[t("div",q,i(a.statistics.total||0),1),e[11]||(e[11]=t("div",{class:"text-caption text-grey"},"Total Logins",-1))])])]),_:1})]),_:1})]),_:1}),s(m,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(p,null,{default:o(()=>[t("div",B,[s(_,{color:"success",size:"40",class:"mr-3"},{default:o(()=>e[12]||(e[12]=[r("mdi-check-circle")])),_:1,__:[12]}),t("div",null,[t("div",R,i(a.statistics.successful||0),1),e[13]||(e[13]=t("div",{class:"text-caption text-grey"},"Successful",-1))])])]),_:1})]),_:1})]),_:1}),s(m,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(p,null,{default:o(()=>[t("div",Y,[s(_,{color:"error",size:"40",class:"mr-3"},{default:o(()=>e[14]||(e[14]=[r("mdi-close-circle")])),_:1,__:[14]}),t("div",null,[t("div",O,i(a.statistics.failed||0),1),e[15]||(e[15]=t("div",{class:"text-caption text-grey"},"Failed",-1))])])]),_:1})]),_:1})]),_:1}),s(m,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(p,null,{default:o(()=>[t("div",j,[s(_,{color:"info",size:"40",class:"mr-3"},{default:o(()=>e[16]||(e[16]=[r("mdi-account-group")])),_:1,__:[16]}),t("div",null,[t("div",G,i(a.statistics.unique_users||0),1),e[17]||(e[17]=t("div",{class:"text-caption text-grey"},"Unique Users",-1))])])]),_:1})]),_:1})]),_:1}),s(m,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(p,null,{default:o(()=>[t("div",J,[s(_,{color:"purple",size:"40",class:"mr-3"},{default:o(()=>e[18]||(e[18]=[r("mdi-database")])),_:1,__:[18]}),t("div",null,[t("div",K,i(l.pagination.total||0),1),e[19]||(e[19]=t("div",{class:"text-caption text-grey"},"Total Records",-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),s(f,{class:"mb-4"},{default:o(()=>[s(p,null,{default:o(()=>[s(h,null,{default:o(()=>[s(m,{cols:"12",md:"3"},{default:o(()=>[s(k,{modelValue:l.perPage,"onUpdate:modelValue":[e[0]||(e[0]=n=>l.perPage=n),c.onPerPageChange],items:l.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(m,{cols:"12",md:"3"},{default:o(()=>[s(k,{modelValue:a.statusFilter,"onUpdate:modelValue":[e[1]||(e[1]=n=>a.statusFilter=n),c.loadLogs],items:a.statusOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(m,{cols:"12",md:"6"},{default:o(()=>[s(P,{modelValue:l.search,"onUpdate:modelValue":[e[2]||(e[2]=n=>l.search=n),c.loadLogs],label:"Search (email, IP, user agent)","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(f,null,{default:o(()=>[s(w,{class:"d-flex justify-space-between align-center"},{default:o(()=>[e[21]||(e[21]=t("span",null,"Login Logs",-1)),t("span",Q,[e[20]||(e[20]=r(" Total Records: ")),t("strong",null,i(l.pagination.total||0),1),a.logs.length>0?(d(),g("span",W," | Showing "+i((l.currentPage-1)*l.perPage+1)+" to "+i(Math.min(l.currentPage*l.perPage,l.pagination.total))+" of "+i(l.pagination.total),1)):y("",!0)])]),_:1,__:[21]}),s(p,null,{default:o(()=>[s(S,null,{default:o(()=>[t("thead",null,[t("tr",null,[t("th",{class:"sortable",onClick:e[3]||(e[3]=n=>c.onSort("email"))},[t("div",X,[e[22]||(e[22]=r(" Email ")),s(_,{icon:l.getSortIcon("email"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[26]||(e[26]=t("th",null,"User",-1)),t("th",{class:"sortable",onClick:e[4]||(e[4]=n=>c.onSort("ip_address"))},[t("div",Z,[e[23]||(e[23]=r(" IP Address ")),s(_,{icon:l.getSortIcon("ip_address"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[27]||(e[27]=t("th",null,"User Agent",-1)),t("th",{class:"sortable",onClick:e[5]||(e[5]=n=>c.onSort("status"))},[t("div",$,[e[24]||(e[24]=r(" Status ")),s(_,{icon:l.getSortIcon("status"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[28]||(e[28]=t("th",null,"Failure Reason",-1)),t("th",{class:"sortable",onClick:e[6]||(e[6]=n=>c.onSort("created_at"))},[t("div",ee,[e[25]||(e[25]=r(" Date ")),s(_,{icon:l.getSortIcon("created_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[29]||(e[29]=t("th",null,"Actions",-1))])]),t("tbody",null,[(d(!0),g(I,null,E(a.logs,n=>(d(),g("tr",{key:n.id},[t("td",null,i(n.email),1),t("td",null,[n.user?(d(),L(v,{key:0,size:"small",color:"primary",variant:"text"},{default:o(()=>[r(i(n.user.name),1)]),_:2},1024)):(d(),g("span",te,"-"))]),t("td",null,[s(v,{size:"small",variant:"outlined"},{default:o(()=>[r(i(n.ip_address||"-"),1)]),_:2},1024)]),t("td",null,[t("span",{class:"text-caption",title:n.user_agent},i(c.truncateText(n.user_agent,50)),9,se)]),t("td",null,[s(v,{color:n.status==="success"?"success":"error",size:"small"},{default:o(()=>[r(i(n.status),1)]),_:2},1032,["color"])]),t("td",null,[n.failure_reason?(d(),g("span",le,i(n.failure_reason),1)):(d(),g("span",oe,"-"))]),t("td",null,i(c.formatDate(n.created_at)),1),t("td",null,[s(b,{size:"small",icon:"mdi-eye",onClick:D=>c.viewLog(n),variant:"text"},null,8,["onClick"]),s(b,{size:"small",icon:"mdi-delete",onClick:D=>c.deleteLog(n),variant:"text",color:"error"},null,8,["onClick"])])]))),128)),a.logs.length===0?(d(),g("tr",ne,e[30]||(e[30]=[t("td",{colspan:"8",class:"text-center py-4"},"No login logs found",-1)]))):y("",!0)])]),_:1}),t("div",ae,[t("div",ie,[a.logs.length>0?(d(),g("span",re," Showing "+i((l.currentPage-1)*l.perPage+1)+" to "+i(Math.min(l.currentPage*l.perPage,l.pagination.total))+" of "+i(l.pagination.total)+" records ",1)):(d(),g("span",de," No records found "))]),l.pagination.last_page>1?(d(),L(V,{key:0,modelValue:l.currentPage,"onUpdate:modelValue":[e[7]||(e[7]=n=>l.currentPage=n),c.loadLogs],length:l.pagination.last_page},null,8,["modelValue","length","onUpdate:modelValue"])):y("",!0)])]),_:1})]),_:1}),s(A,{modelValue:a.viewDialog,"onUpdate:modelValue":e[9]||(e[9]=n=>a.viewDialog=n),"max-width":"700"},{default:o(()=>[a.selectedLog?(d(),L(f,{key:0},{default:o(()=>[s(w,null,{default:o(()=>e[31]||(e[31]=[r("Login Log Details")])),_:1,__:[31]}),s(p,null,{default:o(()=>[s(h,null,{default:o(()=>[s(m,{cols:"12",md:"6"},{default:o(()=>[t("div",ue,[e[32]||(e[32]=t("strong",null,"Email:",-1)),r(" "+i(a.selectedLog.email),1)]),t("div",ge,[e[33]||(e[33]=t("strong",null,"User:",-1)),a.selectedLog.user?(d(),L(v,{key:0,size:"small",color:"primary",variant:"text",class:"ml-2"},{default:o(()=>[r(i(a.selectedLog.user.name)+" ("+i(a.selectedLog.user.email)+") ",1)]),_:1})):(d(),g("span",ce,"-"))]),t("div",me,[e[34]||(e[34]=t("strong",null,"Status:",-1)),s(v,{color:a.selectedLog.status==="success"?"success":"error",size:"small",class:"ml-2"},{default:o(()=>[r(i(a.selectedLog.status),1)]),_:1},8,["color"])])]),_:1}),s(m,{cols:"12",md:"6"},{default:o(()=>[t("div",_e,[e[35]||(e[35]=t("strong",null,"IP Address:",-1)),r(" "+i(a.selectedLog.ip_address||"-"),1)]),t("div",pe,[e[36]||(e[36]=t("strong",null,"Failure Reason:",-1)),a.selectedLog.failure_reason?(d(),g("span",fe,i(a.selectedLog.failure_reason),1)):(d(),g("span",ve,"-"))]),t("div",ye,[e[37]||(e[37]=t("strong",null,"Logged In At:",-1)),a.selectedLog.logged_in_at?(d(),g("span",Le,i(c.formatDate(a.selectedLog.logged_in_at)),1)):(d(),g("span",he,"-"))])]),_:1}),s(m,{cols:"12"},{default:o(()=>[e[38]||(e[38]=t("div",{class:"mb-2"},[t("strong",null,"User Agent:")],-1)),s(z,{value:a.selectedLog.user_agent||"-",readonly:"",variant:"outlined",density:"compact",rows:"3"},null,8,["value"])]),_:1,__:[38]}),s(m,{cols:"12"},{default:o(()=>[t("div",be,[e[39]||(e[39]=t("strong",null,"Created At:",-1)),r(" "+i(c.formatDate(a.selectedLog.created_at)),1)])]),_:1})]),_:1})]),_:1}),s(U,null,{default:o(()=>[s(C),s(b,{onClick:e[8]||(e[8]=n=>a.viewDialog=!1),variant:"text"},{default:o(()=>e[40]||(e[40]=[r("Close")])),_:1,__:[40]})]),_:1})]),_:1})):y("",!0)]),_:1},8,["modelValue"])])}const ze=F(T,[["render",xe],["__scopeId","data-v-03c26ac0"]]);export{ze as default};
