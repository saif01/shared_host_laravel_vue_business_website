import{_ as E,d as p,a as t,b as s,w as a,f as r,r as m,h as y,t as n,F as C,e as F,c as v,g as k,o as d,n as j}from"./app-D_WvYKr6.js";import{a as I}from"./adminPaginationMixin-DN7Wb3ng.js";const O={mixins:[I],inject:["refreshUnreadCount"],data(){return{leads:[],statusFilter:null,typeFilter:null,readFilter:null,showDialog:!1,selectedLead:null,statusOptions:[{title:"New",value:"new"},{title:"Contacted",value:"contacted"},{title:"Qualified",value:"qualified"},{title:"Converted",value:"converted"},{title:"Lost",value:"lost"}],typeOptions:[{title:"Contact",value:"contact"},{title:"Quote",value:"quote"},{title:"Support",value:"support"}],readOptions:[{title:"Unread",value:"unread"},{title:"Read",value:"read"}]}},async mounted(){await this.loadLeads()},methods:{async loadLeads(){try{this.loading=!0;const l=this.buildPaginationParams();this.search&&(l.search=this.search),this.statusFilter&&(l.status=this.statusFilter),this.typeFilter&&(l.type=this.typeFilter),this.readFilter==="unread"?l.is_read=!1:this.readFilter==="read"&&(l.is_read=!0);const e=await k.get("/api/v1/leads",{params:l,headers:this.getAuthHeaders()});this.leads=e.data.data||[],this.updatePagination(e.data)}catch(l){this.handleApiError(l,"Failed to load leads")}finally{this.loading=!1}},async viewLead(l){try{const e=await k.get(`/api/v1/leads/${l.id}`,{headers:this.getAuthHeaders()});this.selectedLead=e.data,this.showDialog=!0,await this.loadLeads(),this.refreshUnreadCount&&this.refreshUnreadCount()}catch(e){this.handleApiError(e,"Failed to load lead details")}},closeDialog(){this.showDialog=!1,this.selectedLead=null},async markAsReadFromDialog(){if(this.selectedLead)try{await k.post(`/api/v1/leads/${this.selectedLead.id}/mark-as-read`,{},{headers:this.getAuthHeaders()}),this.selectedLead.is_read=!0,this.selectedLead.read_at=new Date().toISOString(),this.showSuccess("Lead marked as read"),await this.loadLeads(),this.refreshUnreadCount&&this.refreshUnreadCount()}catch(l){this.handleApiError(l,"Failed to mark lead as read")}},async markAsRead(l){try{await k.post(`/api/v1/leads/${l.id}/mark-as-read`,{},{headers:this.getAuthHeaders()}),this.showSuccess("Lead marked as read"),await this.loadLeads(),this.refreshUnreadCount&&this.refreshUnreadCount()}catch(e){this.handleApiError(e,"Failed to mark lead as read")}},async exportLeads(){try{const l=await k.get("/api/v1/leads/export/csv",{headers:this.getAuthHeaders(),responseType:"blob"}),e=window.URL.createObjectURL(new Blob([l.data])),_=document.createElement("a");_.href=e,_.setAttribute("download","leads.csv"),document.body.appendChild(_),_.click(),document.body.removeChild(_),this.showSuccess("Leads exported successfully")}catch(l){this.handleApiError(l,"Error exporting leads")}},getStatusColor(l){return{new:"info",contacted:"warning",qualified:"primary",converted:"success",lost:"error"}[l]||"grey"},onPerPageChange(){this.resetPagination(),this.loadLeads()},onSort(l){this.handleSort(l),this.loadLeads()}}},M={class:"d-flex justify-space-between align-center mb-6"},T={class:"text-caption text-grey"},B={key:0},H={class:"d-flex align-center"},q={class:"d-flex align-center"},Q={class:"d-flex align-center"},G={class:"d-flex align-center"},J={class:"d-flex align-center"},K={class:"d-flex align-center"},W={class:"d-flex align-center"},X={class:"d-flex"},Y={class:"d-flex align-center"},Z={key:1,class:"mr-2",style:{width:"16px"}},$={key:0},ee={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},te={class:"text-caption text-grey"},se={key:0},le={key:0,class:"ml-2"},ae={key:1},oe={key:0,class:"d-flex align-center gap-2"},ie={class:"d-flex align-center"},ne={class:"mb-4"},de={class:"text-body-1 font-weight-medium"},re={class:"mb-4"},ue={class:"text-body-1"},ce=["href"],me={class:"mb-4"},pe={class:"text-body-1"},ge=["href"],ve={key:1,class:"text-grey"},ye={class:"mb-4"},fe={class:"text-body-1"},he={class:"mb-4"},_e={class:"text-body-1"},be={class:"mb-4"},ke={class:"text-body-1"},we={class:"mb-4"},xe={class:"text-body-1 font-weight-medium"},Le={class:"mb-4"},Ce={class:"text-body-1 pa-4 bg-grey-lighten-4 rounded",style:{"white-space":"pre-wrap","min-height":"100px"}},Se={class:"mb-4"},Ve={class:"text-body-2"},Fe={class:"mb-4"},Pe={class:"text-body-2"},Ue={class:"mb-4"},ze={class:"text-body-1"},Ae={class:"mb-4"},De={class:"text-body-1 pa-4 bg-grey-lighten-4 rounded",style:{"white-space":"pre-wrap"}};function Re(l,e,_,Ne,o,u){const b=m("v-btn"),w=m("v-select"),c=m("v-col"),P=m("v-text-field"),S=m("v-row"),x=m("v-card-text"),L=m("v-card"),V=m("v-card-title"),g=m("v-icon"),f=m("v-skeleton-loader"),h=m("v-chip"),U=m("v-table"),z=m("v-pagination"),A=m("v-spacer"),D=m("v-card-actions"),R=m("v-dialog");return d(),p("div",null,[t("div",M,[e[14]||(e[14]=t("h1",{class:"text-h4"},"Leads Management",-1)),s(b,{color:"primary","prepend-icon":"mdi-download",onClick:u.exportLeads},{default:a(()=>e[13]||(e[13]=[r("Export to CSV")])),_:1,__:[13]},8,["onClick"])]),s(L,{class:"mb-4"},{default:a(()=>[s(x,null,{default:a(()=>[s(S,null,{default:a(()=>[s(c,{cols:"12",md:"2"},{default:a(()=>[s(w,{modelValue:l.perPage,"onUpdate:modelValue":[e[0]||(e[0]=i=>l.perPage=i),u.onPerPageChange],items:l.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(c,{cols:"12",md:"2"},{default:a(()=>[s(w,{modelValue:o.statusFilter,"onUpdate:modelValue":[e[1]||(e[1]=i=>o.statusFilter=i),u.loadLeads],items:o.statusOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(c,{cols:"12",md:"2"},{default:a(()=>[s(w,{modelValue:o.typeFilter,"onUpdate:modelValue":[e[2]||(e[2]=i=>o.typeFilter=i),u.loadLeads],items:o.typeOptions,label:"Filter by Type","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(c,{cols:"12",md:"2"},{default:a(()=>[s(w,{modelValue:o.readFilter,"onUpdate:modelValue":[e[3]||(e[3]=i=>o.readFilter=i),u.loadLeads],items:o.readOptions,label:"Filter by Read Status","prepend-inner-icon":"mdi-email",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(c,{cols:"12",md:"4"},{default:a(()=>[s(P,{modelValue:l.search,"onUpdate:modelValue":[e[4]||(e[4]=i=>l.search=i),u.loadLeads],label:"Search leads","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(L,null,{default:a(()=>[s(V,{class:"d-flex justify-space-between align-center"},{default:a(()=>[e[16]||(e[16]=t("span",null,"Leads",-1)),t("span",T,[e[15]||(e[15]=r(" Total Records: ")),t("strong",null,n(l.pagination.total||0),1),o.leads.length>0?(d(),p("span",B," | Showing "+n((l.currentPage-1)*l.perPage+1)+" to "+n(Math.min(l.currentPage*l.perPage,l.pagination.total))+" of "+n(l.pagination.total),1)):y("",!0)])]),_:1,__:[16]}),s(x,null,{default:a(()=>[s(U,null,{default:a(()=>[t("thead",null,[t("tr",null,[t("th",{class:"sortable",onClick:e[5]||(e[5]=i=>u.onSort("name"))},[t("div",H,[e[17]||(e[17]=r(" Name ")),s(g,{icon:l.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),t("th",{class:"sortable",onClick:e[6]||(e[6]=i=>u.onSort("email"))},[t("div",q,[e[18]||(e[18]=r(" Email ")),s(g,{icon:l.getSortIcon("email"),size:"small",class:"ml-1"},null,8,["icon"])])]),t("th",{class:"sortable",onClick:e[7]||(e[7]=i=>u.onSort("phone"))},[t("div",Q,[e[19]||(e[19]=r(" Phone ")),s(g,{icon:l.getSortIcon("phone"),size:"small",class:"ml-1"},null,8,["icon"])])]),t("th",{class:"sortable",onClick:e[8]||(e[8]=i=>u.onSort("type"))},[t("div",G,[e[20]||(e[20]=r(" Type ")),s(g,{icon:l.getSortIcon("type"),size:"small",class:"ml-1"},null,8,["icon"])])]),t("th",{class:"sortable",onClick:e[9]||(e[9]=i=>u.onSort("status"))},[t("div",J,[e[21]||(e[21]=r(" Status ")),s(g,{icon:l.getSortIcon("status"),size:"small",class:"ml-1"},null,8,["icon"])])]),t("th",{class:"sortable",onClick:e[10]||(e[10]=i=>u.onSort("created_at"))},[t("div",K,[e[22]||(e[22]=r(" Date ")),s(g,{icon:l.getSortIcon("created_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[23]||(e[23]=t("th",null,"Read",-1)),e[24]||(e[24]=t("th",null,"Actions",-1))])]),t("tbody",null,[l.loading?(d(),p(C,{key:0},F(5,i=>t("tr",{key:`skeleton-${i}`},[t("td",null,[t("div",W,[s(f,{type:"avatar",width:"16",height:"16",class:"mr-2"}),s(f,{type:"text",width:"120"})])]),t("td",null,[s(f,{type:"text",width:"180"})]),t("td",null,[s(f,{type:"text",width:"100"})]),t("td",null,[s(f,{type:"chip",width:"80",height:"24"})]),t("td",null,[s(f,{type:"chip",width:"90",height:"24"})]),t("td",null,[s(f,{type:"text",width:"120"})]),t("td",null,[s(f,{type:"chip",width:"70",height:"24"})]),t("td",null,[t("div",X,[s(f,{type:"button",width:"32",height:"32",class:"mr-1"}),s(f,{type:"button",width:"32",height:"32"})])])])),64)):(d(),p(C,{key:1},[(d(!0),p(C,null,F(o.leads,i=>(d(),p("tr",{key:i.id,class:j({"unread-row":!i.is_read})},[t("td",null,[t("div",Y,[i.is_read?(d(),p("span",Z)):(d(),v(g,{key:0,icon:"mdi-circle",size:"small",color:"primary",class:"mr-2"})),r(" "+n(i.name),1)])]),t("td",null,n(i.email),1),t("td",null,n(i.phone||"-"),1),t("td",null,[s(h,{size:"small",variant:"outlined"},{default:a(()=>[r(n(i.type),1)]),_:2},1024)]),t("td",null,[s(h,{color:u.getStatusColor(i.status),size:"small"},{default:a(()=>[r(n(i.status),1)]),_:2},1032,["color"])]),t("td",null,n(l.formatDate(i.created_at)),1),t("td",null,[i.is_read?(d(),v(h,{key:0,size:"small",color:"success",variant:"flat"},{default:a(()=>[s(g,{icon:"mdi-check",size:"small",class:"mr-1"}),e[25]||(e[25]=r(" Read "))]),_:1,__:[25]})):(d(),v(h,{key:1,size:"small",color:"error",variant:"flat"},{default:a(()=>[s(g,{icon:"mdi-email",size:"small",class:"mr-1"}),e[26]||(e[26]=r(" Unread "))]),_:1,__:[26]}))]),t("td",null,[s(b,{size:"small",icon:"mdi-eye",onClick:N=>u.viewLead(i),variant:"text",class:"mr-1"},null,8,["onClick"]),i.is_read?y("",!0):(d(),v(b,{key:0,size:"small",icon:"mdi-email-mark-as-unread",onClick:N=>u.markAsRead(i),variant:"text",color:"primary",title:"Mark as read"},null,8,["onClick"]))])],2))),128)),o.leads.length===0?(d(),p("tr",$,e[27]||(e[27]=[t("td",{colspan:"8",class:"text-center py-4"},"No leads found",-1)]))):y("",!0)],64))])]),_:1}),t("div",ee,[t("div",te,[o.leads.length>0&&l.pagination.total>0?(d(),p("span",se,[e[28]||(e[28]=r(" Showing ")),t("strong",null,n((l.currentPage-1)*l.perPage+1),1),e[29]||(e[29]=r(" to ")),t("strong",null,n(Math.min(l.currentPage*l.perPage,l.pagination.total)),1),e[30]||(e[30]=r(" of ")),t("strong",null,n(l.pagination.total.toLocaleString()),1),e[31]||(e[31]=r(" records ")),l.pagination.last_page>1?(d(),p("span",le," (Page "+n(l.currentPage)+" of "+n(l.pagination.last_page)+") ",1)):y("",!0)])):(d(),p("span",ae," No records found "))]),l.pagination.last_page>1?(d(),p("div",oe,[s(z,{modelValue:l.currentPage,"onUpdate:modelValue":[e[11]||(e[11]=i=>l.currentPage=i),u.loadLeads],length:l.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):y("",!0)])]),_:1})]),_:1}),s(R,{modelValue:o.showDialog,"onUpdate:modelValue":e[12]||(e[12]=i=>o.showDialog=i),"max-width":"800",scrollable:""},{default:a(()=>[o.selectedLead?(d(),v(L,{key:0},{default:a(()=>[s(V,{class:"d-flex justify-space-between align-center bg-primary text-white"},{default:a(()=>[t("div",ie,[s(g,{icon:"mdi-email",class:"mr-2"}),e[32]||(e[32]=t("span",null,"Lead Details",-1))]),s(b,{icon:"mdi-close",variant:"text",onClick:u.closeDialog,color:"white"},null,8,["onClick"])]),_:1}),s(x,{class:"pa-6"},{default:a(()=>[s(S,null,{default:a(()=>[s(c,{cols:"12",md:"6"},{default:a(()=>[t("div",ne,[e[33]||(e[33]=t("div",{class:"text-caption text-grey mb-1"},"Name",-1)),t("div",de,n(o.selectedLead.name),1)])]),_:1}),s(c,{cols:"12",md:"6"},{default:a(()=>[t("div",re,[e[34]||(e[34]=t("div",{class:"text-caption text-grey mb-1"},"Email",-1)),t("div",ue,[t("a",{href:`mailto:${o.selectedLead.email}`,class:"text-primary text-decoration-none"},n(o.selectedLead.email),9,ce)])])]),_:1}),s(c,{cols:"12",md:"6"},{default:a(()=>[t("div",me,[e[35]||(e[35]=t("div",{class:"text-caption text-grey mb-1"},"Phone",-1)),t("div",pe,[o.selectedLead.phone?(d(),p("a",{key:0,href:`tel:${o.selectedLead.phone}`,class:"text-primary text-decoration-none"},n(o.selectedLead.phone),9,ge)):(d(),p("span",ve,"N/A"))])])]),_:1}),s(c,{cols:"12",md:"6"},{default:a(()=>[t("div",ye,[e[36]||(e[36]=t("div",{class:"text-caption text-grey mb-1"},"Type",-1)),t("div",fe,[s(h,{size:"small",variant:"outlined"},{default:a(()=>[r(n(o.selectedLead.type),1)]),_:1})])])]),_:1}),s(c,{cols:"12",md:"6"},{default:a(()=>[t("div",he,[e[37]||(e[37]=t("div",{class:"text-caption text-grey mb-1"},"Status",-1)),t("div",_e,[s(h,{color:u.getStatusColor(o.selectedLead.status),size:"small"},{default:a(()=>[r(n(o.selectedLead.status),1)]),_:1},8,["color"])])])]),_:1}),s(c,{cols:"12",md:"6"},{default:a(()=>[t("div",be,[e[40]||(e[40]=t("div",{class:"text-caption text-grey mb-1"},"Read Status",-1)),t("div",ke,[o.selectedLead.is_read?(d(),v(h,{key:0,size:"small",color:"success",variant:"flat"},{default:a(()=>[s(g,{icon:"mdi-check",size:"small",class:"mr-1"}),e[38]||(e[38]=r(" Read "))]),_:1,__:[38]})):(d(),v(h,{key:1,size:"small",color:"error",variant:"flat"},{default:a(()=>[s(g,{icon:"mdi-email",size:"small",class:"mr-1"}),e[39]||(e[39]=r(" Unread "))]),_:1,__:[39]}))])])]),_:1}),o.selectedLead.subject?(d(),v(c,{key:0,cols:"12"},{default:a(()=>[t("div",we,[e[41]||(e[41]=t("div",{class:"text-caption text-grey mb-1"},"Subject",-1)),t("div",xe,n(o.selectedLead.subject),1)])]),_:1})):y("",!0),s(c,{cols:"12"},{default:a(()=>[t("div",Le,[e[42]||(e[42]=t("div",{class:"text-caption text-grey mb-1"},"Message",-1)),t("div",Ce,n(o.selectedLead.message||"No message provided"),1)])]),_:1}),s(c,{cols:"12",md:"6"},{default:a(()=>[t("div",Se,[e[43]||(e[43]=t("div",{class:"text-caption text-grey mb-1"},"Created At",-1)),t("div",Ve,n(l.formatDate(o.selectedLead.created_at)),1)])]),_:1}),o.selectedLead.read_at?(d(),v(c,{key:1,cols:"12",md:"6"},{default:a(()=>[t("div",Fe,[e[44]||(e[44]=t("div",{class:"text-caption text-grey mb-1"},"Read At",-1)),t("div",Pe,n(l.formatDate(o.selectedLead.read_at)),1)])]),_:1})):y("",!0),o.selectedLead.assigned_user?(d(),v(c,{key:2,cols:"12"},{default:a(()=>[t("div",Ue,[e[45]||(e[45]=t("div",{class:"text-caption text-grey mb-1"},"Assigned To",-1)),t("div",ze,n(o.selectedLead.assigned_user.name),1)])]),_:1})):y("",!0),o.selectedLead.notes?(d(),v(c,{key:3,cols:"12"},{default:a(()=>[t("div",Ae,[e[46]||(e[46]=t("div",{class:"text-caption text-grey mb-1"},"Notes",-1)),t("div",De,n(o.selectedLead.notes),1)])]),_:1})):y("",!0)]),_:1})]),_:1}),s(D,{class:"pa-4 bg-grey-lighten-5"},{default:a(()=>[s(A),o.selectedLead.is_read?y("",!0):(d(),v(b,{key:0,color:"primary","prepend-icon":"mdi-email-mark-as-unread",onClick:u.markAsReadFromDialog},{default:a(()=>e[47]||(e[47]=[r(" Mark as Read ")])),_:1,__:[47]},8,["onClick"])),s(b,{color:"grey",variant:"text",onClick:u.closeDialog},{default:a(()=>e[48]||(e[48]=[r("Close")])),_:1,__:[48]},8,["onClick"])]),_:1})]),_:1})):y("",!0)]),_:1},8,["modelValue"])])}const Ie=E(O,[["render",Re],["__scopeId","data-v-b83fbeac"]]);export{Ie as default};
