import{_ as O,d as m,a as t,b as s,w as o,f as a,t as r,r as u,h as _,F as B,e as T,c as w,g as L,o as c}from"./app-aVdZPH9_.js";import{a as I}from"./adminPaginationMixin-DN7Wb3ng.js";import{h as E}from"./moment-C5S46NFB.js";const H={mixins:[I],data(){return{logs:[],statistics:{total:0,human_visits:0,bot_visits:0,unique_ips:0},deviceFilter:null,browserFilter:null,botFilter:null,deviceOptions:[{title:"Desktop",value:"desktop"},{title:"Mobile",value:"mobile"},{title:"Tablet",value:"tablet"}],browserOptions:[],botOptions:[{title:"Human Only",value:"false"},{title:"Bots Only",value:"true"}],viewDialog:!1,selectedLog:null,selectedLogs:[],selectAll:!1}},async mounted(){await this.loadStatistics(),await this.loadLogs()},methods:{async loadStatistics(){try{const l=await L.get("/api/v1/visitor-logs/statistics",{headers:this.getAuthHeaders()});this.statistics=l.data,l.data.browser_stats&&(this.browserOptions=Object.keys(l.data.browser_stats).map(e=>({title:e,value:e})))}catch(l){console.error("Error loading statistics:",l)}},async loadLogs(){try{this.loading=!0;const l=this.buildPaginationParams();this.search&&(l.search=this.search),this.deviceFilter&&(l.device_type=this.deviceFilter),this.browserFilter&&(l.browser=this.browserFilter),this.botFilter!==null&&(l.is_bot=this.botFilter);const e=await L.get("/api/v1/visitor-logs",{params:l,headers:this.getAuthHeaders()});this.logs=e.data.data||[],this.updatePagination(e.data)}catch(l){this.handleApiError(l,"Failed to load visitor logs")}finally{this.loading=!1}},viewLog(l){this.selectedLog=l,this.viewDialog=!0},async deleteLog(l){if(confirm("Are you sure you want to delete this visitor log?"))try{await L.delete(`/api/v1/visitor-logs/${l.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Visitor log deleted successfully"),await this.loadStatistics(),await this.loadLogs()}catch(e){this.handleApiError(e,"Error deleting visitor log")}},async deleteSelected(){if(this.selectedLogs.length!==0&&confirm(`Are you sure you want to delete ${this.selectedLogs.length} visitor log(s)?`))try{await L.post("/api/v1/visitor-logs/delete-multiple",{ids:this.selectedLogs},{headers:this.getAuthHeaders()}),this.showSuccess(`${this.selectedLogs.length} visitor log(s) deleted successfully`),this.selectedLogs=[],this.selectAll=!1,await this.loadStatistics(),await this.loadLogs()}catch(l){this.handleApiError(l,"Error deleting visitor logs")}},toggleSelectAll(){this.selectAll?this.selectedLogs=this.logs.map(l=>l.id):this.selectedLogs=[]},formatDate(l){return l?E(l).format("YYYY-MM-DD HH:mm:ss"):"-"},truncateText(l,e){return l?l.length>e?l.substring(0,e)+"...":l:"-"},getDeviceColor(l){return{desktop:"primary",mobile:"success",tablet:"info"}[l]||"grey"},onPerPageChange(){this.resetPagination(),this.loadLogs()},onSort(l){this.handleSort(l),this.loadLogs()}},watch:{selectedLogs(l){this.selectAll=l.length===this.logs.length&&this.logs.length>0}}},M={class:"page-header"},R={class:"d-flex align-center"},N={class:"text-h6"},Y={class:"d-flex align-center"},j={class:"text-h6"},q={class:"d-flex align-center"},G={class:"text-h6"},J={class:"d-flex align-center"},K={class:"text-h6"},Q={class:"d-flex align-center"},W={class:"text-h6"},X={class:"text-caption text-grey"},Z={key:0},$={class:"d-flex align-center"},ee={class:"d-flex align-center"},te={class:"d-flex align-center"},le=["title"],se=["title"],oe={key:1,class:"text-grey"},ie={key:0},ne={class:"d-flex justify-space-between align-center mt-4"},re={class:"text-caption text-grey"},ae={key:0},de={key:1},ue={class:"mb-3"},ce={class:"mb-3"},ge={class:"mt-1"},me=["href"],ve={class:"mb-3"},pe={class:"mt-1"},fe=["href"],_e={key:1,class:"text-grey"},be={class:"mb-3"},he={class:"mb-3"},ye={class:"mb-3"},we={class:"mb-3"},Le={class:"mb-3"},Ve={class:"mb-3"};function ke(l,e,xe,Pe,i,d){const h=u("v-btn"),v=u("v-icon"),p=u("v-card-text"),f=u("v-card"),g=u("v-col"),V=u("v-row"),y=u("v-select"),S=u("v-text-field"),x=u("v-card-title"),P=u("v-checkbox"),b=u("v-chip"),A=u("v-table"),C=u("v-pagination"),D=u("v-textarea"),U=u("v-spacer"),F=u("v-card-actions"),z=u("v-dialog");return c(),m("div",null,[t("div",M,[e[13]||(e[13]=t("h1",{class:"text-h4 page-title"},"Visitor Log Management",-1)),s(h,{color:"error","prepend-icon":"mdi-delete",onClick:d.deleteSelected,disabled:i.selectedLogs.length===0},{default:o(()=>[a(" Delete Selected ("+r(i.selectedLogs.length)+") ",1)]),_:1},8,["onClick","disabled"])]),s(V,{class:"mb-4"},{default:o(()=>[s(g,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(p,null,{default:o(()=>[t("div",R,[s(v,{color:"primary",size:"40",class:"mr-3"},{default:o(()=>e[14]||(e[14]=[a("mdi-account-group")])),_:1,__:[14]}),t("div",null,[t("div",N,r(i.statistics.total||0),1),e[15]||(e[15]=t("div",{class:"text-caption text-grey"},"Total Visits",-1))])])]),_:1})]),_:1})]),_:1}),s(g,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(p,null,{default:o(()=>[t("div",Y,[s(v,{color:"success",size:"40",class:"mr-3"},{default:o(()=>e[16]||(e[16]=[a("mdi-account")])),_:1,__:[16]}),t("div",null,[t("div",j,r(i.statistics.human_visits||0),1),e[17]||(e[17]=t("div",{class:"text-caption text-grey"},"Human Visits",-1))])])]),_:1})]),_:1})]),_:1}),s(g,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(p,null,{default:o(()=>[t("div",q,[s(v,{color:"warning",size:"40",class:"mr-3"},{default:o(()=>e[18]||(e[18]=[a("mdi-robot")])),_:1,__:[18]}),t("div",null,[t("div",G,r(i.statistics.bot_visits||0),1),e[19]||(e[19]=t("div",{class:"text-caption text-grey"},"Bot Visits",-1))])])]),_:1})]),_:1})]),_:1}),s(g,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(p,null,{default:o(()=>[t("div",J,[s(v,{color:"info",size:"40",class:"mr-3"},{default:o(()=>e[20]||(e[20]=[a("mdi-web")])),_:1,__:[20]}),t("div",null,[t("div",K,r(i.statistics.unique_ips||0),1),e[21]||(e[21]=t("div",{class:"text-caption text-grey"},"Unique IPs",-1))])])]),_:1})]),_:1})]),_:1}),s(g,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(p,null,{default:o(()=>[t("div",Q,[s(v,{color:"purple",size:"40",class:"mr-3"},{default:o(()=>e[22]||(e[22]=[a("mdi-database")])),_:1,__:[22]}),t("div",null,[t("div",W,r(l.pagination.total||0),1),e[23]||(e[23]=t("div",{class:"text-caption text-grey"},"Total Records",-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),s(f,{class:"mb-4"},{default:o(()=>[s(p,null,{default:o(()=>[s(V,null,{default:o(()=>[s(g,{cols:"12",md:"2"},{default:o(()=>[s(y,{modelValue:l.perPage,"onUpdate:modelValue":[e[0]||(e[0]=n=>l.perPage=n),d.onPerPageChange],items:l.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(g,{cols:"12",md:"2"},{default:o(()=>[s(y,{modelValue:i.deviceFilter,"onUpdate:modelValue":[e[1]||(e[1]=n=>i.deviceFilter=n),d.loadLogs],items:i.deviceOptions,label:"Device Type","prepend-inner-icon":"mdi-devices",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(g,{cols:"12",md:"2"},{default:o(()=>[s(y,{modelValue:i.browserFilter,"onUpdate:modelValue":[e[2]||(e[2]=n=>i.browserFilter=n),d.loadLogs],items:i.browserOptions,label:"Browser","prepend-inner-icon":"mdi-web",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(g,{cols:"12",md:"2"},{default:o(()=>[s(y,{modelValue:i.botFilter,"onUpdate:modelValue":[e[3]||(e[3]=n=>i.botFilter=n),d.loadLogs],items:i.botOptions,label:"Bot Filter","prepend-inner-icon":"mdi-robot",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(g,{cols:"12",md:"4"},{default:o(()=>[s(S,{modelValue:l.search,"onUpdate:modelValue":[e[4]||(e[4]=n=>l.search=n),d.loadLogs],label:"Search (IP, URL, user agent)","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(f,null,{default:o(()=>[s(x,{class:"d-flex justify-space-between align-center"},{default:o(()=>[e[25]||(e[25]=t("span",null,"Visitor Logs",-1)),t("span",X,[e[24]||(e[24]=a(" Total Records: ")),t("strong",null,r(l.pagination.total||0),1),i.logs.length>0?(c(),m("span",Z," | Showing "+r((l.currentPage-1)*l.perPage+1)+" to "+r(Math.min(l.currentPage*l.perPage,l.pagination.total))+" of "+r(l.pagination.total),1)):_("",!0)])]),_:1,__:[25]}),s(p,null,{default:o(()=>[s(A,null,{default:o(()=>[t("thead",null,[t("tr",null,[t("th",null,[s(P,{modelValue:i.selectAll,"onUpdate:modelValue":e[5]||(e[5]=n=>i.selectAll=n),onChange:d.toggleSelectAll,density:"compact"},null,8,["modelValue","onChange"])]),t("th",{class:"sortable",onClick:e[6]||(e[6]=n=>d.onSort("ip_address"))},[t("div",$,[e[26]||(e[26]=a(" IP Address ")),s(v,{icon:l.getSortIcon("ip_address"),size:"small",class:"ml-1"},null,8,["icon"])])]),t("th",{class:"sortable",onClick:e[7]||(e[7]=n=>d.onSort("url"))},[t("div",ee,[e[27]||(e[27]=a(" URL ")),s(v,{icon:l.getSortIcon("url"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[29]||(e[29]=t("th",null,"Device",-1)),e[30]||(e[30]=t("th",null,"Browser",-1)),e[31]||(e[31]=t("th",null,"OS",-1)),e[32]||(e[32]=t("th",null,"Referer",-1)),t("th",{class:"sortable",onClick:e[8]||(e[8]=n=>d.onSort("created_at"))},[t("div",te,[e[28]||(e[28]=a(" Date ")),s(v,{icon:l.getSortIcon("created_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[33]||(e[33]=t("th",null,"Actions",-1))])]),t("tbody",null,[(c(!0),m(B,null,T(i.logs,n=>(c(),m("tr",{key:n.id},[t("td",null,[s(P,{value:n.id,modelValue:i.selectedLogs,"onUpdate:modelValue":e[9]||(e[9]=k=>i.selectedLogs=k),density:"compact"},null,8,["value","modelValue"])]),t("td",null,[s(b,{size:"small",variant:"outlined"},{default:o(()=>[a(r(n.ip_address||"-"),1)]),_:2},1024)]),t("td",null,[t("span",{class:"text-caption",title:n.url},r(d.truncateText(n.url,40)),9,le)]),t("td",null,[s(b,{size:"small",color:d.getDeviceColor(n.device_type)},{default:o(()=>[a(r(n.device_type||"-"),1)]),_:2},1032,["color"]),n.is_bot?(c(),w(b,{key:0,size:"x-small",color:"warning",class:"ml-1"},{default:o(()=>e[34]||(e[34]=[a("Bot")])),_:1,__:[34]})):_("",!0)]),t("td",null,r(n.browser||"-"),1),t("td",null,r(n.os||"-"),1),t("td",null,[n.referer?(c(),m("span",{key:0,class:"text-caption",title:n.referer},r(d.truncateText(n.referer,30)),9,se)):(c(),m("span",oe,"-"))]),t("td",null,r(d.formatDate(n.created_at)),1),t("td",null,[s(h,{size:"small",icon:"mdi-eye",onClick:k=>d.viewLog(n),variant:"text"},null,8,["onClick"]),s(h,{size:"small",icon:"mdi-delete",onClick:k=>d.deleteLog(n),variant:"text",color:"error"},null,8,["onClick"])])]))),128)),i.logs.length===0?(c(),m("tr",ie,e[35]||(e[35]=[t("td",{colspan:"9",class:"text-center py-4"},"No visitor logs found",-1)]))):_("",!0)])]),_:1}),t("div",ne,[t("div",re,[i.logs.length>0?(c(),m("span",ae," Showing "+r((l.currentPage-1)*l.perPage+1)+" to "+r(Math.min(l.currentPage*l.perPage,l.pagination.total))+" of "+r(l.pagination.total)+" records ",1)):(c(),m("span",de," No records found "))]),l.pagination.last_page>1?(c(),w(C,{key:0,modelValue:l.currentPage,"onUpdate:modelValue":[e[10]||(e[10]=n=>l.currentPage=n),d.loadLogs],length:l.pagination.last_page},null,8,["modelValue","length","onUpdate:modelValue"])):_("",!0)])]),_:1})]),_:1}),s(z,{modelValue:i.viewDialog,"onUpdate:modelValue":e[12]||(e[12]=n=>i.viewDialog=n),"max-width":"800"},{default:o(()=>[i.selectedLog?(c(),w(f,{key:0},{default:o(()=>[s(x,null,{default:o(()=>e[36]||(e[36]=[a("Visitor Log Details")])),_:1,__:[36]}),s(p,null,{default:o(()=>[s(V,null,{default:o(()=>[s(g,{cols:"12",md:"6"},{default:o(()=>[t("div",ue,[e[37]||(e[37]=t("strong",null,"IP Address:",-1)),a(" "+r(i.selectedLog.ip_address||"-"),1)]),t("div",ce,[e[38]||(e[38]=t("strong",null,"URL:",-1)),t("div",ge,[t("a",{href:i.selectedLog.url,target:"_blank",class:"text-primary"},r(i.selectedLog.url),9,me)])]),t("div",ve,[e[39]||(e[39]=t("strong",null,"Referer:",-1)),t("div",pe,[i.selectedLog.referer?(c(),m("a",{key:0,href:i.selectedLog.referer,target:"_blank",class:"text-primary"},r(i.selectedLog.referer),9,fe)):(c(),m("span",_e,"-"))])]),t("div",be,[e[40]||(e[40]=t("strong",null,"Method:",-1)),a(" "+r(i.selectedLog.method||"GET"),1)])]),_:1}),s(g,{cols:"12",md:"6"},{default:o(()=>[t("div",he,[e[42]||(e[42]=t("strong",null,"Device Type:",-1)),s(b,{size:"small",color:d.getDeviceColor(i.selectedLog.device_type),class:"ml-2"},{default:o(()=>[a(r(i.selectedLog.device_type||"-"),1)]),_:1},8,["color"]),i.selectedLog.is_bot?(c(),w(b,{key:0,size:"small",color:"warning",class:"ml-2"},{default:o(()=>e[41]||(e[41]=[a("Bot")])),_:1,__:[41]})):_("",!0)]),t("div",ye,[e[43]||(e[43]=t("strong",null,"Browser:",-1)),a(" "+r(i.selectedLog.browser||"-"),1)]),t("div",we,[e[44]||(e[44]=t("strong",null,"OS:",-1)),a(" "+r(i.selectedLog.os||"-"),1)]),t("div",Le,[e[45]||(e[45]=t("strong",null,"Page Views:",-1)),a(" "+r(i.selectedLog.page_views||1),1)]),t("div",Ve,[e[46]||(e[46]=t("strong",null,"Created At:",-1)),a(" "+r(d.formatDate(i.selectedLog.created_at)),1)])]),_:1}),s(g,{cols:"12"},{default:o(()=>[e[47]||(e[47]=t("div",{class:"mb-2"},[t("strong",null,"User Agent:")],-1)),s(D,{value:i.selectedLog.user_agent||"-",readonly:"",variant:"outlined",density:"compact",rows:"3"},null,8,["value"])]),_:1,__:[47]})]),_:1})]),_:1}),s(F,null,{default:o(()=>[s(U),s(h,{onClick:e[11]||(e[11]=n=>i.viewDialog=!1),variant:"text"},{default:o(()=>e[48]||(e[48]=[a("Close")])),_:1,__:[48]})]),_:1})]),_:1})):_("",!0)]),_:1},8,["modelValue"])])}const De=O(H,[["render",ke],["__scopeId","data-v-292ebfb1"]]);export{De as default};
