import{_ as D,d as v,a as t,b as l,w as a,f as c,r as m,h as f,t as d,F as R,e as N,c as p,g as b,o as n,n as E}from"./app-aVdZPH9_.js";import{a as j}from"./adminPaginationMixin-DN7Wb3ng.js";const I={mixins:[j],inject:["refreshUnreadCount"],data(){return{leads:[],statusFilter:null,typeFilter:null,readFilter:null,showDialog:!1,selectedLead:null,statusOptions:[{title:"New",value:"new"},{title:"Contacted",value:"contacted"},{title:"Qualified",value:"qualified"},{title:"Converted",value:"converted"},{title:"Lost",value:"lost"}],typeOptions:[{title:"Contact",value:"contact"},{title:"Quote",value:"quote"},{title:"Support",value:"support"}],readOptions:[{title:"Unread",value:"unread"},{title:"Read",value:"read"}]}},async mounted(){await this.loadLeads()},methods:{async loadLeads(){try{this.loading=!0;const s=this.buildPaginationParams();this.search&&(s.search=this.search),this.statusFilter&&(s.status=this.statusFilter),this.typeFilter&&(s.type=this.typeFilter),this.readFilter==="unread"?s.is_read=!1:this.readFilter==="read"&&(s.is_read=!0);const e=await b.get("/api/v1/leads",{params:s,headers:this.getAuthHeaders()});this.leads=e.data.data||[],this.updatePagination(e.data)}catch(s){this.handleApiError(s,"Failed to load leads")}finally{this.loading=!1}},async viewLead(s){try{const e=await b.get(`/api/v1/leads/${s.id}`,{headers:this.getAuthHeaders()});this.selectedLead=e.data,this.showDialog=!0,await this.loadLeads(),this.refreshUnreadCount&&this.refreshUnreadCount()}catch(e){this.handleApiError(e,"Failed to load lead details")}},closeDialog(){this.showDialog=!1,this.selectedLead=null},async markAsReadFromDialog(){if(this.selectedLead)try{await b.post(`/api/v1/leads/${this.selectedLead.id}/mark-as-read`,{},{headers:this.getAuthHeaders()}),this.selectedLead.is_read=!0,this.selectedLead.read_at=new Date().toISOString(),this.showSuccess("Lead marked as read"),await this.loadLeads(),this.refreshUnreadCount&&this.refreshUnreadCount()}catch(s){this.handleApiError(s,"Failed to mark lead as read")}},async markAsRead(s){try{await b.post(`/api/v1/leads/${s.id}/mark-as-read`,{},{headers:this.getAuthHeaders()}),this.showSuccess("Lead marked as read"),await this.loadLeads(),this.refreshUnreadCount&&this.refreshUnreadCount()}catch(e){this.handleApiError(e,"Failed to mark lead as read")}},async exportLeads(){try{const s=await b.get("/api/v1/leads/export/csv",{headers:this.getAuthHeaders(),responseType:"blob"}),e=window.URL.createObjectURL(new Blob([s.data])),_=document.createElement("a");_.href=e,_.setAttribute("download","leads.csv"),document.body.appendChild(_),_.click(),document.body.removeChild(_),this.showSuccess("Leads exported successfully")}catch(s){this.handleApiError(s,"Error exporting leads")}},getStatusColor(s){return{new:"info",contacted:"warning",qualified:"primary",converted:"success",lost:"error"}[s]||"grey"},onPerPageChange(){this.resetPagination(),this.loadLeads()},onSort(s){this.handleSort(s),this.loadLeads()}}},O={class:"d-flex justify-space-between align-center mb-6"},M={class:"text-caption text-grey"},T={key:0},B={class:"d-flex align-center"},H={class:"d-flex align-center"},q={class:"d-flex align-center"},Q={class:"d-flex align-center"},G={class:"d-flex align-center"},J={class:"d-flex align-center"},K={class:"d-flex align-center"},W={key:1,class:"mr-2",style:{width:"16px"}},X={key:0},Y={class:"d-flex justify-space-between align-center mt-4"},Z={class:"text-caption text-grey"},$={key:0},ee={key:1},te={class:"d-flex align-center"},se={class:"mb-4"},le={class:"text-body-1 font-weight-medium"},ae={class:"mb-4"},oe={class:"text-body-1"},ie=["href"],de={class:"mb-4"},ne={class:"text-body-1"},re=["href"],ce={key:1,class:"text-grey"},ue={class:"mb-4"},me={class:"text-body-1"},pe={class:"mb-4"},ge={class:"text-body-1"},ve={class:"mb-4"},fe={class:"text-body-1"},ye={class:"mb-4"},_e={class:"text-body-1 font-weight-medium"},he={class:"mb-4"},be={class:"text-body-1 pa-4 bg-grey-lighten-4 rounded",style:{"white-space":"pre-wrap","min-height":"100px"}},ke={class:"mb-4"},Le={class:"text-body-2"},xe={class:"mb-4"},we={class:"text-body-2"},Ce={class:"mb-4"},Se={class:"text-body-1"},Ve={class:"mb-4"},Fe={class:"text-body-1 pa-4 bg-grey-lighten-4 rounded",style:{"white-space":"pre-wrap"}};function Ue(s,e,_,Pe,o,r){const h=m("v-btn"),k=m("v-select"),u=m("v-col"),S=m("v-text-field"),w=m("v-row"),L=m("v-card-text"),x=m("v-card"),C=m("v-card-title"),g=m("v-icon"),y=m("v-chip"),V=m("v-table"),F=m("v-pagination"),U=m("v-spacer"),P=m("v-card-actions"),z=m("v-dialog");return n(),v("div",null,[t("div",O,[e[14]||(e[14]=t("h1",{class:"text-h4"},"Leads Management",-1)),l(h,{color:"primary","prepend-icon":"mdi-download",onClick:r.exportLeads},{default:a(()=>e[13]||(e[13]=[c("Export to CSV")])),_:1,__:[13]},8,["onClick"])]),l(x,{class:"mb-4"},{default:a(()=>[l(L,null,{default:a(()=>[l(w,null,{default:a(()=>[l(u,{cols:"12",md:"2"},{default:a(()=>[l(k,{modelValue:s.perPage,"onUpdate:modelValue":[e[0]||(e[0]=i=>s.perPage=i),r.onPerPageChange],items:s.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(u,{cols:"12",md:"2"},{default:a(()=>[l(k,{modelValue:o.statusFilter,"onUpdate:modelValue":[e[1]||(e[1]=i=>o.statusFilter=i),r.loadLeads],items:o.statusOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(u,{cols:"12",md:"2"},{default:a(()=>[l(k,{modelValue:o.typeFilter,"onUpdate:modelValue":[e[2]||(e[2]=i=>o.typeFilter=i),r.loadLeads],items:o.typeOptions,label:"Filter by Type","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(u,{cols:"12",md:"2"},{default:a(()=>[l(k,{modelValue:o.readFilter,"onUpdate:modelValue":[e[3]||(e[3]=i=>o.readFilter=i),r.loadLeads],items:o.readOptions,label:"Filter by Read Status","prepend-inner-icon":"mdi-email",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:a(()=>[l(S,{modelValue:s.search,"onUpdate:modelValue":[e[4]||(e[4]=i=>s.search=i),r.loadLeads],label:"Search leads","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(x,null,{default:a(()=>[l(C,{class:"d-flex justify-space-between align-center"},{default:a(()=>[e[16]||(e[16]=t("span",null,"Leads",-1)),t("span",M,[e[15]||(e[15]=c(" Total Records: ")),t("strong",null,d(s.pagination.total||0),1),o.leads.length>0?(n(),v("span",T," | Showing "+d((s.currentPage-1)*s.perPage+1)+" to "+d(Math.min(s.currentPage*s.perPage,s.pagination.total))+" of "+d(s.pagination.total),1)):f("",!0)])]),_:1,__:[16]}),l(L,null,{default:a(()=>[l(V,null,{default:a(()=>[t("thead",null,[t("tr",null,[t("th",{class:"sortable",onClick:e[5]||(e[5]=i=>r.onSort("name"))},[t("div",B,[e[17]||(e[17]=c(" Name ")),l(g,{icon:s.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),t("th",{class:"sortable",onClick:e[6]||(e[6]=i=>r.onSort("email"))},[t("div",H,[e[18]||(e[18]=c(" Email ")),l(g,{icon:s.getSortIcon("email"),size:"small",class:"ml-1"},null,8,["icon"])])]),t("th",{class:"sortable",onClick:e[7]||(e[7]=i=>r.onSort("phone"))},[t("div",q,[e[19]||(e[19]=c(" Phone ")),l(g,{icon:s.getSortIcon("phone"),size:"small",class:"ml-1"},null,8,["icon"])])]),t("th",{class:"sortable",onClick:e[8]||(e[8]=i=>r.onSort("type"))},[t("div",Q,[e[20]||(e[20]=c(" Type ")),l(g,{icon:s.getSortIcon("type"),size:"small",class:"ml-1"},null,8,["icon"])])]),t("th",{class:"sortable",onClick:e[9]||(e[9]=i=>r.onSort("status"))},[t("div",G,[e[21]||(e[21]=c(" Status ")),l(g,{icon:s.getSortIcon("status"),size:"small",class:"ml-1"},null,8,["icon"])])]),t("th",{class:"sortable",onClick:e[10]||(e[10]=i=>r.onSort("created_at"))},[t("div",J,[e[22]||(e[22]=c(" Date ")),l(g,{icon:s.getSortIcon("created_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[23]||(e[23]=t("th",null,"Read",-1)),e[24]||(e[24]=t("th",null,"Actions",-1))])]),t("tbody",null,[(n(!0),v(R,null,N(o.leads,i=>(n(),v("tr",{key:i.id,class:E({"unread-row":!i.is_read})},[t("td",null,[t("div",K,[i.is_read?(n(),v("span",W)):(n(),p(g,{key:0,icon:"mdi-circle",size:"small",color:"primary",class:"mr-2"})),c(" "+d(i.name),1)])]),t("td",null,d(i.email),1),t("td",null,d(i.phone||"-"),1),t("td",null,[l(y,{size:"small",variant:"outlined"},{default:a(()=>[c(d(i.type),1)]),_:2},1024)]),t("td",null,[l(y,{color:r.getStatusColor(i.status),size:"small"},{default:a(()=>[c(d(i.status),1)]),_:2},1032,["color"])]),t("td",null,d(s.formatDate(i.created_at)),1),t("td",null,[i.is_read?(n(),p(y,{key:0,size:"small",color:"success",variant:"flat"},{default:a(()=>[l(g,{icon:"mdi-check",size:"small",class:"mr-1"}),e[25]||(e[25]=c(" Read "))]),_:1,__:[25]})):(n(),p(y,{key:1,size:"small",color:"error",variant:"flat"},{default:a(()=>[l(g,{icon:"mdi-email",size:"small",class:"mr-1"}),e[26]||(e[26]=c(" Unread "))]),_:1,__:[26]}))]),t("td",null,[l(h,{size:"small",icon:"mdi-eye",onClick:A=>r.viewLead(i),variant:"text",class:"mr-1"},null,8,["onClick"]),i.is_read?f("",!0):(n(),p(h,{key:0,size:"small",icon:"mdi-email-mark-as-unread",onClick:A=>r.markAsRead(i),variant:"text",color:"primary",title:"Mark as read"},null,8,["onClick"]))])],2))),128)),o.leads.length===0?(n(),v("tr",X,e[27]||(e[27]=[t("td",{colspan:"8",class:"text-center py-4"},"No leads found",-1)]))):f("",!0)])]),_:1}),t("div",Y,[t("div",Z,[o.leads.length>0?(n(),v("span",$," Showing "+d((s.currentPage-1)*s.perPage+1)+" to "+d(Math.min(s.currentPage*s.perPage,s.pagination.total))+" of "+d(s.pagination.total)+" records ",1)):(n(),v("span",ee," No records found "))]),s.pagination.last_page>1?(n(),p(F,{key:0,modelValue:s.currentPage,"onUpdate:modelValue":[e[11]||(e[11]=i=>s.currentPage=i),r.loadLeads],length:s.pagination.last_page},null,8,["modelValue","length","onUpdate:modelValue"])):f("",!0)])]),_:1})]),_:1}),l(z,{modelValue:o.showDialog,"onUpdate:modelValue":e[12]||(e[12]=i=>o.showDialog=i),"max-width":"800",scrollable:""},{default:a(()=>[o.selectedLead?(n(),p(x,{key:0},{default:a(()=>[l(C,{class:"d-flex justify-space-between align-center bg-primary text-white"},{default:a(()=>[t("div",te,[l(g,{icon:"mdi-email",class:"mr-2"}),e[28]||(e[28]=t("span",null,"Lead Details",-1))]),l(h,{icon:"mdi-close",variant:"text",onClick:r.closeDialog,color:"white"},null,8,["onClick"])]),_:1}),l(L,{class:"pa-6"},{default:a(()=>[l(w,null,{default:a(()=>[l(u,{cols:"12",md:"6"},{default:a(()=>[t("div",se,[e[29]||(e[29]=t("div",{class:"text-caption text-grey mb-1"},"Name",-1)),t("div",le,d(o.selectedLead.name),1)])]),_:1}),l(u,{cols:"12",md:"6"},{default:a(()=>[t("div",ae,[e[30]||(e[30]=t("div",{class:"text-caption text-grey mb-1"},"Email",-1)),t("div",oe,[t("a",{href:`mailto:${o.selectedLead.email}`,class:"text-primary text-decoration-none"},d(o.selectedLead.email),9,ie)])])]),_:1}),l(u,{cols:"12",md:"6"},{default:a(()=>[t("div",de,[e[31]||(e[31]=t("div",{class:"text-caption text-grey mb-1"},"Phone",-1)),t("div",ne,[o.selectedLead.phone?(n(),v("a",{key:0,href:`tel:${o.selectedLead.phone}`,class:"text-primary text-decoration-none"},d(o.selectedLead.phone),9,re)):(n(),v("span",ce,"N/A"))])])]),_:1}),l(u,{cols:"12",md:"6"},{default:a(()=>[t("div",ue,[e[32]||(e[32]=t("div",{class:"text-caption text-grey mb-1"},"Type",-1)),t("div",me,[l(y,{size:"small",variant:"outlined"},{default:a(()=>[c(d(o.selectedLead.type),1)]),_:1})])])]),_:1}),l(u,{cols:"12",md:"6"},{default:a(()=>[t("div",pe,[e[33]||(e[33]=t("div",{class:"text-caption text-grey mb-1"},"Status",-1)),t("div",ge,[l(y,{color:r.getStatusColor(o.selectedLead.status),size:"small"},{default:a(()=>[c(d(o.selectedLead.status),1)]),_:1},8,["color"])])])]),_:1}),l(u,{cols:"12",md:"6"},{default:a(()=>[t("div",ve,[e[36]||(e[36]=t("div",{class:"text-caption text-grey mb-1"},"Read Status",-1)),t("div",fe,[o.selectedLead.is_read?(n(),p(y,{key:0,size:"small",color:"success",variant:"flat"},{default:a(()=>[l(g,{icon:"mdi-check",size:"small",class:"mr-1"}),e[34]||(e[34]=c(" Read "))]),_:1,__:[34]})):(n(),p(y,{key:1,size:"small",color:"error",variant:"flat"},{default:a(()=>[l(g,{icon:"mdi-email",size:"small",class:"mr-1"}),e[35]||(e[35]=c(" Unread "))]),_:1,__:[35]}))])])]),_:1}),o.selectedLead.subject?(n(),p(u,{key:0,cols:"12"},{default:a(()=>[t("div",ye,[e[37]||(e[37]=t("div",{class:"text-caption text-grey mb-1"},"Subject",-1)),t("div",_e,d(o.selectedLead.subject),1)])]),_:1})):f("",!0),l(u,{cols:"12"},{default:a(()=>[t("div",he,[e[38]||(e[38]=t("div",{class:"text-caption text-grey mb-1"},"Message",-1)),t("div",be,d(o.selectedLead.message||"No message provided"),1)])]),_:1}),l(u,{cols:"12",md:"6"},{default:a(()=>[t("div",ke,[e[39]||(e[39]=t("div",{class:"text-caption text-grey mb-1"},"Created At",-1)),t("div",Le,d(s.formatDate(o.selectedLead.created_at)),1)])]),_:1}),o.selectedLead.read_at?(n(),p(u,{key:1,cols:"12",md:"6"},{default:a(()=>[t("div",xe,[e[40]||(e[40]=t("div",{class:"text-caption text-grey mb-1"},"Read At",-1)),t("div",we,d(s.formatDate(o.selectedLead.read_at)),1)])]),_:1})):f("",!0),o.selectedLead.assigned_user?(n(),p(u,{key:2,cols:"12"},{default:a(()=>[t("div",Ce,[e[41]||(e[41]=t("div",{class:"text-caption text-grey mb-1"},"Assigned To",-1)),t("div",Se,d(o.selectedLead.assigned_user.name),1)])]),_:1})):f("",!0),o.selectedLead.notes?(n(),p(u,{key:3,cols:"12"},{default:a(()=>[t("div",Ve,[e[42]||(e[42]=t("div",{class:"text-caption text-grey mb-1"},"Notes",-1)),t("div",Fe,d(o.selectedLead.notes),1)])]),_:1})):f("",!0)]),_:1})]),_:1}),l(P,{class:"pa-4 bg-grey-lighten-5"},{default:a(()=>[l(U),o.selectedLead.is_read?f("",!0):(n(),p(h,{key:0,color:"primary","prepend-icon":"mdi-email-mark-as-unread",onClick:r.markAsReadFromDialog},{default:a(()=>e[43]||(e[43]=[c(" Mark as Read ")])),_:1,__:[43]},8,["onClick"])),l(h,{color:"grey",variant:"text",onClick:r.closeDialog},{default:a(()=>e[44]||(e[44]=[c("Close")])),_:1,__:[44]},8,["onClick"])]),_:1})]),_:1})):f("",!0)]),_:1},8,["modelValue"])])}const De=D(I,[["render",Ue],["__scopeId","data-v-d9fb763d"]]);export{De as default};
