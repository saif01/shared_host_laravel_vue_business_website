import{h as M}from"./moment-C5S46NFB.js";import{_ as T,d as U,b as t,w as s,a as c,c as a,g as l,r as d,f as g,t as _,m as p,h as J,D as x,o as i}from"./app-CMVtwJaV.js";import{r as j}from"./uploads-CnEkgyD_.js";import{U as F}from"./UserProfileDialog-fYGtuooX.js";const q={components:{UserProfileDialog:F},data(){return{drawer:!0,authStore:null,currentUser:null,userRoles:[],userPermissions:[],currentDate:M().format("Do MMMM YYYY"),currentYear:new Date().getFullYear(),unreadCount:0,unreadCountInterval:null,brandingLogo:null,siteName:null,profileDialogVisible:!1}},computed:{resolvedBrandingLogo(){return this.brandingLogo?this.resolveImageUrl(this.brandingLogo):null},resolvedUserAvatar(){return!this.currentUser||!this.currentUser.avatar?null:this.resolveImageUrl(this.currentUser.avatar)}},methods:{async loadUser(){var m;try{const e=localStorage.getItem("admin_token");if(!e){this.$router.push("/admin/login");return}const h=await this.$axios.get("/api/v1/auth/user",{headers:{Authorization:`Bearer ${e}`}});this.currentUser=h.data,this.userRoles=h.data.roles||[],this.authStore&&(this.authStore.user=h.data,this.authStore.token=e,this.authStore.isAuthenticated=!0,this.authStore.extractRolesAndPermissions(h.data)),this.userPermissions=[],this.userRoles&&this.userRoles.length>0&&this.userRoles.forEach(f=>{f.permissions&&f.permissions.length>0&&f.permissions.forEach(r=>{this.userPermissions.includes(r.slug)||this.userPermissions.push(r.slug)})})}catch(e){console.error("Error loading user:",e),((m=e.response)==null?void 0:m.status)===401&&(localStorage.removeItem("admin_token"),this.$router.push("/admin/login"))}},async loadBrandingSettings(){try{const m=localStorage.getItem("admin_token");if(!m)return;const e=await this.$axios.get("/api/v1/settings",{headers:{Authorization:`Bearer ${m}`}});e.data.general&&e.data.general.site_name&&e.data.general.site_name.value&&(this.siteName=e.data.general.site_name.value),e.data.branding&&e.data.branding.logo&&e.data.branding.logo.value&&(this.brandingLogo=e.data.branding.logo.value)}catch(m){console.error("Error loading branding settings:",m)}},async logout(){await x().logout(),this.currentUser=null,this.userRoles=[],this.userPermissions=[],this.$router.push("/admin/login")},hasPermission(m){return this.authStore&&(this.authStore.hasRole&&this.authStore.hasRole(["administrator"])||this.authStore.hasPermission&&this.authStore.hasPermission(m))?!0:!this.currentUser||!this.userPermissions||this.userPermissions.length===0?!1:this.userRoles&&this.userRoles.length>0&&this.userRoles.some(e=>e.slug==="administrator")?!0:this.userPermissions.includes(m)},canAccessLeads(){return!this.currentUser||!this.userPermissions||this.userPermissions.length===0?!1:this.hasPermission("view-leads")||this.hasPermission("manage-leads")||this.hasPermission("export-leads")},async loadUnreadCount(){if(this.canAccessLeads())try{const m=localStorage.getItem("admin_token");if(!m)return;const e=await this.$axios.get("/api/v1/leads/unread-count",{headers:{Authorization:`Bearer ${m}`}});this.unreadCount=e.data.count||0}catch(m){console.error("Error loading unread count:",m)}},startUnreadCountPolling(){this.loadUnreadCount(),this.unreadCountInterval=setInterval(()=>{this.loadUnreadCount()},3e4)},stopUnreadCountPolling(){this.unreadCountInterval&&(clearInterval(this.unreadCountInterval),this.unreadCountInterval=null)},resolveImageUrl(m){return j(m)},showProfileDialog(){this.profileDialogVisible=!0}},mounted(){this.authStore=x(),localStorage.getItem("admin_token")?(this.loadUser().then(()=>{this.startUnreadCountPolling()}),this.loadBrandingSettings()):this.$router.push("/admin/login")},provide(){return{refreshUnreadCount:()=>{this.loadUnreadCount()}}},watch:{$route(){this.loadUnreadCount()}},beforeUnmount(){this.stopUnreadCountPolling()}},G={class:"d-flex align-center justify-space-between w-100"},H={key:0,class:"unread-badge"},K={class:"pa-2"},O={key:1,class:"d-flex align-center mr-4"},Q={class:"footer-content"},W={class:"footer-brand"},X={class:"logo-wrapper"},Z=["src"],$={class:"footer-info"},ee={class:"copyright-text"};function te(m,e,h,f,r,n){const P=d("v-img"),y=d("v-avatar"),b=d("v-list-item-title"),o=d("v-list-item"),w=d("v-divider"),v=d("v-list-group"),A=d("v-list"),k=d("v-icon"),L=d("v-btn"),R=d("v-navigation-drawer"),B=d("v-app-bar-nav-icon"),C=d("v-chip"),S=d("v-spacer"),D=d("v-menu"),I=d("v-app-bar"),V=d("router-view"),N=d("v-container"),z=d("v-main"),Y=d("v-footer"),E=d("UserProfileDialog");return i(),U("div",null,[t(R,{modelValue:r.drawer,"onUpdate:modelValue":e[1]||(e[1]=u=>r.drawer=u),class:"gradient_color",location:"left",permanent:"","hide-overlay":"",app:"",dark:""},{append:s(()=>[c("div",K,[t(L,{link:"",router:"",onClick:e[0]||(e[0]=u=>n.logout()),class:"logout-btn text-black",size:"small",block:""},{default:s(()=>[t(k,{left:""},{default:s(()=>e[6]||(e[6]=[g("mdi-logout")])),_:1,__:[6]}),e[7]||(e[7]=g("Logout "))]),_:1,__:[7]})])]),default:s(()=>[e[8]||(e[8]=c("div",{class:"sidebar-shapes"},[c("div",{class:"shape shape-1"}),c("div",{class:"shape shape-2"}),c("div",{class:"shape shape-3"})],-1)),r.currentUser?(i(),a(o,{key:0,class:"user-profile-header"},{prepend:s(()=>[t(y,{size:"48",class:"mr-3"},{default:s(()=>[t(P,{src:n.resolvedBrandingLogo||"/assets/logo/logo.png",alt:"Logo",cover:""},null,8,["src"])]),_:1})]),default:s(()=>[t(b,{class:"text-h6 font-weight-bold"},{default:s(()=>[g(_(r.siteName||"Admin Panel"),1)]),_:1})]),_:1})):l("",!0),t(w,{class:"my-0 divider-glow"}),r.currentUser&&r.userPermissions.length>0?(i(),a(A,{key:1,density:"compact",nav:""},{default:s(()=>[n.hasPermission("access-dashboard")?(i(),a(o,{key:0,link:"",router:"","prepend-icon":"mdi-view-dashboard",title:"Dashboard",to:{name:"AdminDashboard"},value:"Dashboard",exact:""})):l("",!0),n.hasPermission("manage-products")?(i(),a(v,{key:1,value:"products","prepend-icon":"mdi-package-variant","no-action":""},{activator:s(({props:u})=>[t(o,p(u,{title:"Products"}),null,16)]),default:s(()=>[t(o,{"prepend-icon":"mdi-package-variant",title:"Products",to:{name:"AdminProducts"}}),t(o,{"prepend-icon":"mdi-folder",title:"Categories",to:{name:"AdminCategories"}}),t(o,{"prepend-icon":"mdi-tag",title:"Tags",to:{name:"AdminTags"}})]),_:1})):l("",!0),n.hasPermission("manage-services")?(i(),a(o,{key:2,link:"",router:"","prepend-icon":"mdi-wrench",title:"Services",to:{name:"AdminServices"},value:"Services",exact:""})):l("",!0),n.hasPermission("manage-about")?(i(),a(o,{key:3,link:"",router:"","prepend-icon":"mdi-information",title:"About Page",to:{name:"AdminAbout"},value:"About",exact:""})):l("",!0),n.hasPermission("manage-blog")?(i(),a(v,{key:4,value:"blog","prepend-icon":"mdi-post","no-action":""},{activator:s(({props:u})=>[t(o,p(u,{title:"Blog"}),null,16)]),default:s(()=>[t(o,{"prepend-icon":"mdi-post",title:"Blog Posts",to:{name:"AdminBlog"}}),t(o,{"prepend-icon":"mdi-folder",title:"Categories",to:{name:"AdminBlogCategories"}})]),_:1})):l("",!0),n.hasPermission("manage-careers")||n.hasPermission("manage-applications")?(i(),a(v,{key:5,value:"careers","prepend-icon":"mdi-briefcase","no-action":""},{activator:s(({props:u})=>[t(o,p(u,{title:"Careers"}),null,16)]),default:s(()=>[n.hasPermission("manage-careers")?(i(),a(o,{key:0,"prepend-icon":"mdi-briefcase",title:"Careers",to:{name:"AdminCareers"}})):l("",!0),n.hasPermission("manage-applications")?(i(),a(o,{key:1,"prepend-icon":"mdi-file-document-edit",title:"Job Applications",to:{name:"AdminJobApplications"}})):l("",!0)]),_:1})):l("",!0),n.hasPermission("manage-users")?(i(),a(o,{key:6,link:"",router:"","prepend-icon":"mdi-account-group",title:"Users",to:{name:"AdminUsers"},value:"Users",exact:""})):l("",!0),n.hasPermission("manage-roles")?(i(),a(v,{key:7,value:"roles","prepend-icon":"mdi-shield-account","no-action":""},{activator:s(({props:u})=>[t(o,p(u,{title:"Roles & Permissions"}),null,16)]),default:s(()=>[t(o,{"prepend-icon":"mdi-shield-account",title:"Roles",to:{name:"AdminRoles"}}),t(o,{"prepend-icon":"mdi-key",title:"Permissions",to:{name:"AdminPermissions"}})]),_:1})):l("",!0),n.canAccessLeads()?(i(),a(o,{key:8,link:"",router:"","prepend-icon":"mdi-email",to:{name:"AdminLeads"},value:"Leads",exact:"",class:"leads-menu-item"},{title:s(()=>[c("div",G,[e[5]||(e[5]=c("span",null,"Leads",-1)),r.unreadCount>0?(i(),U("span",H,_(r.unreadCount>99?"99+":r.unreadCount),1)):l("",!0)])]),_:1})):l("",!0),n.hasPermission("manage-newsletters")?(i(),a(o,{key:9,link:"",router:"","prepend-icon":"mdi-email-newsletter",to:{name:"AdminNewsletters"},value:"Newsletters",exact:"",title:"Newsletters"})):l("",!0),n.hasPermission("manage-settings")?(i(),a(o,{key:10,link:"",router:"","prepend-icon":"mdi-cog",title:"Settings",to:{name:"AdminSettings"},value:"Settings",exact:""})):l("",!0),n.hasPermission("view-login-logs")||n.hasPermission("view-visitor-logs")?(i(),a(v,{key:11,value:"logs","prepend-icon":"mdi-file-document-multiple","no-action":""},{activator:s(({props:u})=>[t(o,p(u,{title:"Logs"}),null,16)]),default:s(()=>[n.hasPermission("view-login-logs")?(i(),a(o,{key:0,"prepend-icon":"mdi-login",title:"Login Logs",to:{name:"AdminLoginLogs"}})):l("",!0),n.hasPermission("view-visitor-logs")?(i(),a(o,{key:1,"prepend-icon":"mdi-account-group",title:"Visitor Logs",to:{name:"AdminVisitorLogs"}})):l("",!0)]),_:1})):l("",!0)]),_:1})):l("",!0)]),_:1,__:[8]},8,["modelValue"]),t(I,{app:"",flat:"",density:"compact",class:"gradient_color app-bar-modern"},{default:s(()=>[t(B,{onClick:e[2]||(e[2]=J(u=>r.drawer=!r.drawer,["stop"]))}),t(C,{class:"mx-2 date-chip"},{default:s(()=>[g(_(r.currentDate),1)]),_:1}),t(S),r.currentUser&&r.userRoles&&r.userRoles.some(u=>u.slug==="administrator")?(i(),a(C,{key:0,"prepend-icon":"mdi-shield-account"},{default:s(()=>e[9]||(e[9]=[g("Administrator")])),_:1,__:[9]})):l("",!0),t(S),r.currentUser?(i(),U("div",O,[t(D,{"open-on-hover":""},{activator:s(({props:u})=>[t(y,p(u,{size:"42",class:"fill-image mr-2",title:r.currentUser.name}),{default:s(()=>[r.currentUser.avatar?(i(),a(P,{key:0,cover:"",src:n.resolvedUserAvatar,alt:r.currentUser.name},null,8,["src","alt"])):(i(),a(P,{key:1,cover:"",src:"/assets/logo/logo.png",alt:"image"}))]),_:2},1040,["title"])]),default:s(()=>[t(A,null,{default:s(()=>[t(o,{onClick:n.showProfileDialog,style:{cursor:"pointer"}},{prepend:s(()=>[t(k,null,{default:s(()=>e[10]||(e[10]=[g("mdi-account")])),_:1,__:[10]})]),append:s(()=>[t(k,{size:"small"},{default:s(()=>e[11]||(e[11]=[g("mdi-chevron-right")])),_:1,__:[11]})]),default:s(()=>[t(b,null,{default:s(()=>[g(_(r.currentUser.name),1)]),_:1})]),_:1},8,["onClick"]),t(w,{class:"my-2"}),t(o,{link:"",router:"",onClick:e[3]||(e[3]=u=>n.logout())},{prepend:s(()=>[t(k,null,{default:s(()=>e[12]||(e[12]=[g("mdi-logout")])),_:1,__:[12]})]),default:s(()=>[t(b,null,{default:s(()=>e[13]||(e[13]=[g("Logout")])),_:1,__:[13]})]),_:1})]),_:1})]),_:1})])):l("",!0)]),_:1}),t(z,null,{default:s(()=>[t(N,{fluid:""},{default:s(()=>[t(V)]),_:1})]),_:1}),t(Y,{class:"footer-modern gradient_color rtl-footer",app:""},{default:s(()=>[c("div",Q,[c("div",W,[c("div",X,[c("img",{src:n.resolvedBrandingLogo||"/assets/logo/logo.png",alt:"cpb-it",height:"24",class:"footer-logo"},null,8,Z)]),e[14]||(e[14]=c("div",{class:"brand-text"},[c("span",{class:"brand-name"},"Powered By CPB-IT")],-1))]),e[16]||(e[16]=c("div",{class:"footer-divider"},null,-1)),c("div",$,[e[15]||(e[15]=c("span",{class:"version-badge"},"v1.0",-1)),c("span",ee,"Â© "+_(r.currentYear)+" All Rights Reserved",1)])])]),_:1}),t(E,{modelValue:r.profileDialogVisible,"onUpdate:modelValue":e[4]||(e[4]=u=>r.profileDialogVisible=u),user:r.currentUser},null,8,["modelValue","user"])])}const ie=T(q,[["render",te],["__scopeId","data-v-bc98727e"]]);export{ie as default};
